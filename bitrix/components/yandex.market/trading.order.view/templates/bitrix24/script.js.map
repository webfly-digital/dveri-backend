{"version":3,"file":"script.js","sources":["src/factory.js","src/utils.js","src/reference/field.js","src/basket/summaryskeleton.js","src/basket/cis.js","src/basket/digital.js","src/bracketchain.js","src/basket/itemview.js","src/basket/itemedit.js","src/basket/basket.js","src/box/itemview.js","src/box/basketitemmovemodal.js","src/box/basketitemsplitmodal.js","src/box/boxonlypartdeletemodal.js","src/box/itemedit.js","src/box/collection.js","src/box/field.js","src/basketconfirm/field.js","src/property/field.js","src/print/field.js","src/notification/field.js","src/index.js","src/compatible/editor.js"],"sourcesContent":["const BX = window.BX;\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tname: 'yamarket',\r\n\t\tmap: {},\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tregister() {\r\n\t\tif (this.isEditorInitialized()) {\r\n\t\t\tthis.registerEditorMethod();\r\n\t\t} else {\r\n\t\t\tthis.handleEditorInit(true);\r\n\t\t}\r\n\t}\r\n\r\n\tisEditorInitialized() {\r\n\t\treturn BX.UI?.EntityEditorControlFactory?.initialized;\r\n\t}\r\n\r\n\tregisterEditorMethod() {\r\n\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod(this.options.name, this.build);\r\n\t}\r\n\r\n\thandleEditorInit(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorControlFactory:onInitialize', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (factory, event) => {\r\n\t\tevent.methods[this.options.name] = this.build;\r\n\t\tthis.handleEditorInit(false);\r\n\t}\r\n\r\n\tbuild = (type, controlId, settings) => {\r\n\t\tconst prefix = this.options.name + '_';\r\n\r\n\t\tif (type.indexOf(prefix) !== 0) { return null; }\r\n\r\n\t\tconst internalType = type.substr(prefix.length);\r\n\r\n\t\tif (!this.options.map.hasOwnProperty(internalType)) { return null; }\r\n\r\n\t\tconst fieldClass = this.options.map[internalType];\r\n\r\n\t\treturn fieldClass.create(controlId, settings);\r\n\t}\r\n}","export function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}\r\n\r\nexport function pascalCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word) => word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function camelCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) => index === 0 ? word.toLowerCase() : word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function kebabCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) =>  word.toLowerCase())\r\n\t\t.join('-');\r\n}\r\n\r\nexport function copyValues(from, to) {\r\n\tconst fromValues = collectValues(from);\r\n\r\n\treturn fillValues(to, fromValues);\r\n}\r\n\r\nexport function collectValues(container) {\r\n\tconst inputs = findInputs(container);\r\n\tconst result = {};\r\n\r\n\tfor (const [name, input] of Object.entries(inputs)) {\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tif (!option.selected) { continue; }\r\n\r\n\t\t\t\tresult[name] = option.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult[name] = input.value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function fillValues(container, values) {\r\n\tconst inputs = findInputs(container);\r\n\tlet isChanged = false;\r\n\r\n\tfor (const [name, value] of Object.entries(values)) {\r\n\t\tif (inputs[name] == null) { continue; }\r\n\r\n\t\tconst input = inputs[name];\r\n\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tconst selected = (option.value === value);\r\n\r\n\t\t\t\tif (selected === Boolean(option.selected)) { continue; }\r\n\r\n\t\t\t\toption.selected = selected;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (input.value === value) { continue; }\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\tinput.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn isChanged;\r\n}\r\n\r\nexport function findInputs(container) {\r\n\tconst inputs = container.querySelectorAll('input, select, textarea');\r\n\tconst result = {};\r\n\r\n\tfor (const input of inputs) {\r\n\t\tif (!input.name) { continue; }\r\n\r\n\t\tresult[input.name] = input;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function replaceTemplateVariables(template, variables) {\r\n\tlet result = template;\r\n\r\n\tif (variables == null) { return result; }\r\n\r\n\tfor (const [key, value] of Object.entries(variables)) {\r\n\t\tresult = result.replace('#' + key + '#', value);\r\n\t}\r\n\r\n\treturn result;\r\n}","import {replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Field extends BX.UI.EntityEditorField {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._hasLayout = false;\r\n\t\tthis.options = this.constructor.defaults != null\r\n\t\t\t? Object.assign({}, this.constructor.defaults)\r\n\t\t\t: {};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.constructor.messages[key] || super.getMessage(key);\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tclearLayout() {\r\n\t\tif (!this._hasLayout) { return; }\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\t\tthis._hasLayout = false;\r\n\t}\r\n\r\n\tlayout(options) {\r\n\t\tif (this._hasLayout) { return; }\r\n\r\n\t\tthis.ensureWrapperCreated({});\r\n\t\tthis.adjustWrapper();\r\n\r\n\t\tif (!this.isNeedToDisplay()) {\r\n\t\t\tthis.registerLayout(options);\r\n\t\t\tthis._hasLayout = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\r\n\t\t}\r\n\r\n\t\tif (this.useTitle()) {\r\n\t\t\tconst title = this.getTitle();\r\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\r\n\t\t}\r\n\r\n\t\tthis.render(this.getValue());\r\n\r\n\t\tif (this.isContextMenuEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\r\n\t\t}\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis.initializeDragDropAbilities();\r\n\t\t}\r\n\r\n\t\tthis.registerLayout(options);\r\n\t\tthis._hasLayout = true;\r\n\t}\r\n\r\n\tforget() {}\r\n\r\n\trender(payload) {}\r\n\r\n\tuseTitle() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelectorAll(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelectorAll(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelector(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelector(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n}","import {copyValues, replaceTemplateVariables} from \"../utils\";\r\nimport './summary.css';\r\n\r\nexport default class SummarySkeleton {\r\n\r\n\tstatic STATUS_READY = 'READY';\r\n\tstatic STATUS_WAIT = 'WAIT';\r\n\tstatic STATUS_OPTIONAL = 'OPTIONAL';\r\n\tstatic STATUS_EMPTY = 'EMPTY';\r\n\r\n\tstatic defaults = {\r\n\t\tmodalElement: '.yamarket-item-summary__modal',\r\n\t\tstatusElement: '.yamarket-item-summary__status',\r\n\t\tinputElement: 'input',\r\n\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t};\r\n\r\n\tel;\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tclone() : SummarySkeleton {\r\n\t\treturn new this.constructor(this.options);\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleStatusClick(true);\r\n\t}\r\n\r\n\thandleStatusClick(dir) {\r\n\t\tconst status = this.getElement('status');\r\n\r\n\t\tif (status == null) { return; }\r\n\r\n\t\tstatus[dir ? 'addEventListener' : 'removeEventListener']('click', this.onStatusClick);\r\n\t}\r\n\r\n\tonStatusClick = (evt) => {\r\n\t\tthis.openDialog();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tsetup(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\treplaceName(oldName: string, newName: string) : void {\r\n\t\tthis.options.name = this.options.name.replace(oldName, newName);\r\n\t}\r\n\r\n\tbuild() {\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildStatus() {\r\n\t\tconst cises = this.optionValue();\r\n\t\tconst status = this.getStatus(cises);\r\n\r\n\t\treturn `<a class=\"yamarket-item-summary__status\" href=\"#\" data-status=\"${status}\">${this.getMessage('SUMMARY_' + status)}</a>`\r\n\t}\r\n\r\n\treflowStatus() {\r\n\t\tconst value = this.formValue();\r\n\t\tconst status = this.getStatus(value);\r\n\t\tconst element = this.getElement('status');\r\n\r\n\t\telement.setAttribute('data-status', status);\r\n\t\telement.textContent = this.getMessage('SUMMARY_' + status);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {any} value\r\n\t *\r\n\t * @return {string}\r\n\t */\r\n\tgetStatus(value) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {string} */\r\n\tbuildForm(useFormValue = false) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\treflowForm() {\r\n\t\tconst modal = this.el.querySelector('.yamarket-item-summary__modal');\r\n\r\n\t\tmodal.innerHTML = this.buildForm(true);\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\toptionValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\tformValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\topenDialog() {\r\n\t\tconst modal = this.getElement('modal').firstElementChild;\r\n\t\tconst options  = this.dialogOptions();\r\n\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\tmessageBox.setMessage(modal.cloneNode(true));\r\n\t\tmessageBox.setButtons([\r\n\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t]);\r\n\r\n\t\tmessageBox.show();\r\n\t\tcopyValues(this.el, messageBox.popupWindow.contentContainer);\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tonSaveClick(messageBox) {\r\n\t\tconst isChanged = copyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\r\n\t\tif (isChanged && this.options.onChange) {\r\n\t\t\tthis.options.onChange();\r\n\t\t}\r\n\r\n\t\tthis.reflowStatus();\r\n\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tonCancelClick(messageBox) {\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.options.messages[key] || key;\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelectorAll(selector);\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelector(selector);\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {fillValues, replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Cis extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\tcopyElement: '.yamarket-item-summary__copy',\r\n\t\tinputElement: 'input, select',\r\n\t\ttitle: '',\r\n\t\toffset: 0,\r\n\t\tcount: 0,\r\n\t\ttotal: 0,\r\n\t\tmarkingGroup: false,\r\n\t\tmarkingType: null,\r\n\t\tinstances: [],\r\n\t\tinstanceTypes: [],\r\n\t\tinternalInstances: [],\r\n\t})\r\n\r\n\tbind() {\r\n\t\tsuper.bind();\r\n\t\tthis.handleCopyClick(true);\r\n\t}\r\n\r\n\thandleCopyClick(dir) {\r\n\t\tconst copy = this.getElement('copy');\r\n\r\n\t\tif (copy == null) { return; }\r\n\r\n\t\tcopy[dir ? 'addEventListener' : 'removeEventListener']('click', this.onCopyClick);\r\n\t}\r\n\r\n\tonCopyClick = (evt) => {\r\n\t\tthis.copyInternal();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.count = count;\r\n\t\tthis.reflowForm();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tupdateCount(count, offset) {\r\n\t\tthis.options.count = count;\r\n\t\tthis.options.offset = offset;\r\n\t\tthis.reflowForm();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tif (this.requiredTypes().length === 0) { return '&mdash;'; }\r\n\r\n\t\tconst internalCises = this.optionValue('internal');\r\n\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.emptyValues(internalCises) ? '' : this.buildCopyIcon()}\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildCopyIcon() {\r\n\t\treturn `<button class=\"yamarket-item-summary__copy\" type=\"button\" title=\"${this.getMessage('COPY')}\">\r\n\t\t\t${this.getMessage('COPY')}\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\t\tconst value = useFormValue ? this.formValue(true) : this.optionValue();\r\n\t\tconst types = this.requiredTypes();\r\n\r\n\t\treturn `<table class=\"ui-form yamarket-cis-table\">\r\n\t\t\t<thead class=\"yamarket-cis-table__head\">\r\n\t\t\t\t<td></td>\r\n\t\t\t\t${types.map((type) => `<td>${this.getMessage('HEAD_' + type)}</td>`).join('')}\r\n\t\t\t</thead>\r\n\t\t\t\r\n\t\t\t${iterator.map((dummy, index) => {\r\n\t\t\t\tconst hidden = (index < this.options.offset || index >= this.options.count + this.options.offset);\r\n\t\t\t\t\r\n\t\t\t\treturn `<tr ${hidden ? 'hidden' : ''}>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__number\">\r\n\t\t\t\t\t\t&numero;${index + 1}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t${types.map((type) => {\r\n\t\t\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\t\t\tconst one = value[name] ?? '';\r\n\t\t\t\t\t\tconst placeholder = this.hasMessage('PLACEHOLDER_' + type) ? this.getMessage('PLACEHOLDER_' + type) : '';\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn `\r\n\t\t\t\t\t\t\t<td class=\"yamarket-cis-table__control type-count--${types.length}\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.inputName(name)}\" value=\"${BX.util.htmlspecialchars(one)}\" data-name=\"${name}\" placeholder=\"${placeholder}\" ${hidden ? 'disabled' : ''} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t`;\r\n\t\t\t\t\t}).join('')}\r\n\t\t\t\t</tr>`;\r\n\t\t\t}).join('')}\r\n\t\t\t${types.includes('CIS') && this.fixedCisType() == null ? \r\n\t\t\t\t`<tr>\r\n\t\t\t\t\t<td></td>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__type\">\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-label\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('FORMAT')}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-value\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"${this.inputName('TYPE')}\" data-name=\"TYPE\">\r\n\t\t\t\t\t\t\t\t\t${['CIS', 'UIN'].map((typeVariant) => {\r\n\t\t\t\t\t\t\t\t\t\treturn `<option value=\"${typeVariant}\" ${typeVariant === value['TYPE'] ? 'selected' : ''}>${this.getMessage(typeVariant)}</option>`;\r\n\t\t\t\t\t\t\t\t\t}).join('')}\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>`\r\n\t\t\t : ''}\r\n\t\t</table>`;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tconst [filled, optional] = this.filledCount(value);\r\n\t\tlet result;\r\n\r\n\t\tif (filled >= this.options.count) {\r\n\t\t\tresult = SummarySkeleton.STATUS_READY;\r\n\t\t} else if (optional >= this.options.count) {\r\n\t\t\tresult = SummarySkeleton.STATUS_OPTIONAL;\r\n\t\t} else {\r\n\t\t\tresult = SummarySkeleton.STATUS_WAIT;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\temptyValues(values) {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tlet empty = true;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tempty = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!empty) { break; }\r\n\t\t}\r\n\r\n\t\treturn empty;\r\n\t}\r\n\r\n\tfilledCount(values: Object) : [number, number] {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tconst optionalTypes = this.optionalTypes();\r\n\t\tlet filled = 0;\r\n\t\tlet optional = 0;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tlet itemFilled = 0;\r\n\t\t\tlet itemOptional = 0;\r\n\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\t++itemFilled;\r\n\t\t\t\t\t++itemOptional;\r\n\t\t\t\t} else if (optionalTypes.includes(type)) {\r\n\t\t\t\t\t++itemOptional\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (itemFilled >= types.length) {\r\n\t\t\t\t++filled;\r\n\t\t\t\t++optional;\r\n\t\t\t} else if (itemOptional >= types.length) {\r\n\t\t\t\t++optional;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [filled, optional];\r\n\t}\r\n\r\n\tcopyInternal(container = this.el) {\r\n\t\tconst values = Object.assign({}, this.formValue(true), this.optionValue('internal'));\r\n\r\n\t\tif (!this.setValues(values, container)) { return; }\r\n\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tgetValues() : Object {\r\n\t\treturn this.formValue();\r\n\t}\r\n\r\n\tsetValues(values: Object, container = this.el) : boolean {\r\n\t\treturn fillValues(container, this.makeInputValues(values))\r\n\t}\r\n\r\n\tmakeInputValues(values) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const [key, value] of Object.entries(values)) {\r\n\t\t\tresult[this.inputName(key)] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tinputName(selfName: string) : string {\r\n\t\tconst bracketPosition = selfName.indexOf('[');\r\n\t\tlet result;\r\n\r\n\t\tif (bracketPosition > 0) {\r\n\t\t\tresult =\r\n\t\t\t\tthis.options.name\r\n\t\t\t\t+ `[${selfName.substring(0, bracketPosition)}]`\r\n\t\t\t\t+ `${selfName.substring(bracketPosition)}`\r\n\t\t} else {\r\n\t\t\tresult = this.options.name + `[${selfName}]`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tformValue(needAll: boolean = false) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const input of this.fewElements('input')) {\r\n\t\t\tif (!needAll && input.disabled) { continue; }\r\n\r\n\t\t\tconst name = String(input.dataset.name).trim();\r\n\t\t\tconst value = input.value.trim();\r\n\r\n\t\t\tif (name === '') { continue; }\r\n\r\n\t\t\tresult[name] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue(optionKey = null) {\r\n\t\tconst instances = optionKey != null ? this.options[optionKey + 'Instances'] : this.options.instances;\r\n\t\tconst types = this.requiredTypes();\r\n\t\tconst result = {};\r\n\t\tconst fixedType = this.fixedCisType();\r\n\t\tconst cisTypes = this.cisTypes();\r\n\t\tlet index = 0;\r\n\r\n\t\tif (!Array.isArray(instances)) { return result; }\r\n\r\n\t\tfor (const instance of instances) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tlet value = (instance[type] ?? '').trim();\r\n\t\t\t\tlet valueType = type;\r\n\r\n\t\t\t\tif (value === '' && type === 'CIS' && fixedType == null) {\r\n\t\t\t\t\tvalue = (instance['UIN'] ?? '').trim();\r\n\t\t\t\t\tvalueType = 'UIN';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tresult[`ITEMS[${index}][${type}]`] = value;\r\n\r\n\t\t\t\t\tif (cisTypes.includes(valueType)) {\r\n\t\t\t\t\t\tresult['TYPE'] = valueType;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tif (fixedType == null && result['TYPE'] == null && this.options.markingType != null) {\r\n\t\t\tresult['TYPE'] = this.options.markingType;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcisTypes() {\r\n\t\treturn [ 'UIN', 'CIS' ];\r\n\t}\r\n\r\n\tfixedCisType() {\r\n\t\tconst option = (this.options.instanceTypes || []);\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (option.includes(type) || option.includes(type + '_OPTIONAL')) {\r\n\t\t\t\treturn type;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\trequiredTypes() : Array {\r\n\t\tconst result = (this.options.instanceTypes || []).slice();\r\n\t\tlet foundCis = false;\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (result.includes(type)) {\r\n\t\t\t\tfoundCis = true;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst optionalIndex = result.indexOf(type + '_OPTIONAL');\r\n\r\n\t\t\tif (optionalIndex !== -1) {\r\n\t\t\t\tfoundCis = true;\r\n\t\t\t\tresult.splice(optionalIndex, 1);\r\n\t\t\t\tresult.unshift(type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!foundCis && this.options.markingGroup) {\r\n\t\t\tresult.unshift('CIS');\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionalTypes() : Array {\r\n\t\tconst types = this.options.instanceTypes || [];\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (types.indexOf(type + '_OPTIONAL') !== -1) {\r\n\t\t\t\tresult.push(type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.options.title,\r\n\t\t\tminWidth: Math.max(400, Math.min(1200, this.requiredTypes().length * 400))\r\n\t\t};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_CIS_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n\r\n\thasMessage(key) {\r\n\t\treturn this.getMessage(key) !== key;\r\n\t}\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {collectValues, replaceTemplateVariables} from \"../utils\";\r\nimport {BracketChain} from \"../bracketchain\";\r\n\r\nexport default class Digital extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\titems: [],\r\n\t\ttotal: 0,\r\n\t})\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst formValue = useFormValue ? this.formValue() : this.optionValue();\r\n\r\n\t\treturn `<div class=\"ui-form\">\r\n\t\t\t${this.buildFormCodes(total, formValue)}\r\n\t\t\t${this.buildFormAdditional(total, formValue)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildFormCodes(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\r\n\t\treturn iterator.map((dummy, index) => {\r\n\t\t\tconst oneValue = formValue?.ITEM?.[index] || {};\r\n\r\n\t\t\tlet title = '';\r\n\t\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('CODE')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][CODE]\" value=\"${BX.util.htmlspecialchars(oneValue['CODE'] || '')}\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ACTIVATE_TILL')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w100\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][ACTIVATE_TILL]\" value=\"${BX.util.htmlspecialchars(oneValue['ACTIVATE_TILL'] || '')}\" onclick=\"BX.calendar({node: this, field: this, bTime: false, bHideTime: true})\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\r\n\t\t\tif (hasFew) {\r\n\t\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('GROUP', { 'NUMBER': index + 1 })}</div>`;\r\n\t\t\t}\r\n\r\n\t\t\treturn title + fieldset;\r\n\t\t}).join('');\r\n\t}\r\n\r\n\tbuildFormAdditional(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tlet title = '';\r\n\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('SLIP')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<textarea class=\"ui-entity-editor-field-textarea\" name=\"${this.options.name}[SLIP]\" rows=\"5\" required>${BX.util.htmlspecialchars(formValue['SLIP'] || '')}</textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\r\n\t\tif (hasFew) {\r\n\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('ADDITIONAL')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn title + fieldset;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tconst filledItems = this.filterFilledItems(value.ITEM);\r\n\t\tconst isItemsFilled = filledItems.length >= this.options.total;\r\n\t\tconst isSlipFilled = (value['SLIP'] != null && value['SLIP'].trim() !== '');\r\n\r\n\t\treturn (\r\n\t\t\tisItemsFilled && isSlipFilled\r\n\t\t\t\t? SummarySkeleton.STATUS_READY\r\n\t\t\t\t: SummarySkeleton.STATUS_WAIT\r\n\t\t);\r\n\t}\r\n\r\n\tfilterFilledItems(items) {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['CODE'] == null || item['CODE'].trim() === '') { continue; }\r\n\t\t\tif (item['ACTIVATE_TILL'] == null || item['ACTIVATE_TILL'].trim() === '') { continue; }\r\n\r\n\t\t\tresult.push(item);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue() {\r\n\t\tconst items = Array.isArray(this.options.items) ? this.options.items : [];\r\n\t\tlet slip = '';\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['SLIP'] != null && item['SLIP'] !== '') {\r\n\t\t\t\tslip = item['SLIP'];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t'ITEM': items,\r\n\t\t\t'SLIP': slip,\r\n\t\t};\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst rawValues = collectValues(this.el);\r\n\t\tconst values = BracketChain.toTree(rawValues, this.options.name);\r\n\t\tconst defaults = {\r\n\t\t\t'ITEM': [],\r\n\t\t\t'SLIP': '',\r\n\t\t};\r\n\r\n\t\treturn Object.assign(defaults, values);\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_DIGITAL_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n}","export class BracketChain {\r\n\r\n\tstatic toTree(values, base = null) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const key in values) {\r\n\t\t\tif (!values.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tconst keyRelative = this.keyRelative(key, base);\r\n\r\n\t\t\tif (keyRelative == null) { continue; }\r\n\r\n\t\t\tconst keyChain = this.valueKeyChain(keyRelative);\r\n\r\n\t\t\tthis.setValueByKeyChain(result, keyChain, values[key]);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic keyRelative(key, base) {\r\n\t\tif (base == null) { return key; }\r\n\t\tif (key.indexOf(base) !== 0) { return null; }\r\n\r\n\t\treturn key.replace(base, '');\r\n\t}\r\n\r\n\tstatic valueKeyChain(key) {\r\n\t\tconst parts = key.split('[');\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const part of parts) {\r\n\t\t\tif (part === '' && result.length === 0) { continue; }\r\n\r\n\t\t\tconst name = part.replace(/]$/, '');\r\n\r\n\t\t\tresult.push(name);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic setValueByKeyChain(result, chain, value) {\r\n\t\tconst lastKey = chain.pop();\r\n\t\tlet level = result;\r\n\r\n\t\tfor (let index = 0; index < chain.length; ++index) {\r\n\t\t\tconst key = chain[index];\r\n\t\t\tconst nextKey = (index + 1 === chain.length) ? lastKey : chain[index + 1];\r\n\r\n\t\t\tif (level[key] == null) {\r\n\t\t\t\tlevel[key] = /^\\d+$/.test(nextKey) ? [] : {};\r\n\t\t\t}\r\n\r\n\t\t\tlevel = level[key];\r\n\t\t}\r\n\r\n\t\tlevel[lastKey] = value;\r\n\t}\r\n\r\n}","import Cis from \"./cis\";\r\nimport Digital from \"./digital\";\r\nimport {htmlToElement, pascalCase, kebabCase, findInputs} from \"../utils\";\r\nimport type SummarySkeleton from \"./summaryskeleton\";\r\n\r\nexport default class ItemView {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tname: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tel;\r\n\r\n\tconstructor(options: Object) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._wires = [];\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tthis.forgetWires();\r\n\t\tthis.options = {};\r\n\t}\r\n\r\n\tclone() : ItemView {\r\n\t\tconst cloned = new this.constructor(this.options);\r\n\t\tcloned.el = this.el.cloneNode(true);\r\n\r\n\t\tfor (const [key, wire] of Object.entries(this._wires)) {\r\n\t\t\tcloned.wire(key, wire.clone());\r\n\t\t}\r\n\r\n\t\tcloned.setupWires();\r\n\t\tcloned.bind();\r\n\r\n\t\treturn cloned;\r\n\t}\r\n\r\n\tbind() : void {}\r\n\r\n\tunbind() : void {}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tgetTitle() : string {\r\n\t\treturn this.el.querySelector('[data-entity=\"NAME\"]').textContent.trim();\r\n\t}\r\n\r\n\tid() : string {\r\n\t\treturn this.getInputValue('ID');\r\n\t}\r\n\r\n\trender(item: Object, basket: Object) : void {\r\n\t\tconst columns = Object.keys(basket.COLUMNS);\r\n\t\tconst basketItem = basket.ITEMS[item.BASKET_KEY];\r\n\r\n\t\tcolumns.unshift('INDEX');\r\n\r\n\t\tthis.forgetWires();\r\n\r\n\t\tthis.el = htmlToElement(`<tr class=\"${item?.PARTIAL_COUNT?.CURRENT > 0 ? 'is--partial' : ''}\">\r\n\t\t\t${columns.map((key) => this.renderColumn(item, basketItem, key)).join('')}\r\n\t\t\t${this.renderActions()}\r\n\t\t</tr>`, 'tbody');\r\n\r\n\t\tthis.setupWires();\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tmount(point: HTMLElement) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n\r\n\treplaceName(newName: string) : void {\r\n\t\tconst oldName = this.options.name;\r\n\r\n\t\tfor (const [name, input] of Object.entries(findInputs(this.el))) {\r\n\t\t\tinput.name = name.replace(oldName, newName);\r\n\t\t}\r\n\r\n\t\tfor (const [, wire] of Object.entries(this._wires)) {\r\n\t\t\twire.replaceName(oldName, newName);\r\n\t\t}\r\n\r\n\t\tthis.options.name = newName;\r\n\t}\r\n\r\n\trenderColumn(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst method = 'column' + pascalCase(column);\r\n\r\n\t\treturn (\r\n\t\t\tmethod in this\r\n\t\t\t\t? this[method](item, basketItem, column)\r\n\t\t\t\t: this.columnDefault(item, basketItem, column)\r\n\t\t);\r\n\t}\r\n\r\n\tenableUp(enable: boolean = true) : void {}\r\n\r\n\tenableDown(enable: boolean = true) : void {}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnIndex(item: Object, basketItem: Object, column: string) : string {\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t${this.indexHidden(item, basketItem)}\r\n\t\t\t${this.valueFormatted(item, basketItem, column)}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tindexHidden(item: Object, basketItem: Object) : string {\r\n\t\tconst identifiersCount = this.value(item, basketItem, 'IDENTIFIERS_INITIAL_COUNT');\r\n\r\n\t\treturn ([\r\n\t\t\t`<input type=\"hidden\" name=\"${this.getName('ID')}\" value=\"${this.value(item, basketItem, 'ID')}\" />`,\r\n\t\t\t`<input type=\"hidden\" name=\"${this.getName('INITIAL_BOX')}\" value=\"${this.value(item, basketItem, 'INITIAL_BOX')}\" />`,\r\n\t\t\tidentifiersCount > 0\r\n\t\t\t\t? `<input type=\"hidden\" name=\"${this.getName('IDENTIFIERS')}[INITIAL_COUNT]\" value=\"${identifiersCount}\" />`\r\n\t\t\t\t: '',\r\n\t\t]).join('');\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnCis(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst cis = new Cis({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('IDENTIFIERS'),\r\n\t\t\ttitle: this.basketValue(basketItem, 'NAME'),\r\n\t\t\tmarkingType: this.basketValue(basketItem, 'MARKING_TYPE'),\r\n\t\t\tmarkingGroup: !!this.basketValue(basketItem, 'MARKING_GROUP'),\r\n\t\t\tinstanceTypes: this.basketValue(basketItem, 'INSTANCE_TYPES'),\r\n\t\t\tcount: +this.value(item, basketItem, 'COUNT'),\r\n\t\t\toffset: +this.value(item, basketItem, 'OFFSET'),\r\n\t\t\ttotal: +this.basketValue(basketItem, 'COUNT'),\r\n\t\t\tinstances: this.basketValue(basketItem, 'INSTANCES'),\r\n\t\t\tinternalInstances: this.basketValue(basketItem, 'INTERNAL_INSTANCES'),\r\n\t\t\tonChange: () => {\r\n\t\t\t\tthis.fire('cisUpdate');\r\n\t\t\t\tthis.options.onChange();\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.wire(column, cis);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-wire=\"${column}\">${cis.build()}</td>`;\r\n\t}\r\n\r\n\tcis() : ?Cis {\r\n\t\treturn this._wires['CIS'];\r\n\t}\r\n\r\n\tupdateCisCount() : void {\r\n\t\tthis.cis()?.updateCount(this.getCount(), this.getOffset());\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnDigital(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst digital = new Digital({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('DIGITAL'),\r\n\t\t\ttotal: this.value(item, basketItem, 'COUNT'),\r\n\t\t\titems: this.value(item, basketItem, 'DIGITAL'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(column, digital);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-wire=\"${column}\">${digital.build()}</td>`;\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnSubsidy(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst promos = this.value(item, basketItem, 'PROMOS');\r\n\t\tlet content = this.valueFormatted(item, basketItem, column);\r\n\r\n\t\tif (promos != null && Array.isArray(promos)) {\r\n\t\t\tcontent += promos.map((promo) => `<div>${promo}</div>`).join('');\r\n\t\t}\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">${content}</td>`;\r\n\t}\r\n\r\n\tcolumnCount(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst value = this.value(item, basketItem, column);\r\n\t\tconst valueSanitized = parseInt(value) || '';\r\n\t\tconst offset = parseInt(this.value(item, basketItem, 'OFFSET')) || 0;\r\n\t\tconst partialCurrent = item?.PARTIAL_COUNT?.CURRENT;\r\n\t\tconst partialTotal = item?.PARTIAL_COUNT?.TOTAL;\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('OFFSET')}\" value=\"${offset}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_CURRENT')}\" value=\"${partialCurrent || ''}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_TOTAL')}\" value=\"${partialTotal || ''}\" />\r\n\t\t\t<span data-entity=\"COUNT_TEXT\">${this.valueFormatted(item, basketItem, column)} ${this.getMessage('ITEM_UNIT')}</span>\r\n\t\t\t<span data-entity=\"PARTIAL_TEXT\">${this.partialText(partialCurrent, partialTotal)}</span>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tsetCount(count: number) : void {\r\n\t\tconst input = this.getInput('COUNT');\r\n\t\tconst text = this.el.querySelector('[data-entity=\"COUNT_TEXT\"]');\r\n\r\n\t\tinput.value = count;\r\n\t\ttext.textContent = `${count} ${this.getMessage('ITEM_UNIT')}`;\r\n\t}\r\n\r\n\tgetCount() : number {\r\n\t\treturn parseInt(this.getInputValue('COUNT')) || 0;\r\n\t}\r\n\r\n\tsetInitialCount(count: number) : void {\r\n\t\tthis.getInput('INITIAL_COUNT').value = count;\r\n\t}\r\n\r\n\tgetInitialCount() : number {\r\n\t\treturn parseInt(this.getInputValue('INITIAL_COUNT')) || 0;\r\n\t}\r\n\r\n\tsetOffset(offset: number) : void {\r\n\t\tthis.getInput('OFFSET').value = offset;\r\n\t}\r\n\r\n\tgetOffset() : number {\r\n\t\treturn parseInt(this.getInputValue('OFFSET')) || 0;\r\n\t}\r\n\r\n\tresetPart() : void {\r\n\t\tthis.el.classList.remove('is--partial');\r\n\t\tthis.getInput('PARTIAL_CURRENT').value = '';\r\n\t\tthis.getInput('PARTIAL_TOTAL').value = '';\r\n\t\tthis.el.querySelector('[data-entity=\"PARTIAL_TEXT\"]').textContent = '';\r\n\t}\r\n\r\n\tsetPart(index: number, total: number) : void {\r\n\t\tthis.el.classList.add('is--partial');\r\n\t\tthis.getInput('PARTIAL_CURRENT').value = index + 1;\r\n\t\tthis.getInput('PARTIAL_TOTAL').value = total;\r\n\t\tthis.el.querySelector('[data-entity=\"PARTIAL_TEXT\"]').textContent = this.partialText(+index + 1, total);\r\n\t}\r\n\r\n\tpartialText(current: number, total: number) : string {\r\n\t\treturn (\r\n\t\t\tcurrent > 0\r\n\t\t\t\t? `${this.getMessage('ITEM_PART')} ${current}/${total}`\r\n\t\t\t\t: ''\r\n\t\t);\r\n\t}\r\n\r\n\tisPart() : boolean {\r\n\t\treturn parseInt(this.getInputValue('PARTIAL_CURRENT')) > 0;\r\n\t}\r\n\r\n\tisFinalPart() : boolean {\r\n\t\tconst current = parseInt(this.getInputValue('PARTIAL_CURRENT')) || 0;\r\n\t\tconst total = parseInt(this.getInputValue('PARTIAL_TOTAL')) || 0;\r\n\r\n\t\treturn (current > 0 && current === total);\r\n\t}\r\n\r\n\tcolumnDefault(item: Object, basketItem: Object, column: string) : string {\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-entity=\"${column}\">${this.valueFormatted(item, basketItem, column)}</td>`;\r\n\t}\r\n\r\n\trenderActions() : string {\r\n\t\treturn '';\r\n\t}\r\n\r\n\twire(key: string, instance: SummarySkeleton) : void {\r\n\t\tthis._wires[key] = instance;\r\n\t}\r\n\r\n\tforgetWires() : void {\r\n\t\tthis._wires = {};\r\n\t}\r\n\r\n\tsetupWires() : void {\r\n\t\tfor (const [key, instance] of Object.entries(this._wires)) {\r\n\t\t\tconst column = this.el.querySelector(`[data-wire=\"${key}\"]`);\r\n\t\t\tconst element = column.firstElementChild;\r\n\r\n\t\t\tif (!element) { continue; }\r\n\r\n\t\t\tinstance.setup(element);\r\n\t\t}\r\n\t}\r\n\r\n\tcallWires(method: string, args: Array = []) : void {\r\n\t\tfor (const [, instance] of Object.entries(this._wires)) {\r\n\t\t\tif (typeof instance[method] !== 'function') { return; }\r\n\r\n\t\t\tinstance[method].apply(instance, args);\r\n\t\t}\r\n\t}\r\n\r\n\tvalueFormatted(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst formattedKey = column + '_FORMATTED';\r\n\t\tlet result = '';\r\n\r\n\t\tif (item[column] != null) {\r\n\t\t\tresult = item[column];\r\n\t\t} else if (basketItem[formattedKey] != null) {\r\n\t\t\tresult = basketItem[formattedKey];\r\n\t\t} else if (basketItem[column] != null) {\r\n\t\t\tresult = basketItem[column];\r\n\t\t}\r\n\r\n\t\treturn result !== '' ? result : '&mdash;';\r\n\t}\r\n\r\n\tbasketValue(basketItem: Object, column: string) {\r\n\t\treturn basketItem[column];\r\n\t}\r\n\r\n\tvalue(item: Object, basketItem: Object, column: string) {\r\n\t\tif (item[column] != null) {\r\n\t\t\treturn item[column];\r\n\t\t}\r\n\r\n\t\treturn this.basketValue(basketItem, column);\r\n\t}\r\n\r\n\tgetName(field: string) : string {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\thasAction(type: string) : boolean {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n\r\n\tfire(action: string, data: Object = {}) : void {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBasketItemAction', {\r\n\t\t\tdetail: Object.assign({\r\n\t\t\t\titem: this,\r\n\t\t\t\taction: action,\r\n\t\t\t}, data),\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\t}\r\n\r\n\tgetInputValue(field: string) : ?string {\r\n\t\tconst input = this.getInput(field);\r\n\t\tlet result;\r\n\r\n\t\tif (input == null) { return null; }\r\n\r\n\t\tif (input.type === 'checkbox') {\r\n\t\t\tresult = input.checked ? input.value : null;\r\n\t\t} else {\r\n\t\t\tresult = input.value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetInput(field: string) : HTMLInputElement {\r\n\t\tconst name = this.getName(field);\r\n\r\n\t\treturn this.el.querySelector(`input[name=\"${name}\"]`);\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport BoxField from \"../box/field\";\r\nimport {kebabCase} from \"../utils\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tstatic defaults = Object.assign({}, ItemView.defaults);\r\n\r\n\t_moreDropdown;\r\n\r\n\tdestroy() {\r\n\t\tthis.destroyMoreDropdown();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleMoveClick(true);\r\n\t\tthis.handleMoreClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleMoveClick(false);\r\n\t\tthis.handleMoreClick(false);\r\n\t}\r\n\r\n\thandleInputChange(dir: boolean) : void {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input: HTMLInputElement) => {\r\n\t\t\tif (input.name === this.getName('COUNT')) {\r\n\t\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onCountChange);\r\n\t\t\t}\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleMoveClick(dir: boolean) : void {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX)) { return; }\r\n\r\n\t\tthis.el.querySelector('[data-action=\"up\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoveClick);\r\n\r\n\t\tthis.el.querySelector('[data-action=\"down\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoveClick);\r\n\t}\r\n\r\n\thandleMoreClick(dir: boolean) : void {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return; }\r\n\r\n\t\tthis.el\r\n\t\t\t.querySelector('[data-action=\"more\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoreClick);\r\n\t}\r\n\r\n\tonCountChange = (evt) : void => {\r\n\t\tconst count = parseInt(evt.target.value);\r\n\r\n\t\tif (isNaN(count)) { return; }\r\n\r\n\t\tthis.callWires('updateTotal', [count]);\r\n\t}\r\n\r\n\tonMoveClick = (evt) : void => {\r\n\t\tthis.fire('move', {\r\n\t\t\tdirection: evt.currentTarget.dataset.action,\r\n\t\t});\r\n\t}\r\n\r\n\tonMoreClick = () : void => {\r\n\t\tconst moreDropdown = this.moreDropdown();\r\n\r\n\t\tthis.renewMoreActions(moreDropdown);\r\n\t\tmoreDropdown.popupWindow.show();\r\n\t}\r\n\r\n\tdisableInput(dir: boolean) : void {\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('DELETE')) { return; }\r\n\r\n\t\t\tinput.readonly = dir;\r\n\r\n\t\t\tif (input.classList.contains('ui-ctl-element')) {\r\n\t\t\t\tinput.parentElement.classList.toggle('ui-ctl-disabled', dir);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treplaceName(newName: string) {\r\n\t\tthis.destroyMoreDropdown();\r\n\t\tsuper.replaceName(newName);\r\n\t}\r\n\r\n\tgetCountDiff() : number {\r\n\t\tconst needDelete = this.getInputValue('DELETE');\r\n\t\tconst initialCount = parseInt(this.getInputValue('INITIAL_COUNT'));\r\n\t\tconst count = parseInt(this.getInputValue('COUNT'));\r\n\t\tlet result;\r\n\r\n\t\tif (needDelete) {\r\n\t\t\tresult = initialCount;\r\n\t\t} else {\r\n\t\t\tresult = initialCount - count;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tenableUp(enable: boolean = true) : void {\r\n\t\tthis.el.querySelector('[data-action=\"up\"]').disabled = !enable;\r\n\t}\r\n\r\n\tenableDown(enable: boolean = true) : void {\r\n\t\tthis.el.querySelector('[data-action=\"down\"]').disabled = !enable;\r\n\t}\r\n\t\r\n\tcolumnIndex(item: Object, basketItem: Object, column: string): string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX)) { return super.columnIndex(item, basketItem, column); }\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\"><!--\r\n\t\t\t-->${this.indexHidden(item, basketItem)}<!--\r\n\t\t\t--><button class=\"yamarket-icon-action\" type=\"button\" data-action=\"down\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 11.314 16.657\">\r\n\t\t\t\t\t<path d=\"M4.657 0h2v12.828l3.242-3.242L11.314 11l-5.657 5.657L0 11l1.414-1.414 3.243 3.242V0Z\" fill=\"currentColor\"/>\r\n\t\t\t\t</svg>\r\n\t\t\t</button><!--\r\n\t\t\t--><button class=\"yamarket-icon-action\" type=\"button\" data-action=\"up\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 11.314 17.416\">\r\n\t\t\t\t\t<path d=\"M11.314 5.67 9.896 7.081l-3.255-3.27-.014 13.605-2-.002.014-13.568-3.23 3.215L0 5.644 5.67 0l5.644 5.67Z\" fill=\"currentColor\"/>\r\n\t\t\t\t</svg>\r\n\t\t\t</button><!--\r\n\t\t--></td>`;\r\n\t}\r\n\r\n\tcolumnCount(item: Object, basketItem: Object, column: string) : string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return super.columnCount(item, basketItem, column); }\r\n\r\n\t\tconst value = this.value(item, basketItem, column);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\t\tconst partialCurrent = item?.PARTIAL_COUNT?.CURRENT;\r\n\t\tconst partialTotal = item?.PARTIAL_COUNT?.TOTAL;\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('OFFSET')}\" value=\"${parseInt(this.value(item, basketItem, 'OFFSET')) || 0}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_CURRENT')}\" value=\"${partialCurrent || ''}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_TOTAL')}\" value=\"${partialTotal || ''}\" />\r\n\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\" data-entity=\"COUNT\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tclass=\"ui-ctl-element\"\r\n\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\tname=\"${this.getName('COUNT')}\"\r\n\t\t\t\t\tvalue=\"${valueSanitized}\"\r\n\t\t\t\t\tmin=\"1\"\r\n\t\t\t\t\tmax=\"${valueSanitized}\"\r\n\t\t\t\t\tstep=\"1\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<span data-entity=\"PARTIAL_TEXT\">${this.partialText(partialCurrent, partialTotal)}</span>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tsetCount(count: number) : void {\r\n\t\tthis.getInput('COUNT').value = count;\r\n\t}\r\n\r\n\tsetInitialCount(count: number) {\r\n\t\tthis.getInput('COUNT').max = count;\r\n\t\tsuper.setInitialCount(count);\r\n\t}\r\n\r\n\trenderActions() : string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return ''; }\r\n\r\n\t\treturn `<td class=\"for--delete\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('DELETE')}\" value=\"\" />\r\n\t\t\t<button class=\"yamarket-icon-action\" type=\"button\" data-action=\"more\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 14 3.5\">\r\n\t\t\t\t\t<path d=\"M3.5 1.75C3.5 2.71653 2.7165 3.5 1.75 3.5C0.783501 3.5 0 2.71653 0 1.75C0 0.783475 0.783501 0 1.75 0C2.7165 0 3.5 0.783475 3.5 1.75L3.5 1.75Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t<path d=\"M8.75 1.75C8.75 2.71653 7.96653 3.5 7 3.5C6.03347 3.5 5.25 2.71653 5.25 1.75C5.25 0.783475 6.03347 0 7 0C7.96653 0 8.75 0.783475 8.75 1.75L8.75 1.75Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t<path d=\"M12.25 3.5C13.2165 3.5 14 2.71653 14 1.75C14 0.783475 13.2165 0 12.25 0C11.2835 0 10.5 0.783475 10.5 1.75C10.5 2.71653 11.2835 3.5 12.25 3.5L12.25 3.5Z\" fill=\"currentColor\" />\r\n\t\t\t\t</svg>\r\n\t\t\t</button>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tdestroyMoreDropdown() : void {\r\n\t\tif (this._moreDropdown == null) { return; }\r\n\r\n\t\tBX.PopupMenu.destroy(`${this.options.name}-more`);\r\n\t\tthis._moreDropdown = null;\r\n\t}\r\n\r\n\tmoreDropdown() : BX.PopupMenu {\r\n\t\tif (this._moreDropdown == null) {\r\n\t\t\tthis._moreDropdown = BX.PopupMenu.create(\r\n\t\t\t\t`${this.options.name}-more`,\r\n\t\t\t\tthis.el.querySelector('[data-action=\"more\"]'),\r\n\t\t\t\t[]\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this._moreDropdown;\r\n\t}\r\n\r\n\trenewMoreActions(dropdown: BX.PopupMenu) : void {\r\n\t\tconst previousIds = dropdown.getMenuItems().map((menuItem) => menuItem.id);\r\n\r\n\t\tfor (const previousId of previousIds) {\r\n\t\t\tdropdown.removeMenuItem(previousId, { destroyEmptyPopup: false });\r\n\t\t}\r\n\r\n\t\tfor (const action of this.moreActions(dropdown)) {\r\n\t\t\tdropdown.addMenuItem(action);\r\n\t\t}\r\n\t}\r\n\r\n\tmoreActions(dropdown: BX.PopupMenu) : Array {\r\n\t\treturn (\r\n\t\t\tthis.moreActionsForSplit(dropdown)\r\n\t\t\t\t.concat(this.moreActionsForDelete(dropdown))\r\n\t\t);\r\n\t}\r\n\r\n\tmoreActionsForDelete(dropdown: BX.PopupMenu) : Array {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM) || this.isPart()) { return []; }\r\n\r\n\t\tconst result = [];\r\n\t\tconst deleteInput = this.getInput('DELETE');\r\n\r\n\t\tif (deleteInput.value === 'Y') {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.markDeleted(false);\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_CANCEL_DELETE'),\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.markDeleted(true);\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_DELETE'),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tmoreActionsForSplit(dropdown: BX.PopupMenu) : Array {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX) || this.getInputValue('DELETE') === 'Y') { return []; }\r\n\r\n\t\tconst result = [];\r\n\t\tconst currentInput = this.getInput('PARTIAL_CURRENT');\r\n\r\n\t\tif (currentInput.value > 0) {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.fire('cancelSplit');\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_CANCEL_SPLIT'),\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.fire('split');\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_SPLIT'),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tmarkDeleted(needDelete: boolean = true) : void {\r\n\t\tconst deleteInput = this.getInput('DELETE');\r\n\r\n\t\tdeleteInput.value = needDelete ? 'Y' : '';\r\n\t\tthis.el.classList[needDelete ? 'add' : 'remove']('is--deleted');\r\n\t\tthis.disableInput(needDelete);\r\n\r\n\t\tthis.options.onChange();\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './basket.css';\r\n\r\nexport default class Basket {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tmode: null,\r\n\t\tname: null,\r\n\t\ttitle: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options: Object) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.items = [];\r\n\t\tthis.nextIndex = 0;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tsameBasketItems(basketItem: ItemView) : ItemView[] {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (basketItem.id() === item.id()) {\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcountChanges() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (!(item instanceof ItemEdit)) { continue; }\r\n\r\n\t\t\tconst diff = item.getCountDiff();\r\n\r\n\t\t\tif (diff > 0) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tname: item.getTitle(),\r\n\t\t\t\t\tdiff: diff,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(boxItems: Array, basket: Object) : void {\r\n\t\tthis.renderSelf();\r\n\r\n\t\tthis.renewItems(boxItems.length).forEach((basketItem: ItemView, index: number) : void => {\r\n\t\t\tbasketItem.render(boxItems[index], basket);\r\n\t\t\tbasketItem.mount(this.el);\r\n\t\t});\r\n\t}\r\n\r\n\tmount(point) : void {\r\n\t\tpoint.after(this.el);\r\n\t}\r\n\r\n\trenderSelf() {\r\n\t\tthis.el = htmlToElement(`<tbody></tbody>`, 'table');\r\n\t}\r\n\r\n\trenewItems(count: number) : ItemView[] {\r\n\t\tthis.destroyItems();\r\n\r\n\t\treturn this.createItems(count);\r\n\t}\r\n\r\n\tdestroyItems() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItems(count: number) : ItemView[] {\r\n\t\tthis.items = [];\r\n\r\n\t\tfor (let i = 0; i < count; ++i) {\r\n\t\t\tthis.items.push(this.createItem(i));\r\n\t\t}\r\n\r\n\t\tthis.nextIndex = this.items.length;\r\n\r\n\t\treturn this.items;\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\tif (this.options.mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\tmoveItem(item: ItemView, count: ?number = null) : ItemView {\r\n\t\tconst sameItems = this.sameBasketItems(item);\r\n\r\n\t\tif (sameItems.length > 0) {\r\n\t\t\tconst sameItem = sameItems[0];\r\n\r\n\t\t\tif (count != null) {\r\n\t\t\t\tsameItem.setCount(sameItem.getCount() + count);\r\n\t\t\t\tsameItem.setInitialCount(sameItem.getInitialCount() + count);\r\n\t\t\t} else {\r\n\t\t\t\tsameItem.setCount(sameItem.getCount() + item.getCount());\r\n\t\t\t\tsameItem.setInitialCount(sameItem.getInitialCount() + item.getInitialCount());\r\n\t\t\t}\r\n\r\n\t\t\titem.destroy();\r\n\r\n\t\t\treturn sameItem;\r\n\t\t}\r\n\r\n\t\tthis.items.push(item);\r\n\t\titem.replaceName(`${this.options.name}[${this.nextIndex}]`);\r\n\t\titem.mount(this.el);\r\n\r\n\t\tif (count != null) {\r\n\t\t\titem.setCount(count);\r\n\t\t\titem.setInitialCount(count);\r\n\t\t}\r\n\r\n\t\t++this.nextIndex;\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\tdetachItem(item: ItemView) : void {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t\titem.el.remove();\r\n\t}\r\n}","import { htmlToElement } from \"../utils\";\r\nimport Basket from \"../basket/basket\";\r\n\r\nexport default class ItemView {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.basket.destroy();\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tonlyForPart() : boolean {\r\n\t\tlet result = false;\r\n\r\n\t\tfor (const basketItem of this.basket.items) {\r\n\t\t\tif (basketItem.isPart()) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttitle() : string {\r\n\t\treturn this.el.querySelector('.yamarket-basket-box__title').textContent.trim();\r\n\t}\r\n\r\n\trender(box: Object, basket: Object) : void {\r\n\t\tthis.renderSelf(box, basket);\r\n\t\tthis.renderBasket(box, basket);\r\n\t}\r\n\r\n\trenderSelf(box: Object, basket: Object) : void {\r\n\t\tthis.el = htmlToElement(`<tbody>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"yamarket-basket-box\" colspan=\"${this.columnCount(basket)}\">\r\n\t\t\t\t\t<span class=\"yamarket-basket-box__title\">\r\n\t\t\t\t\t\t${this.getMessage('BOX')}\r\n\t\t\t\t\t\t&numero;${box['NUMBER']}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t${this.buildActions(box)}\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</tbody>`, 'table');\r\n\t}\r\n\r\n\thideSelf() : void {\r\n\t\tthis.el.hidden = true;\r\n\t}\r\n\r\n\trenderBasket(box: Object, basket: Object) : void {\r\n\t\tthis.basket = new Basket(this.basketOptions());\r\n\t\tthis.basket.render(box['ITEMS'] ?? [], basket);\r\n\t}\r\n\r\n\tbasketOptions() : Object {\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\treturn {\r\n\t\t\tname: this.options.name + `[ITEMS]`,\r\n\t\t\tmode: BX.UI.EntityEditorMode.view,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\t}\r\n\r\n\tcolumnCount(basket: Object) : number {\r\n\t\treturn Object.keys(basket.COLUMNS).length + 1;\r\n\t}\r\n\r\n\tbuildActions(box: Object) : string {\r\n\t\treturn '';\r\n\t}\r\n\r\n\tdetach() : void {\r\n\t\tthis.el.remove();\r\n\t\tthis.basket.el.remove();\r\n\t}\r\n\r\n\tmount(point: HTMLElement, after: ?HTMLElement = null) {\r\n\t\tif (after != null) {\r\n\t\t\t(after.nextElementSibling ?? after).after(this.el);\r\n\t\t} else {\r\n\t\t\tpoint.querySelector('table').appendChild(this.el);\r\n\t\t}\r\n\r\n\t\tthis.basket.mount(this.el);\r\n\t}\r\n\r\n\tupdateNumber(number: number) : void {\r\n\t\tconst title = this.el.querySelector('.yamarket-basket-box__title');\r\n\r\n\t\ttitle.innerHTML = `${this.getMessage('BOX')} &numero;${number}`;\r\n\t}\r\n\r\n\tgetName(field: string) : string {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport {collectValues} from \"../utils\";\r\n\r\nexport default class BasketItemMoveModal {\r\n\r\n\tstatic defaults = {\r\n\t\tcount: 0,\r\n\t\tcurrent: null,\r\n\t\tselected: null,\r\n\t\titems: [],\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, BasketItemMoveModal.defaults, options);\r\n\t}\r\n\r\n\tonSaveClick(messageBox, resolve, reject) : void {\r\n\t\tconst values = collectValues(messageBox.popupWindow.contentContainer);\r\n\t\tconst count = parseInt(values['COUNT']) || 0;\r\n\r\n\t\tif (count <= 0) {\r\n\t\t\treject();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tmessageBox.close();\r\n\t\tresolve([\r\n\t\t\tvalues['BOX'] === 'new' ? null : this.options.items[values['BOX']],\r\n\t\t\tcount\r\n\t\t]);\r\n\t}\r\n\r\n\tonCancelClick(messageBox, reject) : void {\r\n\t\tmessageBox.close();\r\n\t\treject();\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options  = this.dialogOptions();\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\t\tmessageBox.setMessage(this.buildForm());\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox, resolve, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogOptions() : Object {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('ITEM_MOVE_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tbuildForm() : string {\r\n\t\tlet foundBox = false;\r\n\r\n\t\treturn `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_MOVE_COUNT')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"number\" name=\"COUNT\" value=\"${parseInt(this.options.count) || 0}\" min=\"1\" max=\"${parseInt(this.options.count) || 0}\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_MOVE_BOX')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"BOX\">\r\n\t\t\t\t\t\t${this.options.items.map((item: ItemView, index: number) : string => {\r\n\t\t\t\t\t\t\tif (item === this.options.current) { return ''; }\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst selected = (item === this.options.selected);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (selected) { foundBox = true; }\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treturn `<option value=\"${index}\" ${selected ? 'selected' : ''}>${item.title()}</option>`;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t<option value=\"new\" ${!foundBox ? 'selected' : ''}>${this.getMessage('ITEM_MOVE_BOX_NEW')}</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","import {collectValues} from \"../utils\";\r\n\r\nexport default class BasketItemSplitModal {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tonSaveClick(messageBox, resolve, reject) : void {\r\n\t\tconst values = collectValues(messageBox.popupWindow.contentContainer);\r\n\t\tconst count = parseInt(values['COUNT']) || 0;\r\n\r\n\t\tmessageBox.close();\r\n\t\tcount >= 2 ? resolve(count) : reject();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, reject) : void {\r\n\t\tmessageBox.close();\r\n\t\treject();\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options  = this.dialogOptions();\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\t\tmessageBox.setMessage(this.buildForm());\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox, resolve, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogOptions() : Object {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('ITEM_SPLIT_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tbuildForm() : string {\r\n\t\treturn `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_SPLIT_COUNT')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"number\" name=\"COUNT\" value=\"2\" min=\"2\" max=\"99\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","export default class BoxOnlyPartDeleteModal {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create();\r\n\r\n\t\t\tmessageBox.setMessage(this.getMessage('BOX_DELETE_PART_BY_MERGE'));\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tmessageBox.close();\r\n\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tmessageBox.close();\r\n\t\t\t\t\t\t\treject();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tthis.handleDeleteClick(false);\r\n\t}\r\n\r\n\thandleDeleteClick(dir: boolean) : void {\r\n\t\tconst button = this.el.querySelector('[data-action=\"DELETE\"]');\r\n\r\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\tonDeleteClick = (evt) => {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBoxDelete', {\r\n\t\t\tdetail: { item: this },\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\trender(box: Object, basket: Object) : void {\r\n\t\tsuper.render(box, basket);\r\n\t\tthis.handleDeleteClick(true);\r\n\t}\r\n\r\n\tcolumnCount(basket: Object) : number {\r\n\t\treturn super.columnCount(basket) + 1;\r\n\t}\r\n\r\n\tenableDelete(enable: boolean) : void {\r\n\t\tconst button = this.el.querySelector('[data-action=\"DELETE\"]');\r\n\r\n\t\tbutton.disabled = !enable;\r\n\t\tbutton.hidden = !enable;\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn `<button\r\n\t\t\tclass=\"yamarket-icon-action\"\r\n\t\t\ttype=\"button\"\r\n\t\t\ttitle=\"${this.getMessage('BOX_DELETE')}\"\r\n\t\t\tdata-action=\"DELETE\"\r\n\t\t>\r\n\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 14 15\">\r\n\t\t\t\t<path d=\"M13.126 1.406v.933a.47.47 0 0 1-.47.469H.47A.47.47 0 0 1 0 2.338v-.932c0-.259.21-.47.47-.47h3.512L4.258.39A.76.76 0 0 1 4.884 0h3.353c.262.014.5.16.63.389l.277.548h3.516a.47.47 0 0 1 .466.47zM.939 3.75h11.25l-.626 9.932A1.424 1.424 0 0 1 10.16 15H2.963a1.424 1.424 0 0 1-1.4-1.318L.94 3.75z\" fill=\"currentColor\" fill-rule=\"evenodd\"/>\r\n\t\t\t</svg>\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbasketOptions(): Object {\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\treturn Object.assign(super.basketOptions(), {\r\n\t\t\tmode: BX.UI.EntityEditorMode.edit,\r\n\t\t});\r\n\t}\r\n}","import Field from \"./field\";\r\nimport ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport BasketItem from \"../basket/itemview\";\r\n\r\nexport default class Collection {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tactions: [],\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\titems: ItemView[];\r\n\tnextIndex: number = 0;\r\n\tanchor: HTMLElement;\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.destroyItems();\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tmovableBox(box: ItemView, direction: boolean) : ?ItemView {\r\n\t\treturn direction ? this.nextMovableBox(box) : this.previousMovableBox(box);\r\n\t}\r\n\r\n\tpreviousMovableBox(box: ItemView) : ?ItemView {\r\n\t\tlet previous;\r\n\t\tlet result;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (item === box) {\r\n\t\t\t\tresult = previous;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (!item.onlyForPart()) {\r\n\t\t\t\tprevious = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tnextMovableBox(box: ItemView) : ?ItemView {\r\n\t\tlet found = false;\r\n\t\tlet result;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (found && !item.onlyForPart()) {\r\n\t\t\t\tresult = item;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (item === box) {\r\n\t\t\t\tfound = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(boxes: Array, basket: Object, mode: number) : void {\r\n\t\tconst items = [];\r\n\t\tlet index = 0;\r\n\r\n\t\tthis.destroyItems();\r\n\r\n\t\tfor (const one of boxes) {\r\n\t\t\tconst box = this.createItem(index, mode);\r\n\r\n\t\t\tbox.render(one, basket);\r\n\t\t\titems.push(box);\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tthis.items = items;\r\n\t\tthis.nextIndex = index;\r\n\t}\r\n\r\n\tmount(point: HTMLElement) : void {\r\n\t\tthis.anchor = point;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.mount(point);\r\n\t\t}\r\n\t}\r\n\r\n\taddItem(basket: Object, mode: number) : ItemView {\r\n\t\tconst number = this.items.length + 1;\r\n\t\tconst box = this.createItem(this.nextIndex, mode);\r\n\t\tconst last = this.items[this.items.length - 1]?.el;\r\n\r\n\t\tbox.render({ 'NUMBER': number }, basket);\r\n\t\tbox.mount(this.anchor, last);\r\n\r\n\t\tthis.items.push(box);\r\n\t\t++this.nextIndex;\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tdestroyItems() : void {\r\n\t\tif (this.items == null) { return; }\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItem(index: number, mode: number) : ItemView {\r\n\t\tconst options = {\r\n\t\t\tname: this.options.name + `[${index}]`,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\tif (mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\tdeleteItem(item: ItemView) : void {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t\titem.detach();\r\n\t\titem.destroy();\r\n\t}\r\n\r\n\trefresh(basketItem: BasketItem = null) : void {\r\n\t\tif (basketItem != null) {\r\n\t\t\tthis.refreshBasketOffset(basketItem);\r\n\t\t}\r\n\r\n\t\tthis.refreshBoxDelete();\r\n\t\tthis.refreshBasketMove();\r\n\t\tthis.refreshNumber();\r\n\t}\r\n\r\n\trefreshNumber() : void {\r\n\t\tlet num = 1;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tbox.updateNumber(num);\r\n\t\t\t++num;\r\n\t\t}\r\n\t}\r\n\r\n\tbasketItemBox(basketItem: BasketItem) : ItemView {\r\n\t\tlet result;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tfor (const sibling of box.basket.items) {\r\n\t\t\t\tif (sibling === basketItem) {\r\n\t\t\t\t\tresult = box;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (result != null) { break; }\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trefreshBoxDelete() : void {\r\n\t\tconst canDelete = (this.items.length > 1);\r\n\t\tconst canEdit = (this.options.actions.indexOf(Field.ACTION_BOX) !== -1);\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tif (!canDelete && !canEdit) {\r\n\t\t\t\tbox.hideSelf();\r\n\t\t\t} else if (box instanceof ItemEdit) {\r\n\t\t\t\tbox.enableDelete(canDelete);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trefreshBasketMove() : void {\r\n\t\tif ((this.options.actions.indexOf(Field.ACTION_BOX) === -1)) { return; }\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tconst onlyForPart = box.onlyForPart();\r\n\t\t\tconst hasPrevious = (!onlyForPart && this.previousMovableBox(box) != null);\r\n\t\t\tconst hasNext = (!onlyForPart && this.nextMovableBox(box) != null);\r\n\r\n\t\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\t\tbasketItem.enableUp(hasPrevious);\r\n\t\t\t\tbasketItem.enableDown(\r\n\t\t\t\t\thasNext\r\n\t\t\t\t\t|| (\r\n\t\t\t\t\t\t!onlyForPart\r\n\t\t\t\t\t\t&& (box.basket.items.length > 1 || basketItem.getCount() > 1)\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsameBasketItems(basketItem: BasketItem) : BasketItem[] {\r\n\t\tlet result = [];\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tresult = result.concat(box.basket.sameBasketItems(basketItem));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trefreshBasketOffset(basketItem: BasketItem) : void {\r\n\t\tconst sameItems = this.sameBasketItems(basketItem);\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor (const sameItem of sameItems) {\r\n\t\t\tsameItem.setOffset(offset);\r\n\r\n\t\t\tif (!sameItem.isPart() || sameItem.isFinalPart()) {\r\n\t\t\t\toffset += sameItem.getInitialCount();\r\n\t\t\t}\r\n\r\n\t\t\tsameItem.updateCisCount();\r\n\t\t}\r\n\t}\r\n\r\n}","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement, kebabCase} from \"../utils\";\r\nimport ItemView from './itemview';\r\nimport BasketItem from '../basket/itemview';\r\nimport BasketItemMoveModal from \"./basketitemmovemodal\";\r\nimport BasketItemSplitModal from \"./basketitemsplitmodal\";\r\nimport BoxOnlyPartDeleteModal from \"./boxonlypartdeletemodal\";\r\nimport Collection from \"./collection\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic ACTION_BOX = 'box';\r\n\tstatic ACTION_ITEM = 'item';\r\n\tstatic ACTION_CIS = 'cis';\r\n\tstatic ACTION_DIGITAL = 'digital';\r\n\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BOX',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tboxCollection: Collection;\r\n\tpayloadBasket: Object;\r\n\r\n\tstatic create(id, settings) : Field {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleBoxDelete(true);\r\n\t\tthis.handleBasketItemAction(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tthis.handleBoxDelete(false);\r\n\t\tthis.handleBasketItemAction(false);\r\n\t}\r\n\r\n\thandleBoxDelete(dir: boolean) : void {\r\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('yamarketBoxDelete', this.onBoxDelete);\r\n\t}\r\n\r\n\thandleBasketItemAction(dir: boolean) {\r\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('yamarketBasketItemAction', this.onBasketItemAction);\r\n\t}\r\n\r\n\tonChange = () => {\r\n\t\tif (\r\n\t\t\tthis._mode !== BX.UI.EntityEditorMode.edit\r\n\t\t\t&& (this.hasAction(Field.ACTION_CIS) || this.hasAction(Field.ACTION_DIGITAL))\r\n\t\t) {\r\n\t\t\tthis._mode = BX.UI.EntityEditorMode.edit;\r\n\t\t\tthis._editor.showToolPanel();\r\n\t\t\tthis._editor.registerActiveControl(this);\r\n\t\t}\r\n\r\n\t\tthis._changeHandler();\r\n\t}\r\n\r\n\tonBoxDelete = (evt) => {\r\n\t\tconst box: ItemView = evt.detail.item;\r\n\r\n\t\tif (box.onlyForPart()) {\r\n\t\t\t(new BoxOnlyPartDeleteModal({ messages: Field.messages }))\r\n\t\t\t\t.open()\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\t\t\t\tthis.cancelSplitBasketItem(basketItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst newBox = this.boxCollection.previousMovableBox(box) ?? this.boxCollection.nextMovableBox(box);\r\n\r\n\t\tif (newBox == null) { return; }\r\n\r\n\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\tthis.moveBasketItem(basketItem, newBox);\r\n\t\t}\r\n\r\n\t\tthis.boxCollection.deleteItem(box);\r\n\t\tthis.boxCollection.refresh();\r\n\t\tthis.onChange();\r\n\t}\r\n\r\n\tonBasketItemAction = (evt) : void => {\r\n\t\tconst basketItem = evt.detail.item;\r\n\t\tconst action = evt.detail.action;\r\n\r\n\t\tif (action === 'cisUpdate') {\r\n\t\t\tthis.copyCis(basketItem);\r\n\t\t} else if (action === 'move') {\r\n\t\t\tthis.startMoveBasketItem(basketItem, evt.detail.direction === 'down');\r\n\t\t} else if (action === 'split') {\r\n\t\t\tthis.startSplitBasketItem(basketItem);\r\n\t\t} else if (action === 'cancelSplit') {\r\n\t\t\tthis.cancelSplitBasketItem(basketItem);\r\n\t\t}\r\n\t}\r\n\r\n\tcountChanges() : Array {\r\n\t\tlet result = [];\r\n\r\n\t\tfor (const box of this.boxCollection.items) {\r\n\t\t\tresult = result.concat(box.basket.countChanges());\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcopyCis(basketItem: BasketItem) : void {\r\n\t\tconst siblings = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tconst values = basketItem.cis()?.getValues();\r\n\r\n\t\tif (siblings.length <= 1 || values == null) { return; }\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (sibling === basketItem) { continue; }\r\n\r\n\t\t\tsibling.cis()?.setValues(values);\r\n\t\t}\r\n\t}\r\n\r\n\tstartMoveBasketItem(basketItem: BasketItem, direction: boolean) : void {\r\n\t\tconst oldBox = this.boxCollection.basketItemBox(basketItem);\r\n\t\tconst selectedBox = this.boxCollection.movableBox(oldBox, direction);\r\n\t\tconst count = basketItem.getCount();\r\n\r\n\t\tif (basketItem.getCount() <= 1) {\r\n\t\t\tconst newItem = this.moveBasketItem(basketItem, selectedBox ?? this.addBox());\r\n\r\n\t\t\tthis.afterMoveBasketItem(newItem);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t(new BasketItemMoveModal({\r\n\t\t\tcount: count,\r\n\t\t\tcurrent: oldBox,\r\n\t\t\tselected: selectedBox,\r\n\t\t\titems: this.boxCollection.items,\r\n\t\t\tmessages: Field.messages,\r\n\t\t}))\r\n\t\t\t.open()\r\n\t\t\t.then((resolved: Array) : void => {\r\n\t\t\t\tlet [newBox: ?ItemView, moveCount: number] = resolved;\r\n\t\t\t\tlet newItem;\r\n\r\n\t\t\t\tif (newBox == null) { newBox = this.addBox(); }\r\n\r\n\t\t\t\tif (moveCount < count) {\r\n\t\t\t\t\tnewItem = this.moveBasketItem(basketItem, newBox, moveCount, true);\r\n\r\n\t\t\t\t\tbasketItem.setCount(basketItem.getCount() - moveCount);\r\n\t\t\t\t\tbasketItem.setInitialCount(basketItem.getInitialCount() - moveCount);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewItem = this.moveBasketItem(basketItem, newBox);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.afterMoveBasketItem(newItem);\r\n\t\t\t});\r\n\t}\r\n\r\n\tmoveBasketItem(basketItem: BasketItem, newBox: ItemView, count: ?number = null, needClone: boolean = false) : BasketItem {\r\n\t\tif (needClone) {\r\n\t\t\t basketItem = basketItem.clone();\r\n\t\t} else {\r\n\t\t\tconst oldBox = this.boxCollection.basketItemBox(basketItem);\r\n\r\n\t\t\toldBox.basket.detachItem(basketItem);\r\n\r\n\t\t\tif (oldBox.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(oldBox);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newBox.basket.moveItem(basketItem, count);\r\n\t}\r\n\r\n\tafterMoveBasketItem(basketItem: BasketItem) : void {\r\n\t\tthis.boxCollection.refresh(basketItem);\r\n\t\tthis.onChange();\r\n\t}\r\n\r\n\tstartSplitBasketItem(basketItem: BasketItem) : void {\r\n\t\t(new BasketItemSplitModal({ messages: Field.messages }))\r\n\t\t\t.open()\r\n\t\t\t.then((count: number) : void => this.splitBasketItem(basketItem, count));\r\n\t}\r\n\r\n\tsplitBasketItem(basketItem: BasketItem, total: number) : void {\r\n\t\tconst [deletedCount, deletedInitialCount] = this.removeBasketItemSiblings(basketItem);\r\n\t\tconst count = (basketItem.getCount() || 1) + deletedCount;\r\n\t\tconst initialCount = (basketItem.getInitialCount() || 1) + deletedInitialCount;\r\n\r\n\t\tfor (let productIndex = 0; productIndex < count; ++productIndex) {\r\n\t\t\tfor (let i = 0; i < total; ++i) {\r\n\t\t\t\tconst isSelf = (productIndex === 0 && i === 0);\r\n\t\t\t\tconst box = this.addBox();\r\n\t\t\t\tconst newItem = this.moveBasketItem(basketItem, box, 1, !isSelf);\r\n\r\n\t\t\t\tnewItem.setPart(i, total);\r\n\r\n\t\t\t\tif (productIndex === 0) {\r\n\t\t\t\t\tnewItem.setInitialCount(1 + (initialCount - count));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.afterMoveBasketItem(basketItem);\r\n\t}\r\n\r\n\tremoveBasketItemSiblings(basketItem: BasketItem) : [number, number] {\r\n\t\tconst sameItems = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tlet deletedCount = 0;\r\n\t\tlet deletedInitialCount = 0;\r\n\r\n\t\tfor (const sameItem of sameItems) {\r\n\t\t\tif (sameItem === basketItem) { continue; }\r\n\r\n\t\t\tconst box = this.boxCollection.basketItemBox(sameItem);\r\n\r\n\t\t\tdeletedCount += sameItem.getCount() || 0;\r\n\t\t\tdeletedInitialCount += sameItem.getInitialCount() || 0;\r\n\r\n\t\t\tbox.basket.detachItem(sameItem);\r\n\r\n\t\t\tif (box.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(box);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [deletedCount, deletedInitialCount];\r\n\t}\r\n\r\n\tcancelSplitBasketItem(basketItem: BasketItem) : void {\r\n\t\tconst siblings = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tconst [count, initialCount] = this.countSiblings(siblings);\r\n\t\tlet firstSibling = null;\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (firstSibling == null) {\r\n\t\t\t\tconst box = this.boxCollection.basketItemBox(sibling);\r\n\t\t\t\tconst previousBox = this.boxCollection.previousMovableBox(box) ?? this.boxCollection.nextMovableBox(box);\r\n\r\n\t\t\t\tsibling.resetPart();\r\n\t\t\t\tsibling.setCount(count);\r\n\t\t\t\tsibling.setInitialCount(initialCount);\r\n\t\t\t\tsibling.setOffset(0);\r\n\t\t\t\tsibling.updateCisCount();\r\n\r\n\t\t\t\tif (previousBox != null) {\r\n\t\t\t\t\tthis.moveBasketItem(sibling, previousBox);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfirstSibling = sibling;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst box = this.boxCollection.basketItemBox(sibling);\r\n\r\n\t\t\tbox.basket.detachItem(sibling);\r\n\r\n\t\t\tif (box.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(box);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfirstSibling && this.afterMoveBasketItem(firstSibling);\r\n\t}\r\n\r\n\tcountSiblings(siblings: BasketItem[]) : [number, number] {\r\n\t\tlet count = 0;\r\n\t\tlet initialCount = 0;\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (!sibling.isPart() || sibling.isFinalPart()) {\r\n\t\t\t\tcount += sibling.getCount() || 0;\r\n\t\t\t\tinitialCount += sibling.getInitialCount() || 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [count, initialCount];\r\n\t}\r\n\r\n\taddBox() : ItemView {\r\n\t\treturn this.boxCollection.addItem(this.payloadBasket, this._mode);\r\n\t}\r\n\r\n\trender(payload: Object) : void {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.options.actions = payload.ACTIONS;\r\n\t\tthis.payloadBasket = payload.BASKET;\r\n\r\n\t\tthis.renderSelf(payload['BOX'].length);\r\n\t\tthis.renderBoxes(payload['BOX']);\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\trenderSelf(boxCount: number) : void {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-basket\">\r\n\t\t\t<input type=\"hidden\" name=\"BOX_INITIAL_COUNT\" value=\"${boxCount}\" />\r\n\t\t\t<div class=\"yamarket-basket-table-viewport\">\r\n\t\t\t\t<table class=\"yamarket-basket-table\">\r\n\t\t\t\t\t${this.renderHeader()}\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t${this.renderSummary()}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\trenderHeader() : string {\r\n\t\treturn `<thead>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"for--index\">&numero;</td>\r\n\t\t\t\t${Object.keys(this.payloadBasket.COLUMNS)\r\n\t\t\t\t\t.map((key) => `<td class=\"for--${kebabCase(key)}\">${this.columnTitle(key)}</td>`)\r\n\t\t\t\t\t.join('')}\r\n\t\t\t\t${this.isInEditMode() && this.hasAction(Field.ACTION_ITEM) ? '<td class=\"for--delete\">&nbsp;</td>' : ''}\r\n\t\t\t</tr>\r\n\t\t</thead>`;\r\n\t}\r\n\r\n\tcolumnTitle(key: string) : string {\r\n\t\tconst langKey = 'HEADER_' + key;\r\n\t\tconst lang = this.getMessage(langKey);\r\n\r\n\t\treturn lang !== langKey ? lang : this.payloadBasket.COLUMNS[key];\r\n\t}\r\n\r\n\trenderSummary() : string {\r\n\t\tif (this.payloadBasket.SUMMARY.length === 0) { return ''; }\r\n\r\n\t\treturn `<div class=\"yamarket-basket-summary\">\r\n\t\t\t${this.payloadBasket.SUMMARY\r\n\t\t\t\t.map((item) => {\r\n\t\t\t\t\treturn `<div class=\"yamarket-basket-summary__row\">\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__label\">${item['NAME']}:</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__value\">${item['VALUE']}</div>\r\n\t\t\t\t\t</div>`;\r\n\t\t\t\t})\r\n\t\t\t\t.join('')}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\trenderBoxes(boxes: Array) : void {\r\n\t\tthis.boxCollection?.destroy();\r\n\r\n\t\tthis.boxCollection = new Collection({\r\n            name: this.options.name,\r\n            messages: Field.messages,\r\n            actions: this.options.actions,\r\n            onChange: this.onChange,\r\n        });\r\n\t\tthis.boxCollection.render(boxes, this.payloadBasket, this._mode);\r\n\t\tthis.boxCollection.refreshBasketMove();\r\n\t\tthis.boxCollection.refreshBoxDelete();\r\n\t\tthis.boxCollection.mount(this.el);\r\n\t}\r\n\r\n\thasAction(type: string) : boolean {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}\r\n","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement, collectValues, fillValues} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET_CONFIRM',\r\n\t\treasons: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tvalidate(validator) {\r\n\t\tconst box = this._parent.getChildById('BOX');\r\n\r\n\t\tif (box == null) { return; }\r\n\r\n\t\tconst countChanges = box.countChanges();\r\n\r\n\t\tif (countChanges.length === 0) { return; }\r\n\r\n\t\tthis.resetValues();\r\n\r\n\t\treturn this.showDialog(countChanges, validator);\r\n\t}\r\n\r\n\tresetValues() {\r\n\t\tfillValues(this.el, {\r\n\t\t\t[`${this.options.name}[ALLOW_REMOVE]`]: '',\r\n\t\t});\r\n\t}\r\n\r\n\tshowDialog(countChanges, validator) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create({\r\n\t\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t\t\tmessage: this.dialogBody(countChanges),\r\n\t\t\t});\r\n\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SendButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSendClick.bind(this, messageBox, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, validator, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogBody(countChanges) {\r\n\t\treturn `\r\n\t\t\t${this.options.reasons.length > 0 ? `\r\n\t\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('REASON')}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t\t${this.reasonControl()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t` : ''}\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('PRODUCTS')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.productsControl(countChanges)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-alert ui-alert-warning\">${this.getMessage('FORM_INTRO')}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\treasonControl() {\r\n\t\treturn `<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t<select class=\"ui-ctl-element\" name=\"${this.options.name}[REASON]\">\r\n\t\t\t\t${this.options.reasons.map((option) => `<option value=\"${option['ID']}\">${option['VALUE']}</option>`).join('')}\r\n\t\t\t</select>\r\n\t\t</div>`\r\n\t}\r\n\r\n\tproductsControl(changes) {\r\n\t\treturn changes\r\n\t\t\t.map((change) => {\r\n\t\t\t\treturn this.getMessage('ITEM_CHANGE', {\r\n\t\t\t\t\tNAME: change.name,\r\n\t\t\t\t\tCOUNT: change.diff,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.join('<hr />');\r\n\t}\r\n\r\n\tonSendClick(messageBox, resolve) {\r\n\t\tfillValues(this.el, Object.assign(collectValues(messageBox.popupWindow.contentContainer), {\r\n\t\t\t[`${this.options.name}[ALLOW_REMOVE]`]: 'Y',\r\n\t\t}));\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, validator, resolve) {\r\n\t\tconst error = BX.UI.EntityValidationError.create({\r\n\t\t\tfield: this,\r\n\t\t});\r\n\r\n\t\tthis.resetValues();\r\n\t\tvalidator.addError(error);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.el = htmlToElement(`<div class=\"ui-helper-hidden\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[REASON]\" value=\"\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[ALLOW_REMOVE]\" value=\"\" />\r\n\t\t</div>`)\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\treasons: payload['ITEMS_CHANGE_REASON'],\r\n\t\t});\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tbroadcastElement: '#YAMARKET_ORDER_VIEW',\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tuseTitle() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleActivityEnd(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleActivityEnd(false);\r\n\t}\r\n\r\n\thandleActivityEnd(dir) {\r\n\t\tif (this._activityType == null) { return; }\r\n\r\n\t\tconst broadcast = this.getElement('broadcast');\r\n\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](broadcast, 'yamarketActivitySubmitEnd', this.onActivityEnd);\r\n\t}\r\n\r\n\tonActivityEnd = (type) => {\r\n\t\tif (!this.isMatchActivity(type)) { return; }\r\n\r\n\t\tthis._editor.reload();\r\n\t}\r\n\r\n\tisMatchActivity(type) {\r\n\t\tif (type == null) { return false; }\r\n\r\n\t\treturn (\r\n\t\t\ttype === this._activityType\r\n\t\t\t|| type.indexOf(this._activityType + (this._activityType.indexOf('|') === -1 ? '|' : '.')) === 0\r\n\t\t);\r\n\t}\r\n\r\n\tforget() {\r\n\t\tif (!this.el) { return; }\r\n\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst html = this.build(payload);\r\n\r\n\t\tthis._activityType = payload?.ACTIVITY_ACTION?.TYPE;\r\n\r\n\t\tthis.el = htmlToElement(html);\r\n\t\tthis.bind();\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\tbuild(payload) {\r\n\t\tconst activity = payload['ACTIVITY_ACTION'];\r\n\r\n\t\treturn `<div class=\"ui-entity-editor-content-block\">\r\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\r\n\t\t\t\t${BX.util.htmlspecialchars(payload['VALUE'])}\r\n\t\t\t\t${activity ? this.buildActivity(activity, payload) : ''}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildActivity(activity, property) {\r\n\t\tconst title = activity['TEXT'] !== property['NAME'] ? activity['TEXT'] : this.getMessage('ACTIVITY_APPLY');\r\n\t\tconst onclick = this.makeActivityMethod(activity);\r\n\r\n\t\treturn `<small>\r\n\t\t\t<a href=\"#\" onclick='${onclick}; return false'>${title}</a>\r\n\t\t</small>`;\r\n\t}\r\n\r\n\tmakeActivityMethod(activity) {\r\n\t\tlet result;\r\n\r\n\t\tif (activity['MENU'] != null) {\r\n\t\t\tconst items = activity['MENU'].map((action) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttext: action['TEXT'],\r\n\t\t\t\t\tonclick: action['METHOD'],\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tresult = `BX.PopupMenu.show(\"${activity['TYPE']}\", this, ${JSON.stringify(items)}, { angle: { offset: 50 } })`;\r\n\t\t} else {\r\n\t\t\tresult = activity['METHOD'];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './print.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\turl: null,\r\n\t\twidth: 400,\r\n\t\theight: 300,\r\n\t\titems: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbindDocumentsClick() {\r\n\t\tthis._wrapper.querySelectorAll('.yamarket-print__link').forEach((link) => {\r\n\t\t\tlink.addEventListener('click', this.onDocumentClick);\r\n\t\t});\r\n\t}\r\n\r\n\tonDocumentClick = (evt) => {\r\n\t\tconst link = evt.currentTarget;\r\n\t\tconst type = link.dataset.type;\r\n\t\tconst item = this.getItem(type);\r\n\t\tconst url = this.buildDocumentUrl(type);\r\n\t\tconst dialog = this.createDialog(url, item);\r\n\r\n\t\tdialog.Show();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tgetItem(type) {\r\n\t\tlet result;\r\n\r\n\t\tfor (const document of this.options.items) {\r\n\t\t\tif (document['TYPE'] === type) {\r\n\t\t\t\tresult = document;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildDocumentUrl(type) {\r\n\t\tconst url = this.options.url;\r\n\r\n\t\treturn (\r\n\t\t\turl\r\n\t\t\t+ (url.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'type=' + type\r\n\t\t);\r\n\t}\r\n\r\n\tcreateDialog(url, item) {\r\n\t\treturn new BX.YandexMarket.PrintDialog({\r\n\t\t\ttitle: item.DIALOG_TITLE || item.TITLE,\r\n\t\t\tcontent_url: url,\r\n\t\t\twidth: item.WIDTH || this.options.width,\r\n\t\t\theight: item.HEIGHT || this.options.height,\r\n\t\t\tbuttons: [\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnSave,\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnCancel\r\n\t\t\t]\r\n\t\t});\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.extendOptions(value);\r\n\r\n\t\tthis.renderIntro();\r\n\t\tthis.renderDocuments(value['ITEMS']);\r\n\r\n\t\tthis.bindDocumentsClick();\r\n\t}\r\n\r\n\textendOptions(value) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\turl: value['URL'],\r\n\t\t\titems: value['ITEMS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenderIntro() {\r\n\t\tconst element = htmlToElement(`<p class=\"yamarket-print__intro\">${this.getMessage('INTRO')}</p>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n\r\n\trenderDocuments(items) {\r\n\t\tif (!Array.isArray(items)) { return; }\r\n\r\n\t\tconst element = htmlToElement(`<ul class=\"yamarket-print__documents\">\r\n\t\t\t${items.map((document) => `<li class=\"yamarket-print__document\">\r\n\t\t\t\t<a class=\"yamarket-print__link\" href=\"#\" data-type=\"${document['TYPE']}\">${document['TITLE']}</a>\r\n\t\t\t</li>`).join('')}\r\n\t\t</ul>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport './notification.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tif (!Array.isArray(value)) { return; }\r\n\r\n\t\tconst html = value.map((one) => `<div class=\"ui-alert ui-alert-${one.type}\">${one.text}</div>`).join('');\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n}","import Factory from \"./factory\";\r\nimport Box from \"./box/field\";\r\nimport BasketConfirm from \"./basketconfirm/field\";\r\nimport Property from \"./property/field\";\r\nimport Print from \"./print/field\";\r\nimport Notification from \"./notification/field\";\r\nimport Editor from \"./compatible/editor\";\r\nimport './common.css';\r\n\r\n// factory\r\n\r\nconst factory = new Factory({\r\n\tmap: {\r\n\t\tnotification: Notification,\r\n\t\tbox: Box,\r\n\t\tbasket_confirm: BasketConfirm,\r\n\t\tproperty: Property,\r\n\t\tprint: Print,\r\n\t},\r\n});\r\n\r\nfactory.register();\r\n\r\n// compatible\r\n\r\nconst editor = new Editor();\r\n\r\neditor.start();\r\n\r\nexport {\r\n\tNotification,\r\n\tBasketConfirm,\r\n\tBox,\r\n\tProperty,\r\n\tPrint,\r\n};","export default class Editor {\r\n\r\n\tstart() {\r\n\t\tthis.storeOriginDefault();\r\n\t\tthis.handleEditorInit();\r\n\t}\r\n\r\n\thandleEditorInit() {\r\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditor:onInit', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (editor, data) => {\r\n\t\tif (data.id !== 'yamarket_order_tab') { return; }\r\n\r\n\t\tthis.overrideEditor(editor);\r\n\t\tthis.overrideEditorAjax(editor);\r\n\t\tthis.restoreOriginDefault();\r\n\t}\r\n\r\n\tstoreOriginDefault() {\r\n\t\tthis._originDefault = BX?.UI?.EntityEditor?.getDefault();\r\n\t}\r\n\r\n\trestoreOriginDefault() {\r\n\t\tif (this._originDefault == null) { return; }\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tBX?.UI?.EntityEditor?.setDefault(this._originDefault);\r\n\t\t});\r\n\t}\r\n\r\n\toverrideEditor(editor) {\r\n\t\tconst createAjaxForm = editor.createAjaxForm;\r\n\r\n\t\tObject.assign(editor, {\r\n\t\t\tvalidate: this.editorValidate.bind(this, editor),\r\n\t\t\tcreateAjaxForm: this.editorCreateAjaxForm.bind(this, editor, createAjaxForm),\r\n\t\t});\r\n\t}\r\n\r\n\teditorValidate(editor, result) {\r\n\t\tconst validator = BX.UI.EntityAsyncValidator.create();\r\n\r\n\t\tfor (const control of editor._activeControls) {\r\n\t\t\tvalidator.addResult(control.validate(result));\r\n\t\t}\r\n\r\n\t\tif (this._userFieldManager) {\r\n\t\t\tvalidator.addResult(this._userFieldManager.validate(result));\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(validator.validate());\r\n\t}\r\n\r\n\teditorCreateAjaxForm(editor, parentMethod, options, callbacks) {\r\n\t\tconst result = parentMethod.call(editor, options, callbacks);\r\n\r\n\t\tthis.overrideAjaxForm(result);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toverrideEditorAjax(editor) {\r\n\t\tthis.overrideAjaxForm(editor._ajaxForm);\r\n\t}\r\n\r\n\toverrideAjaxForm(ajaxForm) {\r\n\t\tif (!ajaxForm || !BX?.UI?.ComponentAjax || !(ajaxForm instanceof BX.UI.ComponentAjax)) { return; }\r\n\r\n\t\tObject.assign(ajaxForm, {\r\n\t\t\tdoSubmit: this.ajaxFormDoSubmit,\r\n\t\t});\r\n\t}\r\n\r\n\tajaxFormDoSubmit(options) {\r\n\t\tconst formData = this._elementNode\r\n\t\t\t? BX.ajax.prepareForm(this._elementNode)\r\n\t\t\t: {data : BX.clone(this._formData), filesCount : 0};\r\n\r\n\t\tif (BX.type.isPlainObject(options.data)) {\r\n\t\t\tfor (const i in options.data) {\r\n\t\t\t\tif (!options.data.hasOwnProperty(i)) { continue; }\r\n\r\n\t\t\t\tformData.data[i] = options.data[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst resultData = formData.filesCount > 0 ? this.makeFormData(formData) : formData;\r\n\r\n\t\tBX.ajax.runComponentAction(this._className, this._actionName, {\r\n\t\t\tmode: 'ajax',\r\n\t\t\tsignedParameters: this._signedParameters,\r\n\t\t\tdata: resultData,\r\n\t\t\tgetParameters: this._getParameters\r\n\t\t})\r\n\t\t\t.then((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onSuccess\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmit\",\r\n\t\t\t\t\t[ response[\"data\"][\"ENTITY_DATA\"], response ]\r\n\t\t\t\t);\r\n\t\t\t\tcallback(response[\"data\"]);\r\n\t\t\t})\r\n\t\t\t.catch((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onFailure\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tvar messages = [];\r\n\t\t\t\tvar errors = response[\"errors\"];\r\n\t\t\t\tfor(var i = 0, length = errors.length; i < length; i++) {\r\n\t\t\t\t\tmessages.push(errors[i][\"message\"]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmitFailure\",\r\n\t\t\t\t\t[ response[\"errors\"] ]\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcallback({ \"ERRORS\": messages });\r\n\t\t\t});\r\n\t}\r\n\r\n}"],"names":["BX","window","Factory","constructor","options","onEditorInit","factory","event","methods","this","name","build","handleEditorInit","type","controlId","settings","prefix","indexOf","internalType","substr","length","map","hasOwnProperty","create","Object","assign","defaults","register","isEditorInitialized","registerEditorMethod","UI","_BX$UI","EntityEditorControlFactory","_BX$UI$EntityEditorCo","initialized","registerFactoryMethod","dir","htmlToElement","html","tag","renderer","document","createElement","innerHTML","firstElementChild","kebabCase","str","split","word","index","toLowerCase","join","copyValues","from","to","fillValues","collectValues","container","inputs","findInputs","result","input","entries","tagName","option","querySelectorAll","selected","value","values","isChanged","Boolean","replaceTemplateVariables","template","variables","key","replace","Field","EntityEditorField","_hasLayout","getMessage","replaces","messages","super","clearLayout","forget","_wrapper","layout","ensureWrapperCreated","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","appendChild","createDragButton","useTitle","title","getTitle","createTitleNode","render","getValue","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","payload","fewElements","selector","getElementSelector","el","getElement","querySelector","SummarySkeleton","onStatusClick","evt","openDialog","preventDefault","clone","bind","handleStatusClick","status","setup","element","replaceName","oldName","newName","buildStatus","buildForm","cises","optionValue","getStatus","reflowStatus","formValue","setAttribute","textContent","Error","useFormValue","reflowForm","modal","dialogOptions","messageBox","Dialogs","MessageBox","setMessage","cloneNode","setButtons","SaveButton","events","click","onSaveClick","CancelButton","onCancelClick","show","popupWindow","contentContainer","onChange","close","STATUS_READY","STATUS_WAIT","STATUS_OPTIONAL","STATUS_EMPTY","modalElement","statusElement","inputElement","Cis","onCopyClick","copyInternal","handleCopyClick","copy","updateTotal","count","updateCount","offset","requiredTypes","internalCises","emptyValues","buildCopyIcon","total","parseInt","iterator","Array","fill","types","dummy","hidden","one","placeholder","hasMessage","inputName","util","htmlspecialchars","includes","fixedCisType","typeVariant","filled","optional","filledCount","empty","trim","optionalTypes","itemFilled","itemOptional","setValues","getValues","makeInputValues","selfName","bracketPosition","substring","needAll","disabled","String","dataset","optionKey","instances","fixedType","cisTypes","isArray","instance","valueType","markingType","instanceTypes","slice","foundCis","optionalIndex","splice","unshift","markingGroup","push","minWidth","Math","max","min","keyWithPrefix","copyElement","internalInstances","Digital","buildFormCodes","buildFormAdditional","hasFew","oneValue","ITEM","fieldset","isItemsFilled","filterFilledItems","isSlipFilled","items","item","slip","rawValues","base","keyRelative","keyChain","valueKeyChain","setValueByKeyChain","parts","part","chain","lastKey","pop","level","nextKey","test","toTree","ItemView","_wires","destroy","unbind","forgetWires","cloned","wire","setupWires","id","getInputValue","basket","columns","keys","COLUMNS","basketItem","ITEMS","BASKET_KEY","PARTIAL_COUNT","CURRENT","renderColumn","renderActions","mount","point","column","method","toUpperCase","columnDefault","enableUp","enable","enableDown","columnIndex","indexHidden","valueFormatted","identifiersCount","getName","columnCis","cis","basketValue","fire","updateCisCount","getCount","getOffset","columnDigital","digital","columnSubsidy","promos","content","promo","columnCount","valueSanitized","partialCurrent","_item$PARTIAL_COUNT2","partialTotal","_item$PARTIAL_COUNT3","TOTAL","partialText","setCount","getInput","text","setInitialCount","getInitialCount","setOffset","resetPart","classList","remove","setPart","add","current","isPart","isFinalPart","callWires","args","apply","formattedKey","field","hasAction","actions","action","data","dispatchEvent","CustomEvent","detail","bubbles","checked","ItemEdit","onCountChange","target","isNaN","onMoveClick","direction","currentTarget","onMoreClick","moreDropdown","renewMoreActions","destroyMoreDropdown","handleInputChange","handleMoveClick","handleMoreClick","forEach","BoxField","ACTION_BOX","ACTION_ITEM","disableInput","readonly","contains","parentElement","toggle","getCountDiff","needDelete","initialCount","parseFloat","_item$PARTIAL_COUNT","_moreDropdown","PopupMenu","dropdown","previousIds","getMenuItems","menuItem","previousId","removeMenuItem","destroyEmptyPopup","moreActions","addMenuItem","moreActionsForSplit","concat","moreActionsForDelete","onclick","markDeleted","Basket","nextIndex","sameBasketItems","countChanges","diff","boxItems","renderSelf","renewItems","after","destroyItems","createItems","i","createItem","mode","EntityEditorMode","edit","moveItem","sameItems","sameItem","detachItem","onlyForPart","box","renderBasket","buildActions","hideSelf","basketOptions","view","detach","nextElementSibling","updateNumber","number","BasketItemMoveModal","resolve","reject","open","Promise","foundBox","BasketItemSplitModal","BoxOnlyPartDeleteModal","onDeleteClick","handleDeleteClick","enableDelete","button","Collection","movableBox","nextMovableBox","previousMovableBox","previous","found","boxes","anchor","addItem","last","_this$items","deleteItem","refresh","refreshBasketOffset","refreshBoxDelete","refreshBasketMove","refreshNumber","num","basketItemBox","sibling","canDelete","canEdit","hasPrevious","hasNext","ReferenceField","_mode","ACTION_CIS","ACTION_DIGITAL","_editor","showToolPanel","registerActiveControl","_changeHandler","onBoxDelete","then","cancelSplitBasketItem","newBox","boxCollection","moveBasketItem","onBasketItemAction","copyCis","startMoveBasketItem","startSplitBasketItem","initialize","handleBoxDelete","handleBasketItemAction","siblings","_basketItem$cis","oldBox","selectedBox","newItem","addBox","afterMoveBasketItem","resolved","moveCount","needClone","splitBasketItem","deletedCount","deletedInitialCount","removeBasketItemSiblings","productIndex","isSelf","countSiblings","firstSibling","previousBox","payloadBasket","ACTIONS","BASKET","renderBoxes","boxCount","renderHeader","renderSummary","columnTitle","isInEditMode","langKey","lang","SUMMARY","validate","validator","_parent","getChildById","resetValues","showDialog","message","dialogBody","SendButton","onSendClick","reasons","reasonControl","productsControl","changes","change","NAME","COUNT","error","EntityValidationError","addError","extendOptions","onActivityEnd","isMatchActivity","reload","handleActivityEnd","_activityType","broadcast","ACTIVITY_ACTION","_payload$ACTIVITY_ACT","TYPE","activity","buildActivity","property","makeActivityMethod","JSON","stringify","broadcastElement","onDocumentClick","getItem","url","buildDocumentUrl","createDialog","Show","bindDocumentsClick","link","addEventListener","YandexMarket","PrintDialog","DIALOG_TITLE","TITLE","content_url","width","WIDTH","height","HEIGHT","buttons","btnSave","btnCancel","renderIntro","renderDocuments","insertAdjacentHTML","notification","Notification","Box","basket_confirm","BasketConfirm","Property","print","Print","editor","overrideEditor","overrideEditorAjax","restoreOriginDefault","start","storeOriginDefault","addCustomEvent","_originDefault","_BX","EntityEditor","_BX$UI$EntityEditor","getDefault","setTimeout","setDefault","createAjaxForm","editorValidate","editorCreateAjaxForm","EntityAsyncValidator","control","_activeControls","addResult","_userFieldManager","parentMethod","callbacks","call","overrideAjaxForm","_ajaxForm","ajaxForm","_BX3","_BX3$UI","ComponentAjax","doSubmit","ajaxFormDoSubmit","formData","_elementNode","ajax","prepareForm","_formData","filesCount","isPlainObject","resultData","makeFormData","runComponentAction","_className","_actionName","signedParameters","_signedParameters","getParameters","_getParameters","response","callback","prop","getFunction","_callbacks","onCustomEvent","catch","errors"],"mappings":"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"}