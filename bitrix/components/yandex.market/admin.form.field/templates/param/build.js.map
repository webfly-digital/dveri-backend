{"version":3,"file":"build.js","sources":["src/searchadapter.js","src/node.js","src/tagfactory.js","src/tag.js","src/tagcollection.js","src/nodecollection.js","src/taggroupfactory.js","src/taggroup.js","src/tagsettingregistry.js","src/tagsetting.js","src/tagsettings.js"],"sourcesContent":["const $ = window.YMarketJQuery || window.jQuery;\r\nconst BX = window.BX;\r\n\r\n$.fn.select2.amd.define('select2/data/search', [\r\n\t'./array',\r\n\t'../utils',\r\n\t'jquery'\r\n], function(ArrayAdapter, Utils) {\r\n\tfunction SearchAdapter ($element, options) {\r\n\t\tthis.searchVariants = options.get('data');\r\n\r\n\t\toptions.set('data', null); // reset data for skip inside array\r\n\r\n\t\tSearchAdapter.__super__.constructor.call(this, $element, options);\r\n\t}\r\n\r\n\tUtils.Extend(SearchAdapter, ArrayAdapter);\r\n\r\n\tSearchAdapter.prototype.query = function (params, callback) {\r\n\t\tvar data = [];\r\n\t\tvar self = this;\r\n\t\tvar term = params.term || '';\r\n\r\n\t\tif (term.length > 0) {\r\n\t\t\tif (typeof this.searchVariants === 'function') {\r\n\t\t\t\tthis.searchVariants = this.searchVariants();\r\n\t\t\t}\r\n\r\n\t\t\tthis.searchVariants.forEach(function (option) {\r\n\t\t\t\tvar matches = self.matches(params, option);\r\n\r\n\t\t\t\tif (matches !== null) {\r\n\t\t\t\t\tdata.push(matches);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tcallback({\r\n\t\t\tresults: data\r\n\t\t});\r\n\t};\r\n\r\n\treturn SearchAdapter;\r\n});","const $ = window.YMarketJQuery || window.jQuery;\r\nconst BX = window.BX;\r\nconst Plugin = BX.namespace('YandexMarket.Plugin');\r\nconst Reference = BX.namespace('YandexMarket.Field.Reference');\r\nconst Source = BX.namespace('YandexMarket.Source');\r\nconst utils = BX.namespace('YandexMarket.Utils');\r\n\r\nexport class Node extends Reference.Base {\r\n\r\n\tstatic dataName = 'FieldParamNode';\r\n\tstatic defaults = Object.assign({}, Reference.Base.prototype.defaults, {\r\n\t\ttype: null,\r\n\t\tvalueType: 'string',\r\n\t\trequired: false,\r\n\t\tcopyType: null,\r\n\t\tlinkedSources: [ 'iblock_property_feature' ],\r\n\r\n\t\tmanagerElement: '.js-param-manager',\r\n\r\n\t\tinputElement: '.js-param-node__input',\r\n\t\tsourceElement: '.js-param-node__source',\r\n\t\tfieldWrapElement: '.js-param-node__field-wrap',\r\n\t\tfieldElement: '.js-param-node__field',\r\n\t\ttemplateButtonElement: '.js-param-node__template-button',\r\n\r\n\t\tfieldTextTemplate: '<input class=\"b-param-table__input js-param-node__input js-param-node__field\" type=\"text\" />',\r\n\t\tfieldFormulaTemplate: '<div class=\"b-input-formula js-param-node__field-wrap\" data-plugin=\"Ui.Input.Formula\">' +\r\n\t\t\t'<select class=\"b-input-formula__function b-param-table__control js-param-node__input js-input-formula__function\" data-complex=\"FUNCTION\"></select>' +\r\n\t\t\t'<div class=\"b-input-formula__parts-wrap\">' +\r\n\t\t\t\t'<select class=\"b-input-formula__parts b-param-table__input js-param-node__field js-param-node__input js-input-formula__parts\" data-complex=\"PARTS\" size=\"1\"></select>' +\r\n\t\t\t'</div>' +\r\n\t\t\t'<button class=\"b-input-formula__dropdown b-param-table__control adm-btn js-input-formula__dropdown\" type=\"button\">...</button>' +\r\n\t\t'</div>',\r\n\t\tfieldSelectTemplate: '<select class=\"b-param-table__input js-param-node__input js-param-node__field\" data-plugin=\"Ui.Input.TagInput\" data-width=\"100%\" data-tags=\"false\"></select>',\r\n\t\tfieldTemplateTemplate: '<div class=\"b-control-group js-param-node__field-wrap\" data-plugin=\"Ui.Input.Template\">' +\r\n\t\t\t'<input class=\"b-control-group__item pos--first b-param-table__input js-param-node__input js-param-node__field js-input-template__origin\" type=\"text\" />' +\r\n\t\t\t'<button class=\"b-control-group__item pos--last width--by-content adm-btn around--control js-input-template__dropdown\" type=\"button\">...</button>' +\r\n\t\t'</div>',\r\n\r\n\t\tlangPrefix: 'YANDEX_MARKET_FIELD_PARAM_',\r\n\t\tlang: {}\r\n\t});\r\n\r\n\t_manager;\r\n\t_lastSource;\r\n\t_fieldValueUserInput;\r\n\r\n\tinitialize() {\r\n\t\tsuper.initialize();\r\n\t\tthis.bind();\r\n\t\tthis.initValueUi();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleSourceChange(true);\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleLinkedSourceFieldChange(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleSourceChange(false);\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleLinkedSourceFieldChange(false);\r\n\t}\r\n\r\n\thandleSourceChange(dir) {\r\n\t\tconst sourceElement = this.getElement('source');\r\n\r\n\t\tsourceElement[dir ? 'on' : 'off']('change keyup', $.proxy(this.onSourceChange, this));\r\n\t}\r\n\r\n\thandleParentField(field, dir) {\r\n\t\tthis.handleCopyTypeFieldChange(field, dir);\r\n\t\tthis.handleCopyTypeSelfFieldInput(dir);\r\n\t}\r\n\r\n\thandleCopyTypeFieldChange(parentField, dir) {\r\n\t\tconst type = this.options.copyType;\r\n\r\n\t\tif (type != null) {\r\n\t\t\tconst typeCollection = parentField.getTypeCollection(type);\r\n\r\n\t\t\ttypeCollection[dir ? 'on' : 'off']('change keyup', this.getElementSelector('field'), $.proxy(this.onCopyTypeFieldChange, this));\r\n\t\t}\r\n\t}\r\n\r\n\thandleCopyTypeSelfFieldInput(dir) {\r\n\t\tconst type = this.options.copyType;\r\n\r\n\t\tif (type != null) {\r\n\t\t\tthis.$el[dir ? 'on' : 'off']('input paste', this.getElementSelector('field'), $.proxy(this.onCopyTypeSelfFieldInput, this));\r\n\t\t}\r\n\t}\r\n\r\n\thandleLinkedSourceFieldChange(dir) {\r\n\t\tif (this.options.linkedSources == null && dir) { return; }\r\n\r\n\t\tthis.$el[dir ? 'on' : 'off']('change', this.getElementSelector('field'), $.proxy(this.onLinkedSourceFieldChange, this));\r\n\t}\r\n\r\n\thandleInputChange(dir) {\r\n\t\tconst inputSelector = this.getElementSelector('input');\r\n\r\n\t\tthis.$el[dir ? 'on' : 'off']('change', inputSelector, $.proxy(this.onInputChange, this));\r\n\t}\r\n\r\n\tonSourceChange(evt) {\r\n\t\tthis.refreshField(evt.target.value);\r\n\t}\r\n\r\n\tonCopyTypeFieldChange(evt) {\r\n\t\tconst input = evt.currentTarget;\r\n\r\n\t\tthis.copyFieldValue(input);\r\n\t}\r\n\r\n\tonCopyTypeSelfFieldInput(evt) {\r\n\t\tconst input = evt.currentTarget;\r\n\r\n\t\tthis._fieldValueUserInput = (input.value !== '');\r\n\t}\r\n\r\n\tonLinkedSourceFieldChange(evt) {\r\n\t\tconst source = this.getElement('source').val();\r\n\r\n\t\tif (this.options.linkedSources.indexOf(source) === -1) { return; }\r\n\r\n\t\tthis.$el.trigger('FieldParamNodeLinkedChange', {\r\n\t\t\tnode: this,\r\n\t\t\tsource: source,\r\n\t\t\tfield: evt.target.value,\r\n\t\t});\r\n\t}\r\n\r\n\tonInputChange() {\r\n\t\tthis.$el.trigger('FieldParamNodeChange');\r\n\t}\r\n\r\n\tpreselect() {\r\n\t\tif (this.getElement('source').val() !== 'recommendation') { return; }\r\n\r\n\t\tconst field = this.getElement('field');\r\n\t\tconst options = field.find('option');\r\n\r\n\t\tif (field.data('type') !== 'select') { return; }\r\n\r\n\t\tfor (let i = 0; i < options.length; ++i) {\r\n\t\t\tlet option = options[i];\r\n\r\n\t\t\tif (option.value === '') { continue; }\r\n\r\n\t\t\tif (!option.selected) {\r\n\t\t\t\toption.selected = true;\r\n\t\t\t\tfield.trigger('change');\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tsetValue(value: Object) : void {\r\n\t\tif (value['TYPE'] != null) {\r\n\t\t\tconst sourceElement = this.getElement('source');\r\n\r\n\t\t\tsourceElement.val(value['TYPE']);\r\n\t\t\tthis.refreshField(sourceElement.val());\r\n\t\t}\r\n\r\n\t\tsuper.setValue(value);\r\n\t\tthis.reflowFieldSelected(value);\r\n\t}\r\n\r\n\tsyncLinked(source, field) {\r\n\t\tthis.syncLinkedSource(source) && this.syncLinkedField(field);\r\n\t}\r\n\r\n\tsyncLinkedSource(source) {\r\n\t\tconst element = this.getElement('source');\r\n\t\tconst options = element.find('option');\r\n\t\tlet found = false;\r\n\r\n\t\tif (element.val() === source) { return true; }\r\n\r\n\t\tfor (let i = 0; i < options.length; ++i) {\r\n\t\t\tlet option = options[i];\r\n\r\n\t\t\tif (option.value !== source) { continue; }\r\n\r\n\t\t\tfound = true;\r\n\r\n\t\t\tif (!option.selected) {\r\n\t\t\t\toption.selected = true;\r\n\t\t\t\telement.trigger('change'); // force reflow field\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tsyncLinkedField(value) {\r\n\t\tconst field = this.getElement('field');\r\n\t\tconst options = field.find('option');\r\n\t\tconst marker = value.replace(/\\.[^.]+$/, '.');\r\n\t\tlet found = false;\r\n\r\n\t\tif (marker === '') { return found; }\r\n\t\tif (field.data('type') !== 'select') { return found; }\r\n\r\n\t\tfor (let i = 0; i < options.length; ++i) {\r\n\t\t\tlet option = options[i];\r\n\r\n\t\t\tif (option.value.indexOf(marker) !== 0) { continue; }\r\n\r\n\t\t\tfound = true;\r\n\r\n\t\t\tif (!option.selected) {\r\n\t\t\t\toption.selected = true;\r\n\t\t\t\tfield.trigger('change'); // force reflow select2\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tsuper.clear();\r\n\t\tthis._fieldValueUserInput = false;\r\n\t}\r\n\r\n\tsetParentField(field) {\r\n\t\tconst previousParent = this.getParentField();\r\n\r\n\t\tif (previousParent != null) {\r\n\t\t\tthis.handleParentField(previousParent, false);\r\n\t\t}\r\n\r\n\t\tif (field != null) {\r\n\t\t\tthis.handleParentField(field, true);\r\n\t\t}\r\n\r\n\t\tsuper.setParentField(field);\r\n\t}\r\n\r\n\tisFieldValueUserInput(field) {\r\n\t\tif (this._fieldValueUserInput == null) {\r\n\t\t\tconst fieldElement = field || this.getElement('field');\r\n\t\t\tconst fieldValue = fieldElement.val();\r\n\r\n\t\t\tthis._fieldValueUserInput = (fieldValue != null && fieldValue !== '');\r\n\t\t}\r\n\r\n\t\treturn this._fieldValueUserInput;\r\n\t}\r\n\r\n\tcopyFieldValue(fromElement) {\r\n\t\tconst fieldElement = this.getElement('field');\r\n\t\tconst fieldTagName = (fieldElement.prop('tagName') || '').toLowerCase();\r\n\t\tconst fromTagName = (fromElement.tagName || '').toLowerCase();\r\n\t\tlet fromValue;\r\n\t\tlet option;\r\n\r\n\t\tif (fieldTagName === 'input' && fromTagName === 'select' && !this.isFieldValueUserInput(fieldElement)) { // support copy only in input from select\r\n\t\t\toption = $('option', fromElement).filter(':selected');\r\n\r\n\t\t\tif (option.val()) { // is not placeholder\r\n\t\t\t\tfromValue = option.text();\r\n\t\t\t}\r\n\r\n\t\t\tif (fromValue != null) {\r\n\t\t\t\tfromValue = fromValue.replace(/^\\[\\d+]/, '').trim(); // remove id\r\n\r\n\t\t\t\tfieldElement.val(fromValue);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trefreshField(typeId) {\r\n\t\tif (this._lastSource != null && this._lastSource === typeId) { return; }\r\n\r\n\t\tconst manager = this.getManager();\r\n\t\tconst type = manager.getType(typeId);\r\n\r\n\t\tthis._lastSource = typeId;\r\n\t\tthis.updateField(type, manager);\r\n\t}\r\n\r\n\tupdateField(type, manager) {\r\n\t\tlet fieldElement = this.getElement('field');\r\n\t\tlet fieldEnumList;\r\n\t\tlet fieldEnum;\r\n\t\tlet fieldValue;\r\n\t\tlet i;\r\n\t\tlet fieldType = (fieldElement.data('type') || '').toLowerCase();\r\n\t\tlet needType = type['CONTROL'] || 'select';\r\n\t\tlet content;\r\n\r\n\t\tif (needType === 'select') {\r\n\t\t\tfieldEnumList = this.getFieldList(type['ID'], manager);\r\n\t\t\tfieldValue = fieldElement.val();\r\n\t\t\tcontent = '';\r\n\r\n\t\t\tif (fieldEnumList != null && fieldEnumList.length > 0) {\r\n\t\t\t\tif (!this.options.required) {\r\n\t\t\t\t\tcontent += '<option value=\"\">' + this.getLang('SELECT_PLACEHOLDER') + '</option>';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = 0; i < fieldEnumList.length; i++) {\r\n\t\t\t\t\tfieldEnum = fieldEnumList[i];\r\n\r\n\t\t\t\t\tif (fieldEnum['DEPRECATED'] && fieldValue !== fieldEnum['ID']) { continue; }\r\n\r\n\t\t\t\t\tcontent +=\r\n\t\t\t\t\t\t'<option ' +\r\n\t\t\t\t\t\t\t'value=\"' + fieldEnum['ID'] + '\"' +\r\n\t\t\t\t\t\t\t(fieldValue === fieldEnum['ID'] ? ' selected' : '') +\r\n\t\t\t\t\t\t'>'\r\n\t\t\t\t\t\t+ utils.escape(fieldEnum['VALUE'])\r\n\t\t\t\t\t\t+ '</option>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (fieldType !== needType) {\r\n\t\t\tfieldElement = this.renderField(fieldElement, needType);\r\n\t\t}\r\n\r\n\t\tif (content != null) {\r\n\t\t\tfieldElement.html(content);\r\n\t\t}\r\n\t}\r\n\r\n\trenderField(field, type) {\r\n\t\tlet templateKey = 'field' + type.substring(0, 1).toUpperCase() + type.substring(1);\r\n\t\tlet template = this.getTemplate(templateKey);\r\n\t\tlet fieldSelector = this.getElementSelector('field');\r\n\t\tlet inputSelector = this.getElementSelector('input');\r\n\t\tlet oldWrap = this.getElement('fieldWrap', field, 'closest');\r\n\t\tlet newWrap = $(template);\r\n\t\tlet newField = newWrap.filter(fieldSelector);\r\n\t\tlet newFieldInputs = newField.add(newWrap.find(inputSelector));\r\n\r\n\t\tif (oldWrap.length === 0) { oldWrap = field; }\r\n\t\tif (newField.length === 0) { newField = newWrap.find(fieldSelector); }\r\n\r\n\t\tthis.destroyValueUi(oldWrap);\r\n\r\n\t\tthis.copyAttrList(field, newFieldInputs, ['name', 'data-name']);\r\n\t\tnewField.data('type', type);\r\n\r\n\t\tnewWrap.insertAfter(oldWrap);\r\n\t\toldWrap.remove();\r\n\r\n\t\tthis.initValueUi(newWrap);\r\n\r\n\t\tthis._fieldValueUserInput = false;\r\n\r\n\t\treturn newField;\r\n\t}\r\n\r\n\tdestroyValueUi(newField) {\r\n\t\tlet value = newField || this.getElementFieldWrap();\r\n\r\n\t\tPlugin.manager.destroyElement(value);\r\n\t}\r\n\r\n\tinitValueUi(newField) {\r\n\t\tlet value = newField || this.getElementFieldWrap();\r\n\t\tlet plugins = Plugin.manager.initializeElement(value);\r\n\t\tlet firstPlugin = plugins[0];\r\n\r\n\t\tif (firstPlugin != null) {\r\n\t\t\tfirstPlugin.setOptions({\r\n\t\t\t\tsourceManager: this.getManager(),\r\n\t\t\t\tsourceType: this.getElement('source').val(),\r\n\t\t\t\tnodeType: this.options.type\r\n\t\t\t});\r\n\r\n\t\t\tif (typeof firstPlugin.render === 'function') {\r\n\t\t\t\tfirstPlugin.render();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treflowFieldSelected(value: Object) : void {\r\n\t\tconst fieldWrapper = this.getElementFieldWrap();\r\n\t\tconst plugin = Plugin.manager.getInstance(fieldWrapper);\r\n\r\n\t\tif (plugin != null && plugin.setValue != null) {\r\n\t\t\tplugin.setValue(this.sliceOnlyFieldValue(value));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst field = this.getElementField();\r\n\r\n\t\tif (field.hasClass('select2-hidden-accessible')) {\r\n\t\t\tfield.trigger('change.select2');\r\n\t\t}\r\n\t}\r\n\r\n\tsliceOnlyFieldValue(value: Object) {\r\n\t\tif (value['FIELD'] != null) {\r\n\t\t\treturn value['FIELD'];\r\n\t\t}\r\n\r\n\t\tconst fieldValue = {};\r\n\r\n\t\tfor (const [key, item] of Object.entries(value)) {\r\n\t\t\tconst matches = /^\\[FIELD]\\[(.*?)]/.exec(key);\r\n\r\n\t\t\tif (matches == null) { continue; }\r\n\r\n\t\t\tfieldValue[matches[1]] = item;\r\n\t\t}\r\n\r\n\t\treturn fieldValue;\r\n\t}\r\n\r\n\tgetElementField() {\r\n\t\treturn this.getElement('field');\r\n\t}\r\n\r\n\tgetElementFieldWrap() {\r\n\t\tlet result = this.getElement('fieldWrap');\r\n\r\n\t\treturn (result.length > 0 ? result : this.getElementField());\r\n\t}\r\n\r\n\tcopyAttrList(fromElement, toElements, attrList) {\r\n\t\tlet fromValues = this.readAttrList(fromElement, attrList);\r\n\t\tlet toIndex;\r\n\t\tlet toElement;\r\n\r\n\t\tfor (toIndex = toElements.length - 1; toIndex >= 0; toIndex--) {\r\n\t\t\ttoElement = toElements.eq(toIndex);\r\n\t\t\tthis.writeAttrList(toElement, fromValues);\r\n\t\t}\r\n\t}\r\n\r\n\treadAttrList(field, attributeNames) {\r\n\t\tlet complex = field.data('complex');\r\n\t\tlet complexFull = complex ? '[' + complex + ']' : null;\r\n\t\tlet complexPosition;\r\n\t\tlet result = {};\r\n\t\tlet attributeName;\r\n\t\tlet attributeValue;\r\n\t\tlet i;\r\n\r\n\t\tfor (i = attributeNames.length - 1; i >= 0; i--) {\r\n\t\t\tattributeName = attributeNames[i];\r\n\t\t\tattributeValue = field.attr(attributeName);\r\n\r\n\t\t\tif (attributeValue == null) { continue; }\r\n\r\n\t\t\tif (attributeName.indexOf('name') !== -1) {\r\n\t\t\t\tattributeValue = attributeValue.replace(/\\[]$/, '');\r\n\r\n\t\t\t\tif (complexFull) {\r\n\t\t\t\t\tcomplexPosition = attributeValue.indexOf(complexFull);\r\n\r\n\t\t\t\t\tif (complexPosition !== -1 && attributeValue.length === complexPosition + complexFull.length) {\r\n\t\t\t\t\t\tattributeValue = attributeValue.substring(0, complexPosition);\r\n\r\n\t\t\t\t\t\tif (attributeName === 'data-name') {\r\n\t\t\t\t\t\t\tattributeValue = attributeValue.replace(/^\\[([^\\]]+)]$/, '$1');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tresult[attributeName] = attributeValue;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\twriteAttrList(field, attributeValues) {\r\n\t\tlet complex = field.data('complex');\r\n\t\tlet complexFull = complex ? '[' + complex + ']' : '';\r\n\t\tlet attributeName;\r\n\t\tlet attributeValue;\r\n\r\n\t\tfor (attributeName in attributeValues) {\r\n\t\t\tif (!attributeValues.hasOwnProperty(attributeName)) { continue; }\r\n\r\n\t\t\tattributeValue = attributeValues[attributeName];\r\n\r\n\t\t\tif (complexFull && attributeName.indexOf('name') !== -1) {\r\n\t\t\t\tif (attributeName === 'data-name' && attributeValue.indexOf('[') !== 0) {\r\n\t\t\t\t\tattributeValue = '[' + attributeValue + ']' + complexFull;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tattributeValue += complexFull;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfield.attr(attributeName, attributeValue);\r\n\t\t}\r\n\t}\r\n\r\n\tgetFieldList(typeId, manager) {\r\n\t\tlet result;\r\n\r\n\t\tmanager = manager || this.getSourceManager();\r\n\r\n\t\tif (typeId === 'recommendation') {\r\n\t\t\tresult = manager.getRecommendationList(this.options.type);\r\n\t\t} else {\r\n\t\t\tresult = manager.getTypeFieldList(typeId, this.options.valueType, this.options.type);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetManager() {\r\n\t\tif (this._manager == null) {\r\n\t\t\tconst element = this.getElement('manager', this.$el, 'closest');\r\n\t\t\tthis._manager = Source.Manager.getInstance(element);\r\n\t\t}\r\n\r\n\t\treturn this._manager;\r\n\t}\r\n\r\n}","import type {TagCollection} from \"./tagcollection\";\r\nimport type {TagGroup} from \"./taggroup\";\r\n\r\nconst $ = window.YMarketJQuery || window.jQuery;\r\nconst BX = top.BX;\r\nconst Plugin = BX.namespace('YandexMarket.Plugin');\r\n\r\nexport class TagFactory extends Plugin.Base {\r\n\r\n    static defaults = Object.assign({}, Plugin.Base.prototype.defaults, {\r\n        collection: null,\r\n        items: {},\r\n    });\r\n\r\n    _valid = false;\r\n\r\n    initialize() : void {\r\n        super.initialize();\r\n        this.bind();\r\n    }\r\n\r\n    destroy() : void {\r\n        this.unbind();\r\n        super.destroy();\r\n    }\r\n\r\n    bind() : void {\r\n        this.handleOpenClick(true);\r\n    }\r\n\r\n    unbind() : void {\r\n        this.handleOpenClick(false);\r\n    }\r\n\r\n    handleOpenClick(dir: boolean) : void {\r\n        this.$el[dir ? 'on' : 'off']('click', $.proxy(this.onOpenClick, this));\r\n    }\r\n\r\n    onOpenClick(evt) : void {\r\n\t\tconst [direct, group] = this.direct();\r\n\r\n\t\tif (direct != null) {\r\n\t\t\tthis.collection().addTag(direct, group);\r\n\t\t} else {\r\n\t\t\tthis.open();\r\n\t\t}\r\n\r\n        evt.preventDefault();\r\n    }\r\n\r\n\tdirect() : Array {\r\n\t\tconst entries = Object.entries(this.options.items);\r\n\r\n\t\tif (entries.length !== 1) { return []; }\r\n\r\n\t\treturn [ entries[0][0], null ];\r\n\t}\r\n\r\n    collection() : TagCollection|TagGroup {\r\n        return this.options.collection;\r\n    }\r\n\r\n    open() : void {\r\n        if (this.el.OPENER == null) {\r\n            this._valid = true;\r\n            BX.adminShowMenu(this.el, this.dropdownMenu(), {\r\n                active_class: this.el.classList.contains('adm-btn') ? 'adm-btn-active' : '',\r\n            });\r\n\r\n            return;\r\n        }\r\n\r\n        if (!this._valid) {\r\n            this.el.OPENER.SetMenu(this.dropdownMenu());\r\n        }\r\n    }\r\n\r\n    dropdownMenu() : Array {\r\n        return this.dropdownItems(this.options.items);\r\n    }\r\n\r\n    dropdownItems(tagsMap: Object, group: number = null) : Array {\r\n        const result = [];\r\n\r\n        for (const [tagId, state] of Object.entries(tagsMap)) {\r\n            if (!state['ENABLED']) { continue; }\r\n\r\n            result.push({\r\n                TEXT: state['TITLE'],\r\n                HTML: state['TITLE'],\r\n                ONCLICK: () => { this.collection().addTag(tagId, group); },\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    showItem(type: string, group: ?number = null) : void {\r\n        this._valid = false;\r\n        this.toggleItem(type, group, true);\r\n        this.toggleVisible(true);\r\n    }\r\n\r\n    hideItem(type: string, group: ?number = null) : void {\r\n        this.toggleItem(type, group, false);\r\n        this._valid = false;\r\n        !this.hasActiveItems() && this.toggleVisible(false);\r\n    }\r\n\r\n    toggleItem(type: string, group: ?number, dir: boolean) : void {\r\n        this.options.items[type]['ENABLED'] = dir;\r\n    }\r\n\r\n    hasActiveItems() : boolean {\r\n        for (const [, state] of Object.entries(this.options.items)) {\r\n            if (state['ENABLED']) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    toggleVisible(dir: boolean) : void {\r\n        this.$el.toggleClass('is--hidden', !dir);\r\n    }\r\n\r\n}","const BX = window.BX;\r\nconst Reference = BX.namespace('YandexMarket.Field.Reference');\r\n\r\nexport class Tag extends Reference.Complex {\r\n\t\r\n\tstatic dataName = 'FieldParamTag';\r\n\tstatic defaults = Object.assign({}, Reference.Complex.prototype.defaults, {\r\n\t\tinputElement: '.js-param-tag__input',\r\n\t\tchildElement: '.js-param-tag__child',\r\n\r\n\t\tlang: {},\r\n\t\tlangPrefix: 'YANDEX_MARKET_FIELD_PARAM_'\r\n\t});\r\n\r\n\tpreselect() : void {\r\n\t\tthis.getChildField('PARAM_VALUE').preselect();\r\n\t}\r\n\r\n\tenable() : void {\r\n\t\tconst settings = this.getChildField('SETTINGS');\r\n\r\n\t\tif (settings == null) { return; }\r\n\r\n\t\tsettings.enable();\r\n\t}\r\n\r\n\tdisable() : void {\r\n\t\tconst settings = this.getChildField('SETTINGS');\r\n\r\n\t\tif (settings == null) { return; }\r\n\r\n\t\tsettings.disable();\r\n\t}\r\n\r\n}","import {TagFactory} from \"./tagfactory\";\r\nimport {Tag} from \"./tag\";\r\n\r\nconst $ = window.YMarketJQuery || window.jQuery;\r\nconst BX = window.BX;\r\nconst Reference = BX.namespace('YandexMarket.Field.Reference');\r\n\r\nexport class TagCollection extends Reference.Collection {\r\n\r\n\tstatic dataName = 'FieldParamTagCollection';\r\n\tstatic defaults = Object.assign({}, Reference.Collection.prototype.defaults, {\r\n\t\ttitleElement: '.js-param-tag-collection__title',\r\n\t\titemElement: '.js-param-tag-collection__item',\r\n\t\titemDeleteElement: '.js-param-tag-collection__item-delete',\r\n\t\tfactoryElement: '.js-param-tag-collection__factory.level--0',\r\n\t\tfactory: null,\r\n\t});\r\n\r\n\t_factory;\r\n\t_factoryIndex;\r\n\r\n\tinitialize() {\r\n\t\tsuper.initialize();\r\n\t\tthis.initializeFactory();\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t\tthis.destroyFactory();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleItemDeleteClick(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleItemDeleteClick(false);\r\n\t}\r\n\r\n\thandleItemDeleteClick(dir) {\r\n\t\tconst itemDeleteSelector = this.getElementSelector('itemDelete');\r\n\r\n\t\tthis.$el[dir ? 'on' : 'off']('click', itemDeleteSelector, $.proxy(this.onItemDeleteClick, this));\r\n\t}\r\n\r\n\tonItemDeleteClick(evt) {\r\n\t\tconst deleteButton = $(evt.currentTarget);\r\n\t\tconst item = this.getElement('item', deleteButton, 'closest');\r\n\r\n\t\tthis.deleteItem(item);\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\taddTag(type) {\r\n\t\tconst typeCollection = this.getTypeCollection(type, true);\r\n\t\tconst item = typeCollection.eq(-1);\r\n\t\tconst wasHidden = item.hasClass('is--hidden');\r\n\t\tconst newInstance = this.addItem(item);\r\n\r\n\t\tif (newInstance != null && wasHidden && typeCollection.length === 1) {\r\n\t\t\tnewInstance.preselect();\r\n\t\t}\r\n\t}\r\n\r\n\taddItem(source, context, method) {\r\n\t\tconst sourceItem = source || this.getElement('item').eq(-1);\r\n\t\tconst isMultiple = sourceItem.data('multiple');\r\n\t\tconst isRequired = sourceItem.data('required');\r\n\t\tconst itemType = sourceItem.data('type');\r\n\r\n\t\tif (itemType) {\r\n\t\t\tconst typeCollection = this.getTypeCollection(itemType);\r\n\r\n\t\t\tif (!isMultiple && typeCollection.length > 0) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (isRequired && typeCollection.length === 1) {\r\n\t\t\t\tthis.toggleItemDeleteView(true, typeCollection);\r\n\t\t\t}\r\n\r\n\t\t\tif (!isMultiple && typeCollection.length === 0 && this._factory != null) { // can't add more\r\n\t\t\t\tthis._factory.hideItem(itemType, this._factoryIndex);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.toggleTitle(true);\r\n\r\n\t\treturn super.addItem(sourceItem, context, method);\r\n\t}\r\n\r\n\tdeleteItem(item) {\r\n\t\tconst isRequired = item.data('required');\r\n\t\tconst isPersistent = item.data('persistent');\r\n\t\tconst itemType = item.data('type');\r\n\r\n\t\tif (itemType) {\r\n\t\t\tconst typeCollection = this.getTypeCollection(itemType);\r\n\r\n\t\t\tif ((isRequired || isPersistent) && typeCollection.length === 2) {\r\n\t\t\t\tthis.toggleItemDeleteView(false, typeCollection);\r\n\t\t\t} else if (typeCollection.length === 1) {\r\n\t\t\t\tif (isRequired || isPersistent) {\r\n\t\t\t\t\tthis.clearItem(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._factory != null) {\r\n\t\t\t\t\t\tthis._factory.showItem(itemType, this._factoryIndex);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\titem.addClass('is--hidden');\r\n\t\t\t\t\tthis.destroyItem(item, true);\r\n\r\n\t\t\t\t\tif (this.getActiveItems().length === 0) {\r\n\t\t\t\t\t\tthis.toggleTitle(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t} else if (typeCollection.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.deleteItem(item);\r\n\t}\r\n\r\n\ttoggleItemDeleteView(dir, context) {\r\n\t\tthis.getElement('itemDelete', context).toggleClass('is--hidden', !dir);\r\n\t}\r\n\r\n\tgetTypeCollection(type, isIncludePlaceholder) {\r\n\t\treturn this.getElement('item').filter(function(index, node) {\r\n\t\t\tconst element = $(node);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t(element.data('type') === type)\r\n\t\t\t\t&& (isIncludePlaceholder || !element.hasClass('is--hidden'))\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\ttoggleTitle(dir: boolean) : void {\r\n\t\tthis.getElement('title').toggleClass('is--hidden', !dir);\r\n\t}\r\n\r\n\tsetFactory(factory: TagFactory, index: number) : void {\r\n\t\tthis._factory = factory;\r\n\t\tthis._factoryIndex = index;\r\n\t}\r\n\r\n\tinitializeFactory() {\r\n\t\tconst element = this.getElement('factory');\r\n\r\n\t\tif (element.length === 0) { return; }\r\n\r\n\t\tthis._factory = new TagFactory(element, {\r\n\t\t\tcollection: this,\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyFactory() {\r\n\t\tif (this._factory == null || this._factoryIndex != null) { return; }\r\n\r\n\t\tthis._factory.destroy();\r\n\t\tthis._factory = null;\r\n\t}\r\n\r\n\tenable() : void {\r\n\t\tthis.callItemList('enable');\r\n\t}\r\n\r\n\tdisable() : void {\r\n\t\tthis.callItemList('disable');\r\n\t}\r\n\r\n\tgetItemPlugin() {\r\n\t\treturn Tag;\r\n\t}\r\n\r\n}","import {TagCollection} from \"./tagcollection\";\r\nimport {Node} from \"./node\";\r\n\r\nexport class NodeCollection extends TagCollection {\r\n\r\n\tstatic dataName = 'FieldParamNodeCollection';\r\n\tstatic defaults = Object.assign({}, TagCollection.defaults, {\r\n\t\titemElement: '.js-param-node-collection__item',\r\n\t\titemDeleteElement: '.js-param-node-collection__item-delete',\r\n\t\tfactoryElement: '.js-param-node-collection__attribute-factory',\r\n\t});\r\n\r\n\tbind() {\r\n\t\tsuper.bind();\r\n\t\tthis.handleLinkedChange(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleLinkedChange(false);\r\n\t\tsuper.unbind();\r\n\t}\r\n\r\n\thandleLinkedChange(dir) {\r\n\t\tthis.$el[dir ? 'on' : 'off']('FieldParamNodeLinkedChange', $.proxy(this.onLinkedChange, this));\r\n\t}\r\n\r\n\tonLinkedChange(evt, data) {\r\n\t\tthis.callItemList(function(itemInstance) {\r\n\t\t\tif (itemInstance === data.node) { return; }\r\n\r\n\t\t\titemInstance.syncLinked(data.source, data.field);\r\n\t\t});\r\n\t}\r\n\r\n\ttoggleItemDeleteView() {\r\n\t\t// nothing\r\n\t}\r\n\r\n\tpreselect() {\r\n\t\tthis.callItemList('preselect');\r\n\t}\r\n\r\n\tgetItemPlugin() {\r\n\t\treturn Node;\r\n\t}\r\n\r\n}","import {TagFactory} from \"./tagfactory\";\r\n\r\nexport class TagGroupFactory extends TagFactory {\r\n\r\n    static defaults = Object.assign({}, TagFactory.defaults, {\r\n        groups: [],\r\n\t    groupFlat: null,\r\n    });\r\n\r\n\tdirect(): Array {\r\n\t\tif (this.options.groups.length > 1) { return []; }\r\n\r\n\t\tconst group = this.options.groups[0];\r\n\t\tconst direct = super.direct(group['TAG_FACTORY']);\r\n\r\n\t\tif (direct[0] == null) { return []; }\r\n\r\n\t\treturn [ direct[0], 0 ];\r\n\t}\r\n\r\n\tdropdownMenu() : Array {\r\n        const result = [];\r\n\r\n        for (let index = 0; index < this.options.groups.length; ++index) {\r\n            const group = this.options.groups[index];\r\n            const items = this.dropdownItems(group['TAG_FACTORY'], index);\r\n\r\n            if (items.length === 0) { continue; }\r\n\r\n            if (!group['TITLE']) {\r\n\t            result.push(...items);\r\n            } else if (this.options.groupFlat) {\r\n\t            result.push(...items.map((item: Object) : Object => {\r\n\t\t\t\t\tif (items.length === 1) {\r\n\t\t\t\t\t\titem['TEXT'] = group['TITLE'];\r\n\t\t\t\t\t\titem['HTML'] = group['TITLE'];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem['TEXT'] = `${group['TITLE']}: ${item['TEXT']}`;\r\n\t\t\t\t\t\titem['HTML'] = `${group['TITLE']}: ${item['HTML']}`;\r\n\t\t\t\t\t}\r\n\r\n\t\t            return item;\r\n\t            }));\r\n            } else {\r\n\t            result.push({\r\n\t\t            TEXT: group['TITLE'],\r\n\t\t            HTML: group['TITLE'],\r\n\t\t            MENU: items,\r\n\t            });\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    toggleItem(type: string, group: ?number, dir: boolean) : void {\r\n        this.options.groups[group]['TAG_FACTORY'][type]['ENABLED'] = dir;\r\n    }\r\n\r\n    hasActiveItems() : boolean {\r\n        for (const group of this.options.groups) {\r\n            for (const [, state] of Object.entries(group['TAG_FACTORY'])) {\r\n                if (state['ENABLED']) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n}","import {TagFactory} from \"./tagfactory\";\r\nimport {TagCollection} from \"./tagcollection\";\r\nimport {TagGroupFactory} from \"./taggroupfactory\";\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nconst $ = window.YMarketJQuery || window.jQuery;\r\nconst BX = window.BX;\r\nconst Plugin = BX.namespace('YandexMarket.Plugin');\r\n\r\nexport class TagGroup extends Plugin.Base {\r\n\r\n    static dataName = 'FieldParamTagCollectionGroup';\r\n    static defaults = Object.assign({}, Plugin.Base.prototype.defaults, {\r\n        addElement: '.js-param-tag-group__factory',\r\n        itemElement: '.js-param-tag-group__item',\r\n    });\r\n\r\n    _factory;\r\n    _tagCollections;\r\n\r\n    initialize() : void {\r\n        super.initialize();\r\n        this.initializeFactory();\r\n        this.initializeTagCollection();\r\n    }\r\n\r\n    destroy() : void {\r\n        this.destroyTagCollection();\r\n        this.destroyFactory();\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    initializeFactory() : void {\r\n        this._factory = new TagGroupFactory(this.getElement('add'), {\r\n            collection: this,\r\n        });\r\n    }\r\n\r\n    destroyFactory() : void {\r\n        if (this._factory == null) { return; }\r\n\r\n        this._factory.destroy();\r\n        this._factory = null;\r\n    }\r\n\r\n    initializeTagCollection() : void {\r\n        const collectionElements = this.getElement('item');\r\n\r\n        this._tagCollections = [];\r\n\r\n        for (let i = 0; i < collectionElements.length; ++i) {\r\n            const tagCollection = TagCollection.getInstance(collectionElements[i]);\r\n            tagCollection.setFactory(this._factory, i);\r\n\r\n            this._tagCollections[i] = tagCollection;\r\n        }\r\n    }\r\n\r\n    destroyTagCollection() : void {\r\n        if (this._tagCollections == null) { return; }\r\n\r\n        for (const tagCollection of this._tagCollections) {\r\n            tagCollection.destroy();\r\n        }\r\n\r\n        this._tagCollections = null;\r\n    }\r\n\r\n    addTag(type: string, index: number) : void {\r\n        this._tagCollections[index].addTag(type);\r\n    }\r\n\r\n    factory() : TagFactory {\r\n        return this._factory;\r\n    }\r\n\r\n\tenable() : void {\r\n\t\tfor (const tagCollection of this._tagCollections) {\r\n\t\t\ttagCollection.enable();\r\n\t\t}\r\n\t}\r\n\r\n\tdisable() : void {\r\n\t\tfor (const tagCollection of this._tagCollections) {\r\n\t\t\ttagCollection.disable();\r\n\t\t}\r\n\t}\r\n\r\n}","import type {TagSetting} from \"./tagsetting\";\n\nexport class TagSettingRegistry {\n\tstatic STATE_MAIN = 'main';\n\tstatic STATE_SHADOW = 'shadow';\n\n\tstatic groups = {};\n\tstatic groupsMain = {};\n\n\tstatic push(name: string, setting: TagSetting) : void {\n\t\tif (this.groups[name] == null) { this.groups[name] = []; }\n\n\t\tif (this.groupsMain[name] == null && setting.enabled()) {\n\t\t\tsetting.groupMain();\n\t\t\tthis.groupsMain[name] = setting;\n\t\t} else {\n\t\t\tsetting.groupShadow();\n\n\t\t\tif (this.groupsMain[name] != null) {\n\t\t\t\tsetting.setValue(this.groupsMain[name].getValue());\n\t\t\t}\n\t\t}\n\n\t\tthis.groups[name].push(setting);\n\t}\n\n\tstatic shift(name: string, setting: TagSetting) : void {\n\t\tif (this.groups[name] == null) { return; }\n\n\t\tconst group = this.groups[name];\n\t\tconst index = group.indexOf(setting);\n\n\t\tif (index === -1) { return; }\n\n\t\tgroup.splice(index, 1);\n\n\t\tif (this.groupsMain[name] === setting) {\n\t\t\tsetting.destroyGroupMain();\n\t\t\tthis.groupsMain[name] = this._searchNewMain(name);\n\t\t}\n\t}\n\n\tstatic sync(name: string, setting: TagSetting) : void {\n\t\tif (this.groups[name] == null) { return; }\n\n\t\tconst value = setting.getValue();\n\n\t\tfor (const sibling of this.groups[name]) {\n\t\t\tif (sibling === setting) { continue; }\n\n\t\t\tsibling.setValue(value);\n\t\t}\n\t}\n\n\tstatic enable(name: string, setting: TagSetting) : void {\n\t\tif (this.groupsMain[name] != null) { return; }\n\n\t\tsetting.groupMain();\n\t\tthis.groupsMain[name] = setting;\n\t}\n\n\tstatic disable(name: string, setting: TagSetting) : void {\n\t\tif (this.groupsMain[name] !== setting) { return; }\n\n\t\tsetting.destroyGroupMain();\n\t\tsetting.groupShadow();\n\t\tthis.groupsMain[name] = this._searchNewMain(name);\n\t}\n\n\tstatic _searchNewMain(name: string, skip: TagSetting = null) : ?TagSetting {\n\t\tfor (const sibling of this.groups[name]) {\n\t\t\tif (sibling === skip || !sibling.enabled()) { continue; }\n\n\t\t\tsibling.groupMain();\n\t\t\treturn sibling;\n\t\t}\n\n\t\treturn null;\n\t}\n\n}","import { TagSettingRegistry } from \"./tagsettingregistry\";\n\nconst BX = window.BX;\nconst Reference = BX.namespace('YandexMarket.Field.Reference');\n\nexport class TagSetting extends Reference.Complex {\n\n\tstatic dataName = 'FieldParamSetting';\n\tstatic defaults = Object.assign({}, Reference.Complex.prototype.defaults, {\n\t\tinputElement: '.js-param-tag-setting__input',\n\t\tchildElement: '.js-param-tag-setting__child',\n\n\t\tgroup: null,\n\t\tproxy: true,\n\t\tname: 'SETTING',\n\n\t\tlang: {},\n\t\tlangPrefix: 'YANDEX_MARKET_FIELD_PARAM_'\n\t});\n\n\t_syncGroupTimeout: ?number;\n\t_groupState: ?string;\n\t_enabled: boolean;\n\n\tinitialize() : void {\n\t\tsuper.initialize();\n\n\t\tif (this.el.hasAttribute('data-disabled')) {\n\t\t\tthis._enabled = false;\n\t\t\tthis.el.removeAttribute('data-disabled');\n\t\t} else {\n\t\t\tthis._enabled = true;\n\t\t}\n\n\t\tthis.pushRegistry();\n\t}\n\n\tdestroy() : void {\n\t\tthis.shiftRegistry();\n\t\tsuper.destroy();\n\t}\n\n\thandleMainChange(dir: boolean) : void {\n\t\tthis.$el[dir ? 'on' : 'off']('change', $.proxy(this.onMainChange, this));\n\t}\n\n\tonMainChange() : void {\n\t\tthis.syncGroupDelayed();\n\t}\n\n\tclear() : void {\n\t\tif (this._groupState === TagSettingRegistry.STATE_SHADOW) { return; }\n\n\t\tsuper.clear();\n\t}\n\n\tpushRegistry() : void {\n\t\tif (this.options.group == null) { return; }\n\n\t\tTagSettingRegistry.push(this.options.group, this);\n\t}\n\n\tshiftRegistry() : void {\n\t\tif (this.options.group == null) { return; }\n\n\t\tTagSettingRegistry.shift(this.options.group, this);\n\t}\n\n\tgroupMain() : void {\n\t\tthis._groupState = TagSettingRegistry.STATE_MAIN;\n\t\tthis.$el.removeClass('is--shadow');\n\t\tthis.handleMainChange(true);\n\t}\n\n\tdestroyGroupMain() : void {\n\t\tthis._groupState = null;\n\t\tclearTimeout(this._syncGroupTimeout);\n\t\tthis.handleMainChange(false);\n\t}\n\n\tgroupShadow() : void {\n\t\tthis._groupState = TagSettingRegistry.STATE_SHADOW;\n\t\tthis.$el.addClass('is--shadow');\n\t}\n\n\tsyncGroupDelayed() : void {\n\t\tclearTimeout(this._syncGroupTimeout);\n\t\tthis._syncGroupTimeout = setTimeout(() => this.syncGroup(), 100);\n\t}\n\n\tsyncGroup() : void {\n\t\tTagSettingRegistry.sync(this.options.group, this);\n\t}\n\n\tenabled() : boolean {\n\t\treturn this._enabled;\n\t}\n\n\tenable() : void {\n\t\tif (this.options.group == null) { return; }\n\n\t\tthis._enabled = true;\n\t\tTagSettingRegistry.enable(this.options.group, this);\n\t}\n\n\tdisable() : void {\n\t\tif (this.options.group == null) { return; }\n\n\t\tthis._enabled = false;\n\t\tTagSettingRegistry.disable(this.options.group, this);\n\t}\n\n}","const BX = window.BX;\nconst Reference = BX.namespace('YandexMarket.Field.Reference');\n\nexport class TagSettings extends Reference.Complex {\n\n\tstatic dataName = 'FieldParamTagSettings';\n\tstatic defaults = Object.assign({}, Reference.Complex.prototype.defaults, {\n\t\tinputElement: '.js-param-tag-settings__input', // not used\n\t\tchildElement: '.js-param-tag-settings__child',\n\n\t\tlang: {},\n\t\tlangPrefix: 'YANDEX_MARKET_FIELD_PARAM_'\n\t});\n\n\tenable() : void {\n\t\tthis.callChildList('enable');\n\t}\n\n\tdisable() : void {\n\t\tthis.callChildList('disable');\n\t}\n\n}"],"names":["$","window","YMarketJQuery","jQuery","BX","fn","select2","amd","define","ArrayAdapter","Utils","SearchAdapter","$element","options","searchVariants","get","set","__super__","constructor","call","this","Extend","prototype","query","params","callback","data","self","term","length","forEach","option","matches","push","results","Plugin","namespace","Reference","Source","utils","Node","Base","initialize","bind","initValueUi","destroy","unbind","handleSourceChange","handleInputChange","handleLinkedSourceFieldChange","dir","getElement","proxy","onSourceChange","handleParentField","field","handleCopyTypeFieldChange","handleCopyTypeSelfFieldInput","parentField","type","copyType","getTypeCollection","getElementSelector","onCopyTypeFieldChange","$el","onCopyTypeSelfFieldInput","linkedSources","onLinkedSourceFieldChange","inputSelector","onInputChange","evt","refreshField","target","value","input","currentTarget","copyFieldValue","_fieldValueUserInput","source","val","indexOf","trigger","node","preselect","find","i","selected","setValue","sourceElement","reflowFieldSelected","syncLinked","syncLinkedSource","syncLinkedField","element","found","marker","replace","clear","setParentField","previousParent","getParentField","isFieldValueUserInput","fieldValue","fromElement","fieldElement","fieldTagName","prop","toLowerCase","fromTagName","tagName","fromValue","filter","text","trim","typeId","_lastSource","manager","getManager","getType","updateField","fieldEnumList","fieldEnum","content","fieldType","needType","getFieldList","required","getLang","escape","renderField","html","templateKey","substring","toUpperCase","template","getTemplate","fieldSelector","oldWrap","newWrap","newField","newFieldInputs","add","destroyValueUi","copyAttrList","insertAfter","remove","getElementFieldWrap","destroyElement","firstPlugin","initializeElement","setOptions","sourceManager","sourceType","nodeType","render","fieldWrapper","plugin","getInstance","sliceOnlyFieldValue","getElementField","hasClass","key","item","Object","entries","exec","result","toElements","attrList","toIndex","toElement","fromValues","readAttrList","eq","writeAttrList","attributeNames","complexPosition","attributeName","attributeValue","complex","complexFull","attr","attributeValues","hasOwnProperty","getSourceManager","getRecommendationList","getTypeFieldList","valueType","_manager","Manager","dataName","defaults","assign","managerElement","inputElement","fieldWrapElement","templateButtonElement","fieldTextTemplate","fieldFormulaTemplate","fieldSelectTemplate","fieldTemplateTemplate","langPrefix","lang","top","TagFactory","_valid","handleOpenClick","onOpenClick","direct","group","collection","addTag","open","preventDefault","items","el","OPENER","adminShowMenu","dropdownMenu","active_class","classList","contains","SetMenu","dropdownItems","tagsMap","tagId","state","TEXT","HTML","ONCLICK","showItem","toggleItem","toggleVisible","hideItem","hasActiveItems","toggleClass","Tag","Complex","getChildField","enable","settings","disable","childElement","TagCollection","Collection","initializeFactory","destroyFactory","handleItemDeleteClick","itemDeleteSelector","onItemDeleteClick","deleteButton","deleteItem","typeCollection","wasHidden","newInstance","addItem","context","method","sourceItem","isMultiple","isRequired","itemType","toggleItemDeleteView","_factory","_factoryIndex","toggleTitle","super","isPersistent","clearItem","addClass","destroyItem","getActiveItems","isIncludePlaceholder","index","setFactory","factory","callItemList","getItemPlugin","titleElement","itemElement","itemDeleteElement","factoryElement","NodeCollection","handleLinkedChange","onLinkedChange","itemInstance","TagGroupFactory","groups","groupFlat","map","MENU","TagGroup","initializeTagCollection","destroyTagCollection","collectionElements","_tagCollections","tagCollection","addElement","TagSettingRegistry","name","setting","groupsMain","enabled","groupMain","groupShadow","getValue","splice","destroyGroupMain","_searchNewMain","sibling","skip","STATE_MAIN","STATE_SHADOW","TagSetting","hasAttribute","_enabled","removeAttribute","pushRegistry","shiftRegistry","handleMainChange","onMainChange","syncGroupDelayed","_groupState","shift","removeClass","clearTimeout","_syncGroupTimeout","setTimeout","syncGroup","sync","TagSettings","callChildList"],"mappings":"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"}