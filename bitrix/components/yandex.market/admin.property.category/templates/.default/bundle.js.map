{"version":3,"file":"bundle.js","sources":["src/CategoryField.js","src/Parameters/Row.js","src/Parameters/ValueType/Control.js","src/Parameters/ValueType/SelectSkeleton.js","src/Parameters/ValueType/InitialControl.js","src/Component/utils.js","src/Parameters/ValueType/TextControl.js","src/Parameters/ValueType/EnumControl.js","src/Parameters/ValueType/BooleanControl.js","src/Parameters/ValueType/NumberControl.js","src/Parameters/ParameterRow.js","src/Parameters/ValueType/Factory.js","src/Parameters/FactoryMenu.js","src/Parameters/Dto/Parameter.js","src/Parameters/Dto/ParameterCollection.js","src/Parameters/ParametersRegistry.js","src/Parameters/ValueType/ParentControl.js","src/Parameters/ParentRow.js","src/Parameters/Dto/UnknownParameter.js","src/ParametersField.js","src/Component/Transport.js","src/Component/Locale.js","src/Component/Form.js","src/Component/State.js","src/CategoryPanel.js","src/CategoryFactory.js"],"sourcesContent":["import type {Transport} from \"./Component/Transport\";\nimport type {Locale} from \"./Component/Locale\";\n\nconst $ = window.YMarketJQuery || window.jQuery;\n\nexport class CategoryField {\n\n    static defaults = {\n\t\tselectElement: 'select',\n\t    parentElement: '[data-entity=\"parentCategory\"]',\n\t    copyElement: '[data-entity=\"copy\"]',\n    }\n\n\t_bindSearchPaste = false;\n    _lastError;\n\n    constructor(element: HTMLSelectElement, transport: Transport, locale: Locale, options: Object = {}) {\n        this.$el = $(element);\n        this.el = element;\n        this.options = Object.assign({}, this.constructor.defaults, options);\n        this.transport = transport;\n        this.locale = locale;\n\n\t    this.bind();\n        this.bootSelect();\n    }\n\n\tdestroy() : void {\n\t\tthis.unbind();\n\t\tthis.destroySelect();\n\t}\n\n\tbind() {\n\t\tthis.handleSelectOpen(true);\n\t\tthis.handleSelectClose(true);\n\t\tthis.handleCopy(true);\n\t}\n\n\tunbind() {\n\t\tthis.handleSelectOpen(false);\n\t\tthis.handleSelectClose(false);\n\t\tthis.handleSearchPaste(false);\n\t\tthis.handleCopy(false);\n\t}\n\n\thandleChange(dir: boolean, callback: () => {}) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('change', callback);\n\t}\n\n\thandleCopy(dir: boolean) : void {\n\t\tthis.$el.find(this.options.copyElement)[dir ? 'on' : 'off']('click', this.onCopyClick);\n\t}\n\n\thandleSelectOpen(dir: boolean) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('select2:open', this.onSelectOpen);\n\t}\n\n\thandleSelectClose(dir: boolean) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('select2:closing', this.onSelectClosing);\n\t}\n\n\thandleSearchPaste(dir: boolean) : void {\n\t\tif (this._bindSearchPaste === dir) { return; }\n\n\t\tconst search = $('.select2-search__field');\n\n\t\tsearch[dir ? 'on' : 'off']('paste', this.onSearchPaste);\n\t\tthis._bindSearchPaste = dir;\n\t}\n\n\tonCopyClick = () : void => {\n\t\tthis.copyClipboard(this.value() || this.parentValue());\n\t}\n\n\tonSelectOpen = () : void => {\n\t\tthis.handleSearchPaste(true);\n\t}\n\n\tonSelectClosing = () : void => {\n\t\tthis.handleSearchPaste(false);\n\t}\n\n\tonSearchPaste = (e) : void => {\n\t\tconst paste = (e.originalEvent.clipboardData || window.clipboardData).getData('text/plain').toString();\n\t\tconst lines = paste.split(/(\\n\\r|\\n|\\r)/gm).map((line) => line.trim()).filter((line) => line !== '');\n\n\t\tif (paste.indexOf(' / ') !== -1 || lines.length < 2) { return; }\n\n\t\te.target.value = lines.join(' / ');\n\t\te.preventDefault();\n\n\t\t$(e.target).trigger('input');\n\t}\n\n    bootSelect() : void {\n        this.selectElement().select2(Object.assign({}, {\n\t        width: '100%',\n            minimumInputLength: 2,\n            selectOnClose: true,\n\t        allowClear: true,\n            ajax: {\n                cache: true,\n                delay: 1000,\n                transport: this.ajaxTransport,\n            },\n            templateSelection: this.templateSelection,\n        }, this.getLanguageOptions()));\n    }\n\n\tdestroySelect() : void {\n\t\tthis.selectElement().select2('destroy');\n\t}\n\n    getLanguageOptions() : Object {\n        return {\n            placeholder: this.parentValue() || this.locale.message('CATEGORY_PLACEHOLDER'),\n            language: Object.assign(this.languageDefaults(), {\n                errorLoading: () => {\n                    if (this._lastError != null) {\n                        const error = this._lastError;\n                        this._lastError = null;\n\n                        return error;\n                    }\n\n                    return this.locale.message('CATEGORY_LOAD_ERROR');\n                },\n            }),\n        }\n    }\n\n    languageDefaults() : Object {\n        try {\n            // noinspection JSUnresolvedReference\n\t        return $.fn.select2.amd.require(`select2/i18n/${this.locale.language()}`)\n        } catch (e) {\n            console.error(e);\n            return {};\n        }\n    }\n\n    ajaxTransport = (params: Object, success: () => {}, failure: () => {}) : void => {\n\t    if (/.+\\/.+\\[\\d+]/.test(params.data.q)) {\n\t\t    success(this.prepareResults([params.data.q]));\n\t\t    return;\n\t    }\n\n        this.transport.fetch('categories', {\n            query: params.data.q,\n            language: this.locale.language(),\n        })\n            .then((data) => {\n                success(this.prepareResults(data));\n            })\n            .catch((error: Error) => {\n                this._lastError = error.message;\n                failure();\n            });\n\n        return {};\n    }\n\n\tprepareResults(variants: string[]) {\n\t\treturn {\n\t\t\tresults: variants.map((variant: string) => {\n\t\t\t\treturn {id: variant, text: variant};\n\t\t\t}),\n\t\t};\n\t}\n\n    templateSelection = (variant: Object) : string => {\n        return variant.id === '' ? variant.text : variant.id;\n    }\n\n\tcopyClipboard(text: string) : void {\n\t\tconst fake = $('<textarea></textarea>').css({\n\t\t\tposition: 'absolute',\n\t\t\tleft: '-9999px',\n\t\t\ttop: '-9999px',\n\t\t});\n\n\t\tfake.insertAfter(this.$el);\n\t\tfake.val(text);\n\t\tfake[0].select();\n\n\t\tthis.execCommand('copy');\n\n\t\tfake.remove();\n\t}\n\n\texecCommand(command: string) : boolean {\n\t\ttry {\n\t\t\t// noinspection JSDeprecatedSymbols\n\t\t\tdocument.execCommand(command);\n\t\t\treturn true;\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tselectElement() {\n\t\treturn this.$el.find(this.options.selectElement);\n\t}\n\n\tresetParent(category: string) : void {\n\t\tconst placeholder = category || this.locale.message('CATEGORY_PLACEHOLDER');\n\n\t\tthis.$el.find(this.options.parentElement).val(category || '');\n\n\t\tthis.$el.find('.select2-selection__rendered').attr('title', placeholder)\n\t\tthis.$el.find('.select2-selection__placeholder').text(placeholder);\n\t}\n\n\tparentValue() : string {\n\t\treturn this.$el.find(this.options.parentElement).val();\n\t}\n\n\tvalue() : ?string {\n\t\treturn this.selectElement().val();\n\t}\n}","import type {ParametersField} from \"../ParametersField\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {Control} from \"./ValueType/Control\";\n\nconst BX = window.BX;\n\nexport class Row {\n\n\tstatic defaults = {\n\t\tid: null,\n\t\thintElement: '[data-entity=\"hint\"]',\n\t\tfieldElement: '[data-entity=\"field\"]',\n\t\tvalueElement: '[data-entity=\"value\"]',\n\t}\n\n\tcontrol: Control;\n\t_hintHover: boolean;\n\n\tconstructor(element: HTMLElement, field: ParametersField, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.field = field;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.el.dataset, options);\n\t\tthis.id = +(this.options.id || this.el.dataset.id);\n\t}\n\n\tdestroy() : void {\n\t\tthis.field.parametersRegistry.stopWait(this.id, this.onParameterWait);\n\t\tthis.handleHintHover(false);\n\t\tthis.control.destroy();\n\t\tthis.control = null;\n\t\tthis.options = null;\n\t\tthis.el = null;\n\t}\n\n\tinitial() : void {\n\t\tthis.handleHintHover(true);\n\t\tthis.control = this.initialControl();\n\t\tthis.field.parametersRegistry.wait(this.id, this.onParameterWait);\n\t}\n\n\tonParameterWait = (parameter: Parameter) : void => {\n\t\tthis.render(parameter, this.field.values());\n\t}\n\n\tinitialControl() : Control {\n\t\tthrow new Error('not implemented');\n\t}\n\n\tinitialLoad() : Promise {\n\t\treturn this.field.parametersRegistry.initialLoad();\n\t}\n\n\trender(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tthis.handleHintHover(false);\n\t\tthis.setHint(parameter.description());\n\t\tthis.setRequired(parameter.required());\n\t\tthis.renderControl(parameter, values);\n\t}\n\n\trenderControl(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tif (this.control != null) {\n\t\t\tconst name = this.control.el.name.replace(/\\[]$/, '');\n\t\t\tconst value = this.control.value();\n\t\t\tconst focused = this.control.focused();\n\n\t\t\tthis.control.el.remove();\n\t\t\tthis.control.destroy();\n\n\t\t\tthis.control = this.parameterControl(parameter, name, values);\n\t\t\tthis.control.setValue(value);\n\n\t\t\tif (focused) {\n\t\t\t\tthis.control.focus();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.control = this.parameterControl(parameter, `${this.options.name}[VALUE]`, values);\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>) : Control {\n\t\tthrow new Error('not implemented');\n\t}\n\n\thandleHintHover(dir: boolean) : void {\n\t\tconst hint = this.el.querySelector(this.options.hintElement);\n\n\t\thint[dir ? 'addEventListener' : 'removeEventListener']('mouseenter', this.onHintEnter);\n\t\thint[dir ? 'addEventListener' : 'removeEventListener']('mouseleave', this.onHintLeave);\n\t}\n\n\tonHintEnter = () : void => {\n\t\tif (this._hintHover == null) {\n\t\t\tthis.initialLoad().then(() => {\n\t\t\t\tthis.handleHintHover(false);\n\t\t\t\t// noinspection JSUnresolvedReference\n\t\t\t\tthis._hintHover && this._hint && this._hint.Show();\n\t\t\t});\n\t\t}\n\n\t\tthis._hintHover = true;\n\t}\n\n\tonHintLeave = () : void => {\n\t\tthis._hintHover = false;\n\t}\n\n\tsetHint(text: ?string) : void {\n\t\tconst hint = this.el.querySelector(this.options.hintElement);\n\n\t\tif (!text) {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\tthis._hint && this._hint.Destroy();\n\t\t\tthis._hint = null;\n\t\t\thint.classList.add('is--hidden');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._hint != null) {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\tthis._hint.CONTENT ? this._hint.setContent(text) : (this._hint.HINT = text);\n\t\t\treturn;\n\t\t}\n\n\t\thint.classList.remove('is--hidden');\n\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._hint = new BX.CHint({\n\t\t\tparent: hint,\n\t\t\thint: text,\n\t\t\tshow_timeout: 30,\n\t\t});\n\t}\n\n\tsetRequired(required: boolean) : void {\n\t\tthis.el.classList[required ? 'add' : 'remove']('is--required');\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.control.setValue(value);\n\t}\n\n\tvalue() {\n\t\treturn this.control.value();\n\t}\n}","export class Control {\n\n\tconstructor(element: HTMLInputElement|HTMLSelectElement) {\n\t\tthis.el = element;\n\t}\n\n\tdestroy() : void {\n\t\tthis.el = null;\n\t}\n\n\tboot() : void {}\n\n\tvalue(): string|string[] {\n\t\treturn this.el.value;\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.el.value = value != null ? value : '';\n\t}\n\n\tfocused(): boolean {\n\t\treturn (document.activeElement === this.el);\n\t}\n\n\tfocus() {\n\t\tthis.el.focus();\n\t}\n}","// noinspection JSUnresolvedVariable\nimport {Control} from \"./Control\";\n\nconst $ = window.YMarketJQuery ?? window.$;\n\nexport class SelectSkeleton extends Control {\n\n\tconstructor(element: HTMLSelectElement, language: string) {\n\t\tsuper(element);\n\t\tthis.$el = $(element);\n\t\tthis.language = language;\n\t}\n\n\tboot() : void {\n\t\tthis.$el.select2({\n\t\t\twidth: '100%',\n\t\t\tlanguage: this.language,\n\t\t\ttags: this.allowedCustom(),\n\t\t});\n\t}\n\n\tallowedCustom() : boolean {\n\t\treturn {};\n\t}\n\n\tdestroy() : void {\n\t\tthis.$el.select2('destroy');\n\t}\n\n\tvalue() : string|string[] {\n\t\tif (!this.el.multiple) { return this.el.value; }\n\n\t\tconst selected = [];\n\n\t\tfor (const option of this.el.querySelectorAll('option')) {\n\t\t\tif (option.selected) {\n\t\t\t\tselected.push(option.value);\n\t\t\t}\n\t\t}\n\n\t\treturn selected;\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tconst selected = this._toArray(value);\n\t\tconst found = [];\n\t\tlet placeholder;\n\t\tlet first = true;\n\t\tlet changed = false;\n\n\t\tfor (const option of this.el.querySelectorAll('option')) {\n\t\t\tif (first && option.value === '') {\n\t\t\t\tplaceholder = option;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst matched = (selected.indexOf(option.value) !== -1);\n\n\t\t\tif (matched) {\n\t\t\t\tfound.push(option.value);\n\t\t\t}\n\n\t\t\tif (matched !== option.selected) {\n\t\t\t\toption.selected = matched;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (this.allowedCustom()) {\n\t\t\tfor (const selectedItem of selected) {\n\t\t\t\tif (found.indexOf(selectedItem) !== -1) { continue; }\n\n\t\t\t\tconst option = document.createElement('option');\n\t\t\t\toption.textContent = selectedItem;\n\n\t\t\t\tthis.el.appendChild(option);\n\t\t\t\toption.selected = true;\n\t\t\t\tfound.push(selectedItem);\n\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\n\t\tconst placeholderSelected = (found.length === 0);\n\n\t\tif (placeholder != null && placeholder.selected !== placeholderSelected) {\n\t\t\tplaceholder.selected = placeholderSelected;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tchanged && this.$el.triggerHandler('change.select2');\n\t}\n\n\tfocus() : void {\n\t\tthis.$el.select2('close');\n\t\tthis.$el.select2('open');\n\t}\n\n\tfocused() : boolean {\n\t\treturn this.$el.select2('isOpen');\n\t}\n\n\t_toArray(value: string|string[]|null) : string[] {\n\t\tif (value == null) { return []; }\n\n\t\treturn Array.isArray(value) ? value : [ value ];\n\t}\n}","import {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class InitialControl extends SelectSkeleton {\n\n\t_focusCallback;\n\n\tdestroy() : void {\n\t\tthis.unbindFocus();\n\t\tsuper.destroy();\n\t}\n\n\tbindFocus(callback: () => {}) : void {\n\t\tthis._focusCallback = callback;\n\t\tthis.$el.on('select2:opening', callback);\n\t}\n\n\tunbindFocus() : void {\n\t\tif (this._focusCallback == null) { return; }\n\n\t\tthis.$el.off('select2:opening', this._focusCallback);\n\t\tthis._focusCallback = null;\n\t}\n}","export function compileTemplate(template, variables) {\n\tlet result = template;\n\n\tif (variables == null) { return result; }\n\n\tfor (const [key, value] of Object.entries(variables)) {\n\t\tconst marker = '#' + key + '#';\n\t\tlet previousPosition = -1;\n\t\tlet position = -1;\n\n\t\tdo {\n\t\t\tpreviousPosition = position;\n\t\t\tresult = result.replace(marker, value);\n\n\t\t\tposition = result.indexOf(marker);\n\t\t} while (position !== -1 && position > previousPosition);\n\t}\n\n\treturn result;\n}\n\nexport function htmlToElement(html, tag = 'div') {\n\tconst renderer = document.createElement(tag);\n\n\trenderer.innerHTML = html;\n\n\tif (tag === 'table') {\n\t\treturn renderer.firstElementChild.firstElementChild;\n\t}\n\n\treturn renderer.firstElementChild;\n}","import {Control} from \"./Control\";\nimport {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/parameter\";\n\nexport class TextControl extends Control {\n\n\tstatic make(parameter: Parameter, name: string) : TextControl {\n\t\tconst maxLength = parameter.maxLength();\n\n\t\treturn new TextControl(htmlToElement(`<input\n\t\t \tclass=\"ym-category-parameter__control adm-input\"\n\t\t\ttype=\"text\"\n\t\t\tname=\"${name}\"\n\t\t\t${maxLength != null ? `maxlength=\"${maxLength}\"` : ''}\n\t\t/>`));\n\t}\n\n}","import {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class EnumControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, name: string, language: string) : EnumControl {\n\t\tconst multiple = parameter.multiple();\n\t\tconst element = htmlToElement(`<select class=\"ym-category-parameter__control\" name=\"${name}${multiple ? '[]' : ''}\" ${multiple ? 'multiple' : ''}>\n\t\t\t${multiple ? '' : '<option value=\"\" disabled></option>'}\n\t\t</select>`);\n\n\t\treturn new EnumControl(element,\tlanguage, parameter);\n\t}\n\n\t_changeCallback;\n\n\tconstructor(element: HTMLSelectElement, language: string, parameter: Parameter) {\n\t\tsuper(element, language);\n\t\tthis.parameter = parameter;\n\t}\n\n\tdestroy() : void {\n\t\tthis.parameter = null;\n\t\tthis.unbindChange();\n\t\tsuper.destroy();\n\t}\n\n\tallowedCustom(): boolean {\n\t\treturn this.parameter.allowCustom();\n\t}\n\n\tbindChange(callback: () => {}) : void {\n\t\tthis._changeCallback = callback;\n\t\tthis.$el.on('change', this._changeCallback);\n\t}\n\n\tunbindChange() : void {\n\t\tif (this._changeCallback == null) { return; }\n\n\t\tthis.$el.off('change', this._changeCallback);\n\t\tthis._changeCallback = null;\n\t}\n\n\treflow(selected: Object<number, string|string[]>) : void {\n\t\tconst selfSelected = this._toArray(selected[this.parameter.id()]);\n\t\tconst existOptions = this.el.querySelectorAll('option');\n\t\tconst placeholder = existOptions[0] && existOptions[0].disabled ? existOptions[0] : null;\n\t\tconst allowedCustom = this.allowedCustom();\n\t\tlet existIndex = placeholder != null ? 1 : 0; // after placeholder\n\t\tlet selectedFound = [];\n\n\t\tfor (const value of this._activeValues(selected)) {\n\t\t\tlet matchedOption;\n\n\t\t\twhile (existOptions[existIndex] != null) {\n\t\t\t\tconst existOption = existOptions[existIndex];\n\n\t\t\t\tif (existOption.dataset.id == null) { // custom\n\t\t\t\t\tif (allowedCustom && selfSelected.includes(existOption.value)) {\n\t\t\t\t\t\texistOption.selected = true;\n\t\t\t\t\t\tselectedFound.push(existOption.value);\n\t\t\t\t\t\t++existIndex;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else if (+existOption.dataset.id === value.id) {\n\t\t\t\t\tmatchedOption = existOption;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\texistOption.remove();\n\t\t\t\t++existIndex;\n\t\t\t}\n\n\t\t\tif (matchedOption == null) {\n\t\t\t\tconst anchor = existOptions[existIndex + 1];\n\t\t\t\tmatchedOption = document.createElement('option');\n\t\t\t\tmatchedOption.value = `${value.value} [${value.id}]`;\n\t\t\t\tmatchedOption.textContent = value.value;\n\t\t\t\tmatchedOption.dataset.id = value.id;\n\n\t\t\t\tif (anchor) {\n\t\t\t\t\tthis.el.insertBefore(matchedOption, anchor);\n\t\t\t\t} else {\n\t\t\t\t\tthis.el.appendChild(matchedOption);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst optionSelected = selfSelected.includes(matchedOption.value);\n\t\t\tmatchedOption.selected = optionSelected;\n\n\t\t\tif (optionSelected) {\n\t\t\t\tselectedFound.push(matchedOption.value);\n\t\t\t}\n\t\t}\n\n\t\tif (placeholder != null) {\n\t\t\tplaceholder.selected = (selectedFound.length === 0);\n\t\t}\n\t}\n\n\t_activeValues(selected: Object<number, string|string[]>) : Object[] {\n\t\tconst values = this.parameter.values();\n\t\tconst restricted = this._restricted(selected);\n\n\t\tif (restricted === null) { return values; }\n\n\t\tconst restrictedValues = [];\n\n\t\tfor (const value of values) {\n\t\t\tif (restricted.includes(value.id)) {\n\t\t\t\trestrictedValues.push(value);\n\t\t\t}\n\t\t}\n\n\t\treturn restrictedValues;\n\t}\n\n\t_restricted(selected: Object<number, string|string[]>) : ?number[] {\n\t\tconst restrictions = this.parameter.valueRestrictions();\n\n\t\tif (restrictions == null) { return null; }\n\n\t\tlet restricted = null;\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tconst limitingId = restriction['limitingParameterId'];\n\n\t\t\tif (selected[limitingId] == null) { continue; }\n\n\t\t\tconst siblingValue = this._castOptionIds(selected[limitingId]);\n\n\t\t\tfor (const limitedValue of restriction['limitedValues']) {\n\t\t\t\tif (!siblingValue.includes(limitedValue['limitingOptionValueId'])) { continue; }\n\n\t\t\t\tif (restricted == null) {\n\t\t\t\t\trestricted = limitedValue['optionValueIds'];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst newRestricted = [];\n\n\t\t\t\tfor (const id of restricted) {\n\t\t\t\t\tif (limitedValue['optionValueIds'].includes(id)) {\n\t\t\t\t\t\tnewRestricted.push(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trestricted = newRestricted;\n\t\t\t}\n\t\t}\n\n\t\treturn restricted;\n\t}\n\n\t_castOptionIds(selected) : number[] {\n\t\tif (selected == null) { return []; }\n\n\t\treturn this._toArray(selected)\n\t\t\t.map((item: string) : ?number => {\n\t\t\t\tconst idMatches = /\\[(\\d+)]$/.exec(item);\n\t\t\t\treturn idMatches ? +idMatches[1] : null;\n\t\t\t})\n\t\t\t.filter((item: ?number) : boolean => item != null);\n\t}\n}","import {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\nimport {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class BooleanControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, name: string, locale: Locale) : BooleanControl {\n\t\tconst element = htmlToElement(`<select class=\"ym-category-parameter__control\" name=\"${name}\">\n\t\t\t<option value=\"Y\">${locale.message('BOOLEAN_Y')}</option>\n\t\t\t<option value=\"N\">${locale.message('BOOLEAN_N')}</option>\n\t\t</select>`);\n\n\t\treturn new BooleanControl(element, locale.language());\n\t}\n\n}","import {Control} from \"./Control\";\nimport {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\n\nexport class NumberControl extends Control {\n\n\tstatic make(parameter: Parameter, name: string) : NumberControl {\n\t\tconst minValue = parameter.minValue();\n\t\tconst maxValue = parameter.maxValue();\n\n\t\treturn new NumberControl(htmlToElement(`<input\n \t\t\tclass=\"ym-category-parameter__control adm-input\" \n\t\t\ttype=\"number\" \n\t\t\tname=\"${name}\"\n\t\t\t${minValue != null ? `min=\"${minValue}\"` : ''}\n\t\t\t${maxValue != null ? `max=\"${maxValue}\"` : ''}\n\t\t/>`));\n\t}\n\n\tdestroy() : void {\n\t\tthis._handleInput(false);\n\t\tsuper.destroy();\n\t}\n\n\tboot() : void {\n\t\tthis._handleInput(true);\n\t}\n\n\t_handleInput(dir: boolean) : void {\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('input', this._onInput);\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('change', this._onChange);\n\t}\n\n\t_onInput = () => {\n\t\tconst value = parseFloat(this.el.value);\n\t\tconst valid = (\n\t\t\t!Number.isNaN(value)\n\t\t\t&& (this.el.min == null || value >= this.el.min)\n\t\t\t&& (this.el.max == null || value <= this.el.max)\n\t\t);\n\n\t\tthis._markInvalid(!valid);\n\t}\n\n\t_onChange = () => {\n\t\tconst value = parseFloat(this.el.value);\n\n\t\tif (isNaN(value)) {\n\t\t\tthis.el.value = '';\n\t\t} else if (this.el.min != null && value < this.el.min) {\n\t\t\tthis.el.value = this.el.min;\n\t\t} else if (this.el.max != null && value > this.el.max) {\n\t\t\tthis.el.value = this.el.max;\n\t\t}\n\n\t\tthis._markInvalid(false);\n\t}\n\n\t_markInvalid(dir : boolean) : void {\n\t\tthis.el.classList[dir ? 'add' : 'remove']('is--invalid');\n\t}\n}","import type {Parameter} from \"./Dto/Parameter\";\nimport {Row} from \"./Row\";\nimport {InitialControl} from \"./ValueType/InitialControl\";\nimport {htmlToElement} from \"../Component/utils\";\nimport type {ParametersField} from \"../ParametersField\";\nimport {Factory} from \"./ValueType/Factory\";\nimport type {Control} from \"./ValueType/Control\";\nimport {EnumControl} from \"./ValueType/EnumControl\";\n\nexport class ParameterRow extends Row {\n\n\tstatic defaults = Object.assign({}, Row.defaults, {\n\t\tname: null,\n\t\tdeleteElement: '[data-entity=\"delete\"]',\n\t});\n\n\tstatic make(parameter: Parameter, name: string, field: ParametersField) : ParameterRow {\n\t\tconst unit = parameter.defaultUnit();\n\t\tconst element = htmlToElement(`<tr class=\"ym-category-parameter\">\n\t\t\t<td class=\"ym-category-parameter__title\">\n\t\t\t\t<input type=\"hidden\" name=\"${name}[ID]\" value=\"${parameter.id()}\" />\n\t\t\t\t<input type=\"hidden\" name=\"${name}[NAME]\" value=\"${parameter.name()}\" />\n\t\t\t\t${unit != null \n\t\t\t\t\t? `<input type=\"hidden\" name=\"${name}[UNIT]\" value=\"${unit.name} [${unit.id}]\" />`\n\t\t\t\t\t: ''}\n\t\t\t\t<span class=\"ym-category-parameter__label\">${parameter.name()}${unit != null ? `, ${unit.name}` : ''}</span>\n\t\t\t\t<span class=\"ym-category-parameter__hint\" data-entity=\"hint\"></span>\n\t\t\t</td>\n\t\t\t<td class=\"ym-category-parameter__field\" data-entity=\"field\"></td>\n\t\t\t<td class=\"ym-category-parameter__actions\">\n\t\t\t\t<button class=\"ym-category-parameter__delete\" type=\"button\" data-entity=\"delete\">${field.locale.message('PARAMETER_DELETE')}</button>\n\t\t\t</td>\n        </tr>`, 'table');\n\n\t\treturn new ParameterRow(element, field, {\n\t\t\tid: parameter.id(),\n\t\t\tname: name,\n\t\t});\n\t}\n\n\tconstructor(element: HTMLElement, field: ParametersField, options: Object = {}) {\n\t\tsuper(element, field, options);\n\t\tthis.handleDelete(true);\n\t}\n\n\tdestroy() {\n\t\tthis.handleDelete(false);\n\t\tsuper.destroy();\n\t}\n\n\thandleDelete(dir: boolean) : void {\n\t\tconst button = this.el.querySelector(this.options.deleteElement);\n\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDelete);\n\t}\n\n\tonChange = () => {\n\t\tthis.field.reflowDepended(this.id);\n\t}\n\n\tonDelete = () => {\n\t\tthis.field.delete(this);\n\t}\n\n\tinitialControl() : InitialControl {\n\t\tconst control = new InitialControl(this.el.querySelector(this.options.valueElement), this.field.locale.language());\n\t\tcontrol.boot();\n\t\tcontrol.bindFocus(() => {\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tthis.initialLoad();\n\t\t});\n\n\t\treturn control;\n\t}\n\n\treflow(values: Object<number, string|string[]>) : void {\n\t\tif (!(this.control instanceof EnumControl)) { return; }\n\n\t\tthis.control.reflow(values);\n\t}\n\n\trender(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tsuper.render(parameter, values);\n\t\tthis.setDeprecated(false);\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>) : Control {\n\t\tconst field = this.el.querySelector(this.options.fieldElement);\n\t\tconst control = Factory.make(parameter, name, this.field.locale);\n\n\t\tif (control instanceof EnumControl) {\n\t\t\tcontrol.reflow(values);\n\t\t\tcontrol.bindChange(this.onChange);\n\t\t}\n\n\t\tfield.appendChild(control.el);\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n\n\tmarkDeprecated(): void {\n\t\tthis.setDeprecated(true);\n\t\tthis.setRequired(false);\n\t\tthis.setHint(this.field.locale.message('PARAMETER_DEPRECATED'));\n\t}\n\n\tsetDeprecated(deprecated: boolean) : void {\n\t\tthis.el.classList[deprecated ? 'add' : 'remove']('is--deprecated');\n\t}\n}","import {Control} from \"./Control\";\nimport {TextControl} from \"./TextControl\";\nimport {EnumControl} from \"./EnumControl\";\nimport {BooleanControl} from \"./BooleanControl\";\nimport {NumberControl} from \"./NumberControl\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\n\nexport class Factory {\n\n\tstatic make(parameter: Parameter, name: string, locale: Locale) : Control {\n\t\tconst type = parameter.type();\n\n\t\tif (type === 'ENUM') {\n\t\t\treturn EnumControl.make(parameter, name, locale.language());\n\t\t} else if (type === 'BOOLEAN') {\n\t\t\treturn BooleanControl.make(parameter, name, locale);\n\t\t} else if (type === 'NUMERIC') {\n\t\t\treturn NumberControl.make(parameter, name);\n\t\t}\n\n\t\treturn TextControl.make(parameter, name);\n\t}\n}","import type {Parameter} from \"./Dto/parameter\";\nimport type {Locale} from \"../Component/Locale\";\nimport type {ParametersField} from \"../ParametersField\";\nimport type {ParameterCollection} from \"./Dto/ParameterCollection\";\nimport {Row} from \"./Row\";\n\nconst BX = window.BX;\n\nexport class FactoryMenu {\n\n\t_opening = false;\n\n\tconstructor(element: HTMLElement, field: ParametersField, locale: Locale) {\n\t\tthis.el = element;\n\t\tthis.field = field;\n\t\tthis.locale = locale;\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu = new BX.CMenu({ parent: this.el });\n\n\t\tthis.handleClick(true);\n\t}\n\n\tdestroy() : void {\n\t\tthis._menu = null; // no way to destroy\n\t\tthis.handleClick(false);\n\t}\n\n\thandleClick(dir: boolean) : void {\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('click', this.onClick);\n\t}\n\n\tonClick = (evt: PointerEvent) : void => {\n\t\tevt.preventDefault();\n\n\t\tif (this._opening || this.isOpen()) { return; }\n\n\t\tthis._opening = true;\n\n\t\tthis.field.parametersRegistry.collection()\n\t\t\t.then((parameterCollection: ParameterCollection) => {\n\t\t\t\tthis._opening = false;\n\t\t\t\tthis.open(parameterCollection);\n\t\t\t})\n\t\t\t.catch((error: Error) => {\n\t\t\t\tthis._opening = false;\n\t\t\t\tthis.field.state.error(error);\n\t\t\t});\n\t}\n\n\tisOpen() : boolean {\n\t\tif (this._menu == null) { return false; }\n\n\t\treturn (this._menu.DIV.style.display || '').toLowerCase() === 'block';\n\t}\n\n\topen(parameterCollection: ParameterCollection) : void {\n\t\tif (parameterCollection.count() === 0) {\n\t\t\tthis.field.state.error(new Error(this.locale.message('EMPTY_PROPERTIES')));\n\t\t\treturn;\n\t\t}\n\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu.setItems(this.menuItems(parameterCollection));\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu.Show();\n\t}\n\n\tselect(parameter: Parameter) : void {\n\t\tthis.field.add(parameter);\n\t}\n\n\tmenuItems(parameterCollection: ParameterCollection) : Array {\n\t\tconst exists = this.field.rows.map((row: Row) : number => row.id)\n\t\tconst filled = this.field.rows.filter((row: Row) : boolean => !!row.value()).map((row: Row) : number => row.id);\n\t\tconst parameters = this.availableParameters(parameterCollection, exists, filled);\n\t\tconst result = [];\n\n\t\tfor (const parameter of parameters) {\n\t\t\tresult.push({\n\t\t\t\tTEXT: `${parameter.name()}${parameter.required() ? '*' : ''}`,\n\t\t\t\tHTML: `${parameter.name()}${parameter.required() ? '<span class=\"ym-category-required-flag\">*</span>' : ''}`,\n\t\t\t\tONCLICK: () => this.select(parameter),\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tavailableParameters(parameterCollection: ParameterCollection, exists: number[], filled: number[]) : Parameter[] {\n\t\tconst result = [];\n\n\t\tfor (const parameter of parameterCollection.all()) {\n\t\t\tif (exists.includes(parameter.id())) { continue; }\n\n\t\t\tif (parameter.shownDependsOn(filled)) {\n\t\t\t\tresult.push(parameter);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}","export class Parameter {\n\tstatic GROUP_ID = 200;\n\n\tconstructor(fields: Object) {\n\t\tthis.fields = fields;\n\t}\n\n\tid(): number {\n\t\treturn +this.fields['id'];\n\t}\n\n\ttype(): string {\n\t\treturn this.fields['type'];\n\t}\n\n\tmultiple(): boolean {\n\t\treturn !!this.fields['multivalue'];\n\t}\n\n\trequired(): boolean {\n\t\treturn !!this.fields['required'];\n\t}\n\n\tallowCustom(): boolean {\n\t\treturn !!this.fields['allowCustomValues'];\n\t}\n\n\tdescription(): string {\n\t\treturn this.fields['description'];\n\t}\n\n\tname(): string {\n\t\treturn this.fields['name'];\n\t}\n\n\tvalues(): Array {\n\t\treturn this.fields['values'] ?? [];\n\t}\n\n\tmaxLength(): string {\n\t\treturn this.fields['constraints']?.maxLength;\n\t}\n\n\tminValue(): string {\n\t\treturn this.fields['constraints']?.minValue;\n\t}\n\n\tmaxValue(): string {\n\t\treturn this.fields['constraints']?.maxValue;\n\t}\n\n\tvalueRestrictions(): Array|null {\n\t\treturn this.fields['valueRestrictions'];\n\t}\n\n\tshowByDefault(): boolean {\n\t\treturn this.required() && this.id() !== Parameter.GROUP_ID;\n\t}\n\n\tdefaultUnit() : ?{id: number, name: string} {\n\t\tif (this.fields['unit'] == null) { return null; }\n\n\t\tfor (const item of this.fields['unit']['units']) {\n\t\t\tif (this.fields['unit']['defaultUnitId'] === item.id) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdependsOn(id: number) : boolean {\n\t\tconst restrictions = this.valueRestrictions();\n\n\t\tif (restrictions == null) { return false; }\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tif (restriction['limitingParameterId'] === id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tshownDependsOn(ids: number[]) : boolean {\n\t\tconst restrictions = this.valueRestrictions();\n\n\t\tif (restrictions == null) { return true; }\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tif (ids.includes(restriction['limitingParameterId'])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}","import {Parameter} from \"./Parameter\";\n\nexport class ParameterCollection {\n\n\tconstructor(parameters: Array) {\n\t\tthis.collection = parameters.map((fields) => new Parameter(fields));\n\t}\n\n\tcount() : number {\n\t\treturn this.collection.length;\n\t}\n\n\tall(): Parameter[] {\n\t\treturn this.collection;\n\t}\n\n\titem(id: number) : ?Parameter {\n\t\tid = +id;\n\n\t\tfor (const property of this.collection) {\n\t\t\tif (property.id() === id) {\n\t\t\t\treturn property;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdependentOf(id: number): Parameter[] {\n\t\tconst result = [];\n\n\t\tfor (const other of this.collection) {\n\t\t\tif (other.dependsOn(id)) {\n\t\t\t\tresult.push(other);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}","import type {Transport} from \"../Component/Transport\";\nimport type {CategoryField} from \"../CategoryField\";\nimport {ParameterCollection} from \"./Dto/ParameterCollection\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {State} from \"../Component/State\";\n\nexport class ParametersRegistry {\n\n\t_parameters: ParameterCollection;\n\t_parametersPromise: Promise<ParameterCollection>;\n\t_parametersResolve;\n\t_itemWaiting = [];\n\n\tconstructor(category: CategoryField, transport: Transport, state: State) {\n\t\tthis.category = category;\n\t\tthis.transport = transport;\n\t\tthis.state = state;\n\t}\n\n\tinitialLoad() : Promise {\n\t\tif (this._parameters != null) { return Promise.resolve(this._parameters); }\n\n\t\treturn this.fetch();\n\t}\n\n\tloaded() : boolean {\n\t\treturn this._parameters != null;\n\t}\n\n\treset(parameterCollection: ParameterCollection) : void {\n\t\tthis._parameters = parameterCollection;\n\t\tthis.resolveWaiting();\n\t\tthis.resolveFetch();\n\t}\n\n\tcollection() : Promise<ParameterCollection> {\n\t\tif (this._parameters != null) { return Promise.resolve(this._parameters); }\n\n\t\treturn this.fetch();\n\t}\n\n\tstopWait(id: number, callback: () => {}) : void {\n\t\tfor (const index of this._itemWaiting.keys()) {\n\t\t\tconst [waitingId, waitingCallback] = this._itemWaiting[index];\n\n\t\t\tif (waitingId === id && waitingCallback === callback) {\n\t\t\t\tthis._itemWaiting.splice(index, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\twait(id: number, callback: () => {}) : void {\n\t\tif (this._parameters != null) {\n\t\t\tthis.resolveWaitingItem(id, callback);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._itemWaiting.push([ id, callback ]);\n\t}\n\n\tresolveWaiting() : void {\n\t\tfor (const [id, callback] of this._itemWaiting) {\n\t\t\tthis.resolveWaitingItem(id, callback);\n\t\t}\n\n\t\tthis._itemWaiting = [];\n\t}\n\n\tresolveWaitingItem(id: number, callback: () => {}) : void {\n\t\tconst parameter = this._parameters.item(id);\n\n\t\tif (parameter == null) { return; }\n\n\t\tcallback(parameter);\n\t}\n\n\titem(id: number) : Promise<Parameter> {\n\t\treturn this.collection()\n\t\t\t.then((parameterCollection: ParameterCollection) => {\n\t\t\t\tconst item = parameterCollection.item(id);\n\n\t\t\t\tif (item == null) {\n\t\t\t\t\tthrow new Error(`not found parameter {id}`);\n\t\t\t\t}\n\n\t\t\t\treturn item;\n\t\t\t});\n\t}\n\n\tfetch() : Promise<ParameterCollection> {\n\t\tif (this._parametersPromise != null) { return this._parametersPromise; }\n\n\t\tthis._parametersPromise = new Promise((resolve, reject) => {\n\t\t\tthis._parametersResolve = resolve;\n\t\t\tthis.state.loading();\n\n\t\t\tthis.transport.fetch('parameters', {\n\t\t\t\tparentCategory: this.category.parentValue(),\n\t\t\t\tcategory: this.category.value(),\n\t\t\t})\n\t\t\t\t.then((data) => {\n\t\t\t\t\tthis._parametersResolve = null;\n\t\t\t\t\tthis._parametersPromise = null;\n\t\t\t\t\tthis.state.waiting();\n\t\t\t\t\tthis.reset(new ParameterCollection(data.parameters));\n\t\t\t\t\tresolve(this._parameters);\n\t\t\t\t})\n\t\t\t\t.catch((error: Error) => {\n\t\t\t\t\tthis._parametersResolve = null;\n\t\t\t\t\tthis._parametersPromise = null;\n\t\t\t\t\tthis.state.error(error);\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t});\n\n\t\treturn this._parametersPromise;\n\t}\n\n\tresolveFetch() : void {\n\t\tif (this._parametersResolve == null) { return; }\n\n\t\tthis._parametersResolve(this._parameters);\n\t\tthis._parametersResolve = null;\n\t\tthis._parametersPromise = null;\n\t}\n}","import {SelectSkeleton} from \"./SelectSkeleton\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport {htmlToElement} from \"../../Component/utils\";\n\nexport class ParentControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, language: string) : ParentControl {\n\t\tconst multiple = parameter.multiple();\n\n\t\treturn new ParentControl(\n\t\t\thtmlToElement(`<select class=\"ym-category-parameter__control\" ${multiple ? 'multiple' : ''} disabled></select>`),\n\t\t\tlanguage\n\t\t);\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.el.innerHTML = '';\n\n\t\tfor (const item of this._toArray(value)) {\n\t\t\tconst idMatches = /^(.*)\\s\\[\\d+]$/.exec(item);\n\t\t\tconst option = document.createElement('option');\n\n\t\t\tif (idMatches !== null) {\n\t\t\t\toption.value = item;\n\t\t\t\toption.textContent = idMatches[1];\n\t\t\t} else {\n\t\t\t\toption.textContent = item;\n\t\t\t}\n\n\t\t\toption.selected = true;\n\t\t\tthis.el.appendChild(option);\n\t\t}\n\t}\n\n\tallowedCustom() : boolean {\n\t\treturn true;\n\t}\n}","import type {ParametersField} from \"../ParametersField\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {Control} from \"./ValueType/Control\";\nimport {ParentControl} from \"./ValueType/ParentControl\";\nimport {Row} from \"./Row\";\nimport {htmlToElement} from \"../Component/utils\";\n\nexport class ParentRow extends Row {\n\n\tstatic make(parameter: Parameter, field: ParametersField) : ParentRow {\n\t\tconst unit = parameter.defaultUnit();\n\t\tconst element = htmlToElement(`<tr class=\"ym-category-parameter\">\n\t\t\t<td class=\"ym-category-parameter__title\">\n\t\t\t\t<span class=\"ym-category-parameter__label\">${parameter.name()}${unit != null ? `, ${unit.name}` : ''}</span>\n\t\t\t\t<span class=\"ym-category-parameter__hint\" data-entity=\"hint\"></span>\n\t\t\t</td>\n\t\t\t<td class=\"ym-category-parameter__field\" data-entity=\"field\"></td>\n\t\t\t<td class=\"ym-category-parameter__actions\"></td>\n        </tr>`, 'table');\n\n\t\treturn new ParentRow(element, field, {\n\t\t\tid: parameter.id(),\n\t\t});\n\t}\n\n\tinitialControl() : Control {\n\t\tconst control = new ParentControl(this.el.querySelector(this.options.valueElement), this.field.locale.language());\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>): Control {\n\t\tconst field = this.el.querySelector(this.options.fieldElement);\n\t\tconst control = ParentControl.make(parameter, this.field.locale.language());\n\n\t\tfield.appendChild(control.el);\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n}","import {Parameter} from \"./Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\n\nexport class UnknownParameter extends Parameter {\n\tconstructor(id: number, multiple: boolean, locale: Locale) {\n\t\tsuper({\n\t\t\tid: id,\n\t\t\tmultivalue: multiple,\n\t\t\ttitle: locale.message('UNKNOWN_PARAMETER', { 'ID': id }),\n\t\t});\n\t}\n}","import {ParameterRow} from \"./Parameters/ParameterRow\";\nimport {FactoryMenu} from \"./Parameters/FactoryMenu\";\nimport {ParameterCollection} from \"./Parameters/Dto/ParameterCollection\";\nimport type {Parameter} from \"./Parameters/Dto/Parameter\";\nimport type {Locale} from \"./Component/Locale\";\nimport {ParametersRegistry} from \"./Parameters/ParametersRegistry\";\nimport {ParentRow} from \"./Parameters/ParentRow\";\nimport type {Row} from \"./Parameters/Row\";\nimport {UnknownParameter} from \"./Parameters/Dto/UnknownParameter\";\nimport type {State} from \"./Component/State\";\n\nexport class ParametersField {\n\n\tstatic defaults = {\n\t\tname: null,\n\t\tparentRowElement: '[data-entity=\"parentRow\"]',\n\t\trowElement: '[data-entity=\"parameterRow\"]',\n\t\taddElement: '[data-entity=\"parametersFactory\"]',\n\t};\n\n\trows: Row[];\n\trowsIndex;\n\n\tconstructor(element: HTMLElement, parametersRegistry: ParametersRegistry, state: State, locale: Locale, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t\tthis.state = state;\n\t\tthis.locale = locale;\n\t\tthis.parametersRegistry = parametersRegistry;\n\t\tthis.factoryMenu = new FactoryMenu(this.el.parentElement.querySelector(this.options.addElement), this, this.locale);\n\n\t\tthis.bootRows();\n\t}\n\n\tdestroy() : void {\n\t\tthis.destroyRows();\n\t\tthis.factoryMenu.destroy();\n\t}\n\n\treload(parameters: ParameterCollection, parentValues: Object<number, string|string[]>, onlySelfValue: boolean) : void {\n\t\tif (onlySelfValue) {\n\t\t\tthis.replaceParents(parameters);\n\t\t} else {\n\t\t\tthis.redrawParents(parameters, parentValues);\n\t\t}\n\n\t\tthis.redrawParameters(parameters);\n\t\tthis.redrawRequired(parameters);\n\n\t\tthis.parametersRegistry.reset(parameters);\n\t}\n\n\treplaceParents(parameters: ParameterCollection) : void {\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParentRow)) { continue; }\n\n\t\t\tconst parameter = parameters.item(row.id);\n\n\t\t\tif (parameter == null) {\n\t\t\t\tthis.delete(row);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst value = row.value();\n\t\t\tconst index = this.rows.indexOf(row);\n\t\t\tthis.delete(row);\n\n\t\t\tconst newRow = this.add(parameter, index + 1);\n\t\t\tnewRow.setValue(value);\n\t\t}\n\t}\n\n\tredrawParents(parameters: ParameterCollection, parentValues: Object<number, string|string[]>) : void {\n\t\tconst found = [];\n\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParentRow)) {\n\t\t\t\tif (parentValues[row.id] != null) {\n\t\t\t\t\tthis.delete(row);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parentValues[row.id] == null) {\n\t\t\t\tthis.delete(row);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfound.push(row.id);\n\t\t\trow.setValue(parentValues[row.id]);\n\t\t}\n\n\t\tfor (const [id, value] of Object.entries(parentValues)) {\n\t\t\tif (found.indexOf(+id) !== -1) { continue; }\n\n\t\t\tconst parameter = parameters.item(+id) || new UnknownParameter(+id, Array.isArray(value), this.locale);\n\t\t\tconst parent = this.addParent(parameter, 0);\n\n\t\t\tparent.setValue(value);\n\t\t}\n\t}\n\n\taddParent(parameter: Parameter) : ParentRow {\n\t\tconst container = this.el.tBodies[0] || this.el;\n\t\tconst row = ParentRow.make(parameter, this);\n\n\t\tcontainer.insertAdjacentElement('afterbegin', row.el);\n\t\trow.render(parameter, this.values());\n\n\t\tthis.rows.unshift(row);\n\n\t\tthis.el.classList.remove('is--empty');\n\n\t\treturn row;\n\t}\n\n\tredrawParameters(parameters: ParameterCollection) : void {\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParameterRow)) { continue; }\n\n\t\t\tconst parameter = parameters.item(row.id);\n\n\t\t\tif (parameter != null) {\n\t\t\t\trow.render(parameter, this.values());\n\t\t\t} else if (row.value()) {\n\t\t\t\trow.markDeprecated();\n\t\t\t} else {\n\t\t\t\tthis.delete(row);\n\t\t\t}\n\t\t}\n\t}\n\n\tredrawRequired(parameters: ParameterCollection) : void {\n\t\tconst exists = this.rows.map((row: Row) : number => row.id);\n\t\tconst filled = this.rows.filter((row: Row) : boolean => !!row.value()).map((row: Row) : number => row.id);\n\n\t\tfor (const parameter of parameters.all()) {\n\t\t\tif (!parameter.showByDefault() || exists.includes(parameter.id()) || !parameter.shownDependsOn(filled)) { continue; }\n\n\t\t\tthis.add(parameter);\n\t\t}\n\t}\n\n\tadd(parameter: Parameter, index: ?number = null) : ParameterRow {\n\t\tconst container = this.el.tBodies[0] || this.el;\n\t\tconst row = ParameterRow.make(parameter, `${this.options.name}[${this.rowsIndex}]`, this);\n\n\t\tif (index != null && this.rows[index] != null) {\n\t\t\tcontainer.insertBefore(row.el, this.rows[index].el);\n\t\t} else {\n\t\t\tindex = null;\n\t\t\tcontainer.appendChild(row.el);\n\t\t}\n\n\t\trow.render(parameter, this.values());\n\n\t\tif (index != null) {\n\t\t\tthis.rows.splice(index, 0, row);\n\t\t} else {\n\t\t\tthis.rows.push(row);\n\t\t}\n\n\t\t++this.rowsIndex;\n\n\t\tthis.el.classList.remove('is--empty');\n\n\t\treturn row;\n\t}\n\n\treflowDepended(id: number): void {\n\t\tthis.parametersRegistry.collection()\n\t\t\t.then((collection: ParameterCollection) => {\n\t\t\t\tfor (const parameter of collection.dependentOf(id)) {\n\t\t\t\t\tconst row = this.row(parameter.id());\n\n\t\t\t\t\tif (row instanceof ParameterRow) {\n\t\t\t\t\t\trow.reflow(this.values());\n\t\t\t\t\t} else if (row == null && parameter.showByDefault()) {\n\t\t\t\t\t\tconst anchor = this.row(id);\n\n\t\t\t\t\t\tif (anchor == null) { continue; }\n\n\t\t\t\t\t\tthis.add(parameter, this.rows.indexOf(anchor) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tbootRows() : void {\n\t\tthis.rows = [];\n\t\tthis.rowsIndex = 0;\n\n\t\tfor (const parentElement of this.el.querySelectorAll(this.options.parentRowElement)) {\n\t\t\tconst row = new ParentRow(parentElement, this);\n\t\t\trow.initial();\n\n\t\t\tthis.rows.push(row);\n\t\t}\n\n\t\tfor (const element of this.el.querySelectorAll(this.options.rowElement)) {\n\t\t\tconst row = new ParameterRow(element, this);\n\t\t\trow.initial();\n\n\t\t\tthis.rows.push(row);\n\t\t\t++this.rowsIndex;\n\t\t}\n\t}\n\n\tdestroyRows() : void {\n\t\tfor (const row of this.rows) {\n\t\t\trow.destroy();\n\t\t}\n\n\t\tthis.rows = [];\n\t}\n\n\tdelete(row: Row) : void {\n\t\tconst index = this.rows.indexOf(row);\n\n\t\tif (index === -1) { throw new Error('unknown item'); }\n\n\t\tconst el = row.el;\n\t\trow.destroy();\n\t\tel.remove();\n\n\t\tthis.rows.splice(index, 1);\n\n\t\tif (this.rows.length === 0) {\n\t\t\tthis.el.classList.add('is--empty');\n\t\t}\n\t}\n\n\trow(id: number) : ?Row {\n\t\tfor (const row of this.rows) {\n\t\t\tif (row.id === id) {\n\t\t\t\treturn row;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tvalues() : Object {\n\t\tconst result = {};\n\n\t\tfor (const row of this.rows) {\n\t\t\tresult[row.id] = row.value();\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","const BX = window.BX;\n\nexport class Transport {\n\n\tstatic defaults = {\n\t\turl: null,\n\t\tcomponentParameters: {},\n\t}\n\n\tconstructor(options: Object, apiKeyField: ?HTMLInputElement) {\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t\tthis.apiKeyField = apiKeyField;\n\t}\n\n\tfetch(action: string, payload: Object = {}) : Promise {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst formData = {\n\t\t\t\taction: action,\n\t\t\t\tpayload: payload,\n\t\t\t\tcomponentParameters: this.options.componentParameters,\n\t\t\t};\n\n\t\t\tif (this.apiKeyField != null)\n\t\t\t{\n\t\t\t\tformData['apiKey'] = this.apiKeyField.value;\n\t\t\t}\n\n\t\t\tBX.ajax({\n\t\t\t\turl: this.options.url,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: formData,\n\t\t\t\tonsuccess: (data) => {\n\t\t\t\t\tif (data.status === 'ok') {\n\t\t\t\t\t\tresolve(data.data);\n\t\t\t\t\t} else if (data.status === 'error') {\n\t\t\t\t\t\treject(new Error(data.message));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('unknown response format'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: (data) => {\n\t\t\t\t\treject(new Error(data.message));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}","import {compileTemplate} from \"./utils\";\n\nexport class Locale {\n\n    constructor(messages: Object, language: string) {\n        this._messages = messages;\n\t\tthis._language = language;\n    }\n\n    message(key: string, replaces: Array = null) : string {\n        const message = this._messages[key] || '';\n\n        return compileTemplate(message, replaces);\n    }\n\n\tlanguage() : string {\n\t\treturn this._language;\n\t}\n}","// noinspection JSUnresolvedVariable\nconst $ = window.YMarketJQuery ?? window.$;\n\nexport class Form {\n\n\tstatic defaults = {\n\t\ttype: null,\n\t\tpayload: {},\n\t\tfields: {},\n\t\tapiKeyField: null,\n\t}\n\n\tconstructor(form: ?HTMLFormElement, options: Object = {}) {\n\t\tthis.form = form;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tdestroy() : void {\n\t\tthis.form = null;\n\t}\n\n\thandleChange(dir: boolean, callback: () => {}): void {\n\t\tif (callback == null) { return; }\n\n\t\tfor (const [, selector] of Object.entries(this.options.fields)) {\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tthis.handleEvent(dir, callback, selector[0], selector[1], selector[2]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.handleEvent(dir, callback, selector);\n\t\t}\n\t}\n\n\thandleEvent(dir: boolean, callback: () => {}, selector: string, childSelector: ?string, eventName: ?string) : void {\n\t\tconst element = this.form.querySelector(this.cssSelector(selector));\n\n\t\tif (element == null) { return; }\n\n\t\tif (eventName === 'onLookupInputChange') {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\twindow.jsUtils[dir ? 'addCustomEvent' : 'removeCustomEvent']('onLookupInputChange', this.onLookupInputChange.bind(this, callback, element.id));\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName == null) { eventName = 'change'; }\n\n\t\tif (childSelector != null) {\n\t\t\t$(element)[dir ? 'on' : 'off'](eventName, this.cssSelector(childSelector), callback);\n\t\t\treturn;\n\t\t}\n\n\t\telement[dir ? 'addEventListener' : 'removeEventListener'](eventName, callback);\n\t}\n\n\tonLookupInputChange(callback: () => {}, layoutId: string, params: Object, data: Object) : void {\n\t\t// noinspection JSUnresolvedReference\n\t\tif (data.ACTION === 'add' && layoutId === `layout_${data.CONTROL_ID}`) {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\ttransportPayload() : Object {\n\t\treturn {\n\t\t\ttype: this.options.type,\n\t\t\tpayload: this.options.payload,\n\t\t\tfields: this.values(),\n\t\t};\n\t}\n\n\tvalues() {\n\t\tconst result = {};\n\n\t\tfor (const [key, elements] of Object.entries(this.fields())) {\n\t\t\tresult[key] = this.value(elements);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tvalue(input: HTMLInputElement|HTMLSelectElement) {\n\t\tif (!input.multiple) { return input.value; }\n\n\t\treturn Array.from(input.querySelectorAll('option'))\n\t\t\t.filter((option) => option.selected)\n\t\t\t.map((option) => option.value);\n\t}\n\n\tfields() : Object<string, HTMLInputElement|HTMLSelectElement> {\n\t\tif (!this.options.fields) { return {}; }\n\n\t\tconst result = {};\n\n\t\tfor (const [name, selector] of Object.entries(this.options.fields)) {\n\t\t\tconst input = this.field(selector);\n\n\t\t\tif (input == null) { continue; }\n\n\t\t\tresult[name] = input;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfield(selector: string|string[]|null) : ?HTMLInputElement|HTMLSelectElement {\n\t\tif (selector === null || this.form == null) { return null; }\n\n\t\tif (Array.isArray(selector)) {\n\t\t\tconst container = this.form.querySelector(this.cssSelector(selector[0]));\n\n\t\t\tif (container == null) { return null; }\n\n\t\t\treturn container.querySelector(this.cssSelector(selector[1]));\n\t\t}\n\n\t\treturn this.form.querySelector(this.cssSelector(selector));\n\t}\n\n\tapiKeyField() : ?HTMLInputElement {\n\t\treturn this.field(this.options.apiKeyField);\n\t}\n\n\tcssSelector(selector: string) : string {\n\t\tif (/^(input|select|textarea|div|#|\\.)/.test(selector)) {\n\t\t\treturn selector;\n\t\t}\n\n\t\treturn `[name=\"${selector}\"]`;\n\t}\n}","import {compileTemplate} from \"./utils\";\nimport type {Locale} from \"./Locale\";\n\nexport class State {\n\n\tstatic defaults = {\n\t\tloadingTemplate: '#LOADING#...',\n\t\twaitingTemplate: '',\n\t\terrorTemplate: '#MESSAGE#',\n\t};\n\n\tlocale: Locale;\n\n\tconstructor(element: HTMLElement, locale: Locale, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.locale = locale;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tloading() : void {\n\t\tthis.state('loading', {\n\t\t\tLOADING: this.locale.message('LOADING'),\n\t\t});\n\t}\n\n\twaiting() : void {\n\t\tthis.state('waiting');\n\t}\n\n\terror(reason: Error) : void {\n\t\tthis.state('error', {\n\t\t\tMESSAGE: reason.message,\n\t\t});\n\t}\n\n\tstate(type: string, vars: Object = {}) : void {\n\t\tconst html = this.compileTemplate(type, vars);\n\n\t\tthis.markTypeClass(type);\n\t\tthis.replaceHtml(html);\n\t}\n\n\tcompileTemplate(type: string, vars: Object = {}) : string {\n\t\tconst template = this.options[type + 'Template'];\n\n\t\treturn compileTemplate(template, vars);\n\t}\n\n\tmarkTypeClass(type: string) : void {\n\t\tconst states = [\n\t\t\t'loading',\n\t\t\t'waiting',\n\t\t\t'error',\n\t\t];\n\n\t\tfor (const state of states) {\n\t\t\tif (state === type) {\n\t\t\t\tthis.el.classList.add(`is--${state}`);\n\t\t\t} else {\n\t\t\t\tthis.el.classList.remove(`is--${state}`);\n\t\t\t}\n\t\t}\n\t}\n\n\treplaceHtml(html: string) : void {\n\t\tthis.el.innerHTML = html;\n\t}\n}","import {CategoryField} from \"./CategoryField\";\nimport {ParametersField} from \"./ParametersField\";\nimport {Transport} from \"./Component/Transport\";\nimport {Locale} from \"./Component/Locale\";\nimport {Form} from \"./Component/Form\";\nimport {State} from \"./Component/State\";\nimport {ParameterCollection} from \"./Parameters/Dto/ParameterCollection\";\nimport {ParametersRegistry} from \"./Parameters/ParametersRegistry\";\n\n// noinspection JSUnusedGlobalSymbols\nexport class CategoryPanel {\n\n    static defaults = {\n        transport: null,\n\t    language: 'ru',\n\t    locale: null,\n\t    form: null,\n\t    category: null,\n        categoryElement: '[data-entity=\"category\"]',\n\t    parameters: null,\n        parametersElement: '[data-entity=\"parameters\"]',\n\t    stateElement: '[data-entity=\"state\"]',\n    }\n\n\t_reloadTimeout;\n\n\tconstructor(element: HTMLElement, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t\tthis.form = new Form(this.el.closest('form'), this.formOptions());\n\t\tthis.locale = new Locale(this.options.locale, this.options.language);\n\t\tthis.transport = new Transport(this.options.transport, this.form.apiKeyField());\n\t\tthis.state = new State(element.querySelector(this.options.stateElement), this.locale);\n\t\tthis.category = new CategoryField(element.querySelector(this.options.categoryElement), this.transport, this.locale, this.options.category);\n\t\tthis.paramaters = new ParametersField(\n\t\t\telement.querySelector(this.options.parametersElement),\n\t\t\tnew ParametersRegistry(this.category, this.transport, this.state),\n\t\t\tthis.state,\n\t\t\tthis.locale,\n\t\t\tthis.parametersOptions(this.category)\n\t\t);\n\n\t\tthis.category.handleChange(true, this.onCategoryChange);\n\t\tthis.form.handleChange(true, this.onFormChange);\n\t}\n\n\tdestroy() : void {\n\t\tclearTimeout(this._reloadTimeout);\n\t\tthis.category.handleChange(false, this.onCategoryChange);\n\t\tthis.form.handleChange(false, this.onFormChange);\n\n\t\tthis.paramaters.destroy();\n\t\tthis.category.destroy();\n\t\tthis.form.destroy();\n\t}\n\n\tformOptions() : Object {\n\t\tconst options = Object.assign({}, this.options.form);\n\n\t\tif (this.el.dataset.formPayload != null) {\n\t\t\toptions['payload'] = JSON.parse(this.el.dataset.formPayload);\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tparametersOptions(category: CategoryField) : Object {\n\t\tconst options = Object.assign({}, this.options.parameters);\n\n\t\tif (options.name == null) {\n\t\t\toptions.name = category.selectElement().prop('name').replace(/\\[CATEGORY]$/, '[PARAMETERS]');\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tonCategoryChange = () : void => {\n\t\tthis.reload();\n\t}\n\n\tonFormChange = () : void => {\n\t\tthis.reloadDelayed();\n\t}\n\n\treloadDelayed() : void {\n\t\tclearTimeout(this._reloadTimeout);\n\n\t\t// noinspection JSUnresolvedReference\n\t\tif (window.JCIBlockGroupFieldIsRunning) { return; }\n\n\t\tthis._reloadTimeout = setTimeout(() => this.reload(), 200);\n\t}\n\n\treload() {\n\t\tclearTimeout(this._reloadTimeout);\n\t\tthis.state.loading();\n\n\t\tthis.transport.fetch('reload', {\n\t\t\tcategory: this.category.value(),\n\t\t\tform: this.form.transportPayload(),\n\t\t})\n\t\t\t.then((data: Object) : void => {\n\t\t\t\tthis.category.resetParent(data.parentCategory);\n\t\t\t\tthis.paramaters.reload(new ParameterCollection(data.parameters || []), data.parentParameters, !!this.category.value());\n\t\t\t\tthis.state.waiting();\n\t\t\t})\n\t\t\t.catch((error: Error) : void => {\n\t\t\t\tthis.state.error(error);\n\t\t\t});\n\t}\n}","import {CategoryPanel} from \"./CategoryPanel\";\n\nconst BX = window.BX;\n\n// noinspection JSUnusedGlobalSymbols\nexport class CategoryFactory {\n\tstatic READY_TOKEN = 'ym-category--ready';\n\n\tconstructor(className: string, options: Object = {}) {\n\t\tthis.className = className;\n\t\tthis.options = options;\n\t\tthis.instances = [];\n\n\t\tthis.boot();\n\t\tthis.bind();\n\t}\n\n\tboot() : void {\n\t\tfor (const element of document.getElementsByClassName(this.className)) {\n\t\t\tif (element.classList.contains(CategoryFactory.READY_TOKEN)) { continue; }\n\n\t\t\tthis.instances.push(new CategoryPanel(element, this.options));\n\n\t\t\telement.classList.add(CategoryFactory.READY_TOKEN);\n\t\t}\n\t}\n\n\tbind() : void {\n\t\t// noinspection JSUnresolvedReference\n\t\tBX.addCustomEvent('onAdminTabsChange', () => this.check());\n\t\tBX.addCustomEvent('Grid::updated', () => this.check());\n\t\tBX.addCustomEvent('Grid::noEditedRows', () => this.check());\n\t}\n\n\tcheck() : void {\n\t\tfor (const instance of this.instances.slice()) {\n\t\t\tif (document.contains(instance.el)) { continue; }\n\n\t\t\tinstance.destroy();\n\t\t\tthis.instances.splice(this.instances.indexOf(instance), 1);\n\t\t}\n\t}\n}"],"names":["$","window","YMarketJQuery","jQuery","CategoryField","constructor","element","transport","locale","options","_bindSearchPaste","onCopyClick","copyClipboard","this","value","parentValue","onSelectOpen","handleSearchPaste","onSelectClosing","onSearchPaste","e","paste","originalEvent","clipboardData","getData","toString","lines","split","map","line","trim","filter","indexOf","length","target","join","preventDefault","trigger","ajaxTransport","params","success","failure","test","data","q","fetch","query","language","then","prepareResults","catch","error","_lastError","message","templateSelection","variant","id","text","$el","el","Object","assign","defaults","bind","bootSelect","destroy","unbind","destroySelect","handleSelectOpen","handleSelectClose","handleCopy","handleChange","dir","callback","selectElement","find","copyElement","select2","width","minimumInputLength","selectOnClose","allowClear","ajax","cache","delay","getLanguageOptions","placeholder","languageDefaults","errorLoading","fn","amd","require","console","variants","results","fake","css","position","left","top","insertAfter","val","select","execCommand","remove","command","document","err","log","resetParent","category","parentElement","attr","BX","Row","field","onParameterWait","parameter","render","values","onHintEnter","_hintHover","initialLoad","handleHintHover","_hint","Show","onHintLeave","dataset","parametersRegistry","stopWait","control","initial","initialControl","wait","Error","setHint","description","setRequired","required","renderControl","name","replace","focused","parameterControl","setValue","focus","hint","querySelector","hintElement","Destroy","classList","add","CHint","parent","show_timeout","CONTENT","setContent","HINT","fieldElement","valueElement","Control","boot","activeElement","SelectSkeleton","tags","allowedCustom","multiple","selected","option","querySelectorAll","push","_toArray","found","first","changed","matched","selectedItem","createElement","textContent","appendChild","placeholderSelected","triggerHandler","Array","isArray","InitialControl","unbindFocus","bindFocus","_focusCallback","on","off","compileTemplate","template","variables","result","key","entries","marker","previousPosition","htmlToElement","html","tag","renderer","innerHTML","firstElementChild","TextControl","maxLength","EnumControl","unbindChange","allowCustom","bindChange","_changeCallback","reflow","selfSelected","existOptions","disabled","existIndex","selectedFound","_activeValues","matchedOption","existOption","includes","anchor","insertBefore","optionSelected","restricted","_restricted","restrictedValues","restrictions","valueRestrictions","restriction","limitingId","siblingValue","_castOptionIds","limitedValue","newRestricted","item","idMatches","exec","BooleanControl","NumberControl","_onInput","parseFloat","valid","Number","isNaN","min","max","_markInvalid","_onChange","minValue","maxValue","_handleInput","ParameterRow","unit","defaultUnit","onChange","reflowDepended","onDelete","delete","handleDelete","deleteElement","setDeprecated","type","make","markDeprecated","deprecated","FactoryMenu","_opening","onClick","evt","isOpen","collection","parameterCollection","open","state","_menu","CMenu","handleClick","DIV","style","display","toLowerCase","count","setItems","menuItems","exists","rows","row","filled","parameters","availableParameters","TEXT","HTML","ONCLICK","all","shownDependsOn","Parameter","fields","_this$fields$constrai","_this$fields$constrai2","_this$fields$constrai3","showByDefault","GROUP_ID","dependsOn","ids","ParameterCollection","property","dependentOf","other","ParametersRegistry","_itemWaiting","_parameters","Promise","resolve","loaded","reset","resolveWaiting","resolveFetch","index","keys","waitingId","waitingCallback","splice","resolveWaitingItem","_parametersPromise","reject","_parametersResolve","loading","parentCategory","waiting","ParentControl","ParentRow","UnknownParameter","multivalue","title","ParametersField","factoryMenu","addElement","bootRows","destroyRows","reload","parentValues","onlySelfValue","replaceParents","redrawParents","redrawParameters","redrawRequired","slice","addParent","container","tBodies","insertAdjacentElement","unshift","rowsIndex","parentRowElement","rowElement","Transport","apiKeyField","action","payload","formData","componentParameters","url","method","dataType","onsuccess","status","onfailure","Locale","messages","_messages","_language","replaces","Form","form","selector","handleEvent","childSelector","eventName","cssSelector","jsUtils","onLookupInputChange","layoutId","ACTION","CONTROL_ID","transportPayload","elements","input","from","State","LOADING","reason","MESSAGE","vars","markTypeClass","replaceHtml","states","loadingTemplate","waitingTemplate","errorTemplate","CategoryPanel","onCategoryChange","onFormChange","reloadDelayed","closest","formOptions","stateElement","categoryElement","paramaters","parametersElement","parametersOptions","clearTimeout","_reloadTimeout","formPayload","JSON","parse","prop","JCIBlockGroupFieldIsRunning","setTimeout","parentParameters","CategoryFactory","className","instances","getElementsByClassName","contains","READY_TOKEN","addCustomEvent","check","instance"],"mappings":"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"}